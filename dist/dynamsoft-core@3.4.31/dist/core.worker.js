/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.4.31
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */
!function(){"use strict";const e=e=>e&&"object"==typeof e&&"function"==typeof e.then,s=(async()=>{})().constructor;class t extends s{get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(t){let o;this._task=t,e(t)?o=t:"function"==typeof t&&(o=new s(t)),o&&(async()=>{try{const e=await o;t===this._task&&this.resolve(e)}catch(e){t===this._task&&this.reject(e)}})()}get isEmpty(){return null==this._task}constructor(s){let t,o;super(((e,s)=>{t=e,o=s})),this._s="pending",this.resolve=s=>{this.isPending&&(e(s)?this.task=s:(this._s="fulfilled",t(s)))},this.reject=e=>{this.isPending&&(this._s="rejected",o(e))},this.task=s}}const o=self,r={};o.coreWorkerVersion="3.4.31",o.versions=r;const a={},n=o.waitAsyncDependency=async e=>{let s="string"==typeof e?[e]:e,o=[];for(let e of s)o.push(a[e]=a[e]||new t);await Promise.all(o)},i=async(e,s)=>{let o,r="string"==typeof e?[e]:e,n=[];for(let e of r){let r;n.push(r=a[e]=a[e]||new t(o=o||s())),r.isEmpty&&(r.task=o=o||s())}await Promise.all(n)},c=[];o.setBufferIntoWasm=(e,s=0,t=0,o=0)=>{t&&(e=o?e.subarray(t,o):e.subarray(t));let r=c[s]=c[s]||{ptr:0,size:0,maxSize:0};return e.length>r.maxSize&&(r.ptr&&m._free(r.ptr),r.ptr=m._malloc(e.length),r.maxSize=e.length),m.HEAPU8.set(e,r.ptr),r.size=e.length,r.ptr};const l={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(l.needed){for(let e=0;e<l.temps.length;e++)m._free(l.temps[e]);l.temps.length=0,m._free(l.buffer),l.buffer=0,l.size+=l.needed,l.needed=0}l.buffer||(l.size+=128,l.buffer=m._malloc(l.size)),l.pos=0},alloc:function(e,s){let t,o=s.BYTES_PER_ELEMENT,r=e.length*o;return r=r+7&-8,l.pos+r>=l.size?(l.needed+=r,t=m._malloc(r),l.temps.push(t)):(t=l.buffer+l.pos,l.pos+=r),t},copy:function(e,s,t){switch(t>>>=0,s.BYTES_PER_ELEMENT){case 2:t>>>=1;break;case 4:t>>>=2;break;case 8:t>>>=3}for(let o=0;o<e.length;o++)s[t+o]=e[o]}},d=o.ep=l.prepare;o.bDebug=!1,o.bLog=!1,o.strDomain=void 0;const p=o.es=e=>{let s=intArrayFromString(e),t=l.alloc(s,m.HEAP8);return l.copy(s,m.HEAP8,t),t},m=o.Module={print:e=>{o.bLog&&w(e)},printErr:e=>{o.bLog&&w(e)},locateFile:(e,s)=>["dynamsoft-barcode-reader-bundle.wasm","core.wasm"].includes(e)?u.std+e:e},u=o.engineResourcePaths={},g=o.loadCore=async()=>{const e="core";await i(e,(async()=>{let s=o.bLog&&(w(e+" loading..."),Date.now())||0,t=new Promise((t=>{Module.onRuntimeInitialized=()=>{o.bLog&&w(e+" initialized, cost "+(Date.now()-s)+" ms"),t(void 0)}})),r=u.std+"dynamsoft-barcode-reader-bundle.js";importScripts(r),await t}))},f=o.loadSideModule=async(e,{js:s,wasm:t})=>{await i(e,(async()=>{await n("core");let t=o.bLog&&(w(e+" loading..."),Date.now())||0;if(s instanceof Array)for(let t of s){let s=u[e]+t;importScripts(s)}else if(s){let s=u[e]+e+".worker.js";importScripts(s)}wasmImports.emscripten_bind_CoreWasm_PreSetModuleExist&&(d(),wasmImports.emscripten_bind_CoreWasm_PreSetModuleExist(p(e.toUpperCase()))),wasmImports.emscripten_bind_CvrWasm_SetModuleExist&&(d(),wasmImports.emscripten_bind_CvrWasm_SetModuleExist(p(e.toUpperCase())));const a=JSON.parse(UTF8ToString(wasmImports.emscripten_bind_CoreWasm_GetModuleVersion_0())),i=o[`${e}WorkerVersion`];r[e]={worker:`${i||"No Worker"}`,wasm:a[e.toUpperCase()]},o.bLog&&w(e+" initialized, cost "+(Date.now()-t)+" ms")}))},_=o.mapController={loadWasm:async(e,s)=>{try{Object.assign(u,e.engineResourcePaths),e.needLoadCore&&(e.bLog&&(o.bLog=!0),e.dm&&(o.strDomain=e.dm),e.bd&&(o.bDebug=!0),await g());for(let s of e.names)await f(s,e.autoResources[s]);if(e.needLoadCore){const e=JSON.parse(UTF8ToString(wasmImports.emscripten_bind_CoreWasm_GetModuleVersion_0()));r.core={worker:o.coreWorkerVersion,wasm:e.CORE}}for(let e in r)r[e].wasm&&(r[e].wasm=r[e].wasm.replace("20250211","23472-single-wasm"));h(s,{versions:r})}catch(e){console.log(e),b(s,e)}},setBLog:e=>{o.bLog=e.value},setBDebug:e=>{o.bDebug=e.value},getModuleVersion:async(e,s)=>{try{let e=UTF8ToString(wasmImports.emscripten_bind_CoreWasm_GetModuleVersion_0());h(s,{versions:JSON.parse(e)})}catch(e){b(s,e)}},cfd:async(e,s)=>{try{wasmImports.emscripten_bind_CoreWasm_static_CFD_1(e.count),h(s,{})}catch(e){b(s,e)}}};addEventListener("message",(e=>{const s=e.data?e.data:e,t=s.body,o=s.id,r=s.instanceID,a=_[s.type];if(!a)throw new Error("Unmatched task: "+s.type);"license_dynamsoft"==a&&(t.v="3.4.31-single-wasm"),a(t,o,r)}));const h=o.handleTaskRes=(e,s)=>{postMessage({type:"task",id:e,body:Object.assign({success:!0},s)})},b=o.handleTaskErr=(e,s)=>{postMessage({type:"task",id:e,body:{success:!1,message:(null==s?void 0:s.message)||"No have error message.",stack:o.bDebug&&(null==s?void 0:s.stack)||"No have stack."}})},w=o.log=e=>{postMessage({type:"log",message:e})}}();