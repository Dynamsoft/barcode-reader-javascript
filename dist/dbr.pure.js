/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 8.8.7 (js 20220125)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("dynamsoft-camera-enhancer")):"function"==typeof define&&define.amd?define(["exports","dynamsoft-camera-enhancer"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft.DBR={}),e.Dynamsoft.DCE)}(this,(function(e,t){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n,r,o,s,a=i(t);function d(e,t,i,n){return new(i||(i=Promise))((function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))}e.EnumImagePixelFormat=void 0,(n=e.EnumImagePixelFormat||(e.EnumImagePixelFormat={}))[n.IPF_Binary=0]="IPF_Binary",n[n.IPF_BinaryInverted=1]="IPF_BinaryInverted",n[n.IPF_GrayScaled=2]="IPF_GrayScaled",n[n.IPF_NV21=3]="IPF_NV21",n[n.IPF_RGB_565=4]="IPF_RGB_565",n[n.IPF_RGB_555=5]="IPF_RGB_555",n[n.IPF_RGB_888=6]="IPF_RGB_888",n[n.IPF_ARGB_8888=7]="IPF_ARGB_8888",n[n.IPF_RGB_161616=8]="IPF_RGB_161616",n[n.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",n[n.IPF_ABGR_8888=10]="IPF_ABGR_8888",n[n.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",n[n.IPF_BGR_888=12]="IPF_BGR_888",e.EnumErrorCode=void 0,(r=e.EnumErrorCode||(e.EnumErrorCode={}))[r.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",r[r.DBR_SUCCESS=0]="DBR_SUCCESS",r[r.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",r[r.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",r[r.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",r[r.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",r[r.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",r[r.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",r[r.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",r[r.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",r[r.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",r[r.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",r[r.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",r[r.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",r[r.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",r[r.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",r[r.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",r[r.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",r[r.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",r[r.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",r[r.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",r[r.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",r[r.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",r[r.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",r[r.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",r[r.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",r[r.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",r[r.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",r[r.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",r[r.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",r[r.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",r[r.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",r[r.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",r[r.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",r[r.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",r[r.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",r[r.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",r[r.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",r[r.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",r[r.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",r[r.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",r[r.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",r[r.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",r[r.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",r[r.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",r[r.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",r[r.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",r[r.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",r[r.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",r[r.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",r[r.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",r[r.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",r[r.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",r[r.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",r[r.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",r[r.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",r[r.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",r[r.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",r[r.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",r[r.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",r[r.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",r[r.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS",e.EnumIMResultDataType=void 0,(o=e.EnumIMResultDataType||(e.EnumIMResultDataType={}))[o.IMRDT_IMAGE=1]="IMRDT_IMAGE",o[o.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",o[o.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",o[o.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",o[o.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",o[o.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL",e.EnumBarcodeFormat=void 0,(s=e.EnumBarcodeFormat||(e.EnumBarcodeFormat={}))[s.BF_ALL=-31457281]="BF_ALL",s[s.BF_ONED=1050623]="BF_ONED",s[s.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",s[s.BF_CODE_39=1]="BF_CODE_39",s[s.BF_CODE_128=2]="BF_CODE_128",s[s.BF_CODE_93=4]="BF_CODE_93",s[s.BF_CODABAR=8]="BF_CODABAR",s[s.BF_ITF=16]="BF_ITF",s[s.BF_EAN_13=32]="BF_EAN_13",s[s.BF_EAN_8=64]="BF_EAN_8",s[s.BF_UPC_A=128]="BF_UPC_A",s[s.BF_UPC_E=256]="BF_UPC_E",s[s.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",s[s.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",s[s.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",s[s.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",s[s.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",s[s.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",s[s.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",s[s.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",s[s.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",s[s.BF_PATCHCODE=262144]="BF_PATCHCODE",s[s.BF_PDF417=33554432]="BF_PDF417",s[s.BF_QR_CODE=67108864]="BF_QR_CODE",s[s.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",s[s.BF_AZTEC=268435456]="BF_AZTEC",s[s.BF_MAXICODE=536870912]="BF_MAXICODE",s[s.BF_MICRO_QR=1073741824]="BF_MICRO_QR",s[s.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",s[s.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",s[s.BF_MSI_CODE=1048576]="BF_MSI_CODE",s[s.BF_NULL=0]="BF_NULL";const _=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),l=!_&&"undefined"==typeof self,c=_?global:l?{}:self;class u{constructor(){this._canvasMaxWH="iPhone"==u.browserInfo.OS||"Android"==u.browserInfo.OS?2048:4096,this._instanceID=void 0,this.bSaveOriCanvas=!1,this.oriCanvas=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this._bUseWebgl=!0,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}static get version(){return this._version}static get license(){return this._license}static set license(e){if("unload"!=this._loadWasmStatus)throw new Error("`license` is not allowed to change after `createInstance` or `loadWasm` is called.");u._license=e}static get productKeys(){return this._license}static set productKeys(e){u.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){u.license=e}static get organizationID(){return this._license}static set organizationID(e){u.license=e}static set sessionPassword(e){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after `createInstance` or `loadWasm` is called.");u._sessionPassword=e}static get sessionPassword(){return this._sessionPassword}static detectEnvironment(){return d(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!!(_?process.version>="v12":"undefined"!=typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e&&(e="./"),_||l)u._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,u._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(u._engineResourcePath+="/")}static get licenseServer(){return this._licenseServer}static set licenseServer(e){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e)u._licenseServer=[];else{e instanceof Array||(e=[e]);for(let t=0;t<e.length;++t){if(!_&&!l){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}u._licenseServer=e}}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after `createInstance` or `loadWasm` is called.");u._deviceFriendlyName=e||""}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");u.__bUseFullFeature=e}get ifSaveOriginalImageInACanvas(){return this.bSaveOriCanvas}set ifSaveOriginalImageInACanvas(e){this.bSaveOriCanvas=e}getOriginalImageInACanvas(){return this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isLoaded(){return"loadSuccess"==this._loadWasmStatus}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static loadWasm(){return d(this,void 0,void 0,(function*(){if(_&&process.version<"v12")throw new Error("DBRJS SDK requires nodejs version >= v12.");let t,i=u._license,n=JSON.parse(JSON.stringify(u._licenseServer)),r=u._sessionPassword,o=null,s=null,a=0;if(i.startsWith("t")||i.startsWith("f"))a=0;else if(0===i.length||i.startsWith("P")||i.startsWith("L"))a=1;else{a=2;const e=i.indexOf(":");if(-1!=e&&(i=i.substring(e+1)),i.startsWith("DLS2")){let e=i.substring(4);e=_?Buffer.from(e,"base64").toString("binary"):atob(e);const t=JSON.parse(e);if(t.handshakeCode?i=t.handshakeCode:t.organizationID&&(i=t.organizationID),"number"==typeof i&&(i=JSON.stringify(i)),i||(i=""),0===n.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),u.licenseServer=e,n=u.licenseServer}!r&&t.sessionPassword&&(r=t.sessionPassword),t.chargeWay&&(s=t.chargeWay),t.limitedLicenseModules&&(o=t.limitedLicenseModules)}}if(a&&(_?process.version<"v15"&&(t="To use online key requires nodejs version >= v15."):(c.crypto||(t="Please upgrade your browser to support online key."),c.crypto.subtle||(t="Require https to use online key in this browser."))),t){if(1!==a)throw new Error(t);a=0,console.warn(t),u._lastErrorCode=e.EnumErrorCode.DMERR_FAILED_TO_REACH_LTS,u._lastErrorString=t}return 1===a&&(i="",console.warn("Automatically apply for a public trial license.")),yield new Promise(((e,t)=>d(this,void 0,void 0,(function*(){switch(u._loadWasmStatus){case"unload":{u._loadWasmStatus="loading";let e=u.engineResourcePath+u._workerName;if(_||u.engineResourcePath.startsWith(location.origin)||(e=yield fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),_){const t=yield import("worker_threads");u._dbrWorker=new t.Worker(e)}else u._dbrWorker=new Worker(e);u._dbrWorker.onerror=e=>{u._loadWasmStatus="loadFail";let t=new Error(e.message);u._loadWasmErr=t;for(let e of u._loadWasmCallbackArr)e(t);u._loadWasmCallbackArr=[]},u._dbrWorker.onmessage=e=>d(this,void 0,void 0,(function*(){let t=e.data?e.data:e;switch(t.type){case"log":u._onLog&&u._onLog(t.message);break;case"load":{t.message&&(t.message=t.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let e=!1;if(1===a&&(e=!0),t.success){u._loadWasmStatus="loadSuccess",u._version=t.version+"(JS "+u._jsVersion+"."+u._jsEditVersion+")",u._onLog&&u._onLog("load dbr worker success");for(let e of u._loadWasmCallbackArr)e();u._loadWasmCallbackArr=[],u._dbrWorker.onerror=null,t.message&&console.warn(t.message)}else{let i=new Error(t.message);i.stack=t.stack+"\n"+i.stack,u._loadWasmStatus="loadFail",u._loadWasmErr=i;for(let e of u._loadWasmCallbackArr)e(i);u._loadWasmCallbackArr=[],e||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(e=!0)}e&&u.showDialog(t.success?"warn":"error",t.message);break}case"task":{let e=t.id,i=t.body;try{u._taskCallbackMap.get(e)(i),u._taskCallbackMap.delete(e)}catch(t){throw u._taskCallbackMap.delete(e),t}break}default:u._onLog&&u._onLog(e)}})),_&&u._dbrWorker.on("message",u._dbrWorker.onmessage),u._dbrWorker.postMessage({type:"loadWasm",bd:u._bWasmDebug,engineResourcePath:u.engineResourcePath,version:u._jsVersion,brtk:!!a,bptk:1===a,lcs:i,dm:!_&&location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:u._bUseFullFeature,browserInfo:u.browserInfo,deviceFriendlyName:u.deviceFriendlyName,ls:n,sp:r,lm:o,cw:s})}case"loading":u._loadWasmCallbackArr.push((i=>{i?t(i):e()}));break;case"loadSuccess":e();break;case"loadFail":t(u._loadWasmErr)}}))))}))}static showDialog(e,t){return d(this,void 0,void 0,(function*(){if(!_&&!u._bNeverShowDialog)try{let i=yield fetch(u.engineResourcePath+"dls.license.dialog.html");if(!i.ok)throw Error("Get license dialog fail. Network Error: "+i.statusText);let n=yield i.text();if(!n.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.innerHTML=n;let o=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(o.push(t),document.head.append(t))}let s=1==r.childElementCount?r.children[0]:r;s.remove();let a,d,_,l,c,g=[s],h=s.children;for(let e of h)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let i of g)if(!a&&i.classList.contains("dls-license-mask"))a=i,i.addEventListener("click",(e=>{if(i==e.target){s.remove();for(let e of o)e.remove()}}));else if(!d&&i.classList.contains("dls-license-icon-close"))d=i,i.addEventListener("click",(()=>{s.remove();for(let e of o)e.remove()}));else if(!_&&i.classList.contains("dls-license-icon-error"))_=i,"error"!=e&&i.remove();else if(!l&&i.classList.contains("dls-license-icon-warn"))l=i,"warn"!=e&&i.remove();else if(!c&&i.classList.contains("dls-license-msg-content")){c=i;let e=t;for(;e;){let t=e.indexOf("["),n=e.indexOf("]",t),r=e.indexOf("(",n),o=e.indexOf(")",r);if(-1==t||-1==n||-1==r||-1==o){i.appendChild(new Text(e));break}t>0&&i.appendChild(new Text(e.substring(0,t)));let s=document.createElement("a"),a=e.substring(t+1,n);s.innerText=a;let d=e.substring(r+1,o);s.setAttribute("href",d),s.setAttribute("target","_blank"),i.appendChild(s),e=e.substring(o+1)}}document.body.appendChild(s)}catch(e){u._onLog&&u._onLog(e.message||e)}}))}static createInstanceInWorker(e=!1){return d(this,void 0,void 0,(function*(){return yield u.loadWasm(),yield new Promise(((t,i)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),u._dbrWorker.postMessage({type:"createInstance",id:n,bScanner:e})}))}))}static createInstance(){return d(this,void 0,void 0,(function*(){let e=new u;return e._instanceID=yield u.createInstanceInWorker(),e}))}decode(e){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("decode(source: any)"),u._onLog&&(this._timeStartDecode=Date.now()),_)return e instanceof Buffer?yield this._decodeFileInMemory_Uint8Array(new Uint8Array(e)):e instanceof Uint8Array?yield this._decodeFileInMemory_Uint8Array(e):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e):"http"==e.substring(0,4)?yield this._decode_Url(e):yield this._decode_FilePath(e):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Buffer', 'Uint8Array', 'String(base64 with image mime)' or 'String(url)'."));{let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?yield this._decode_Blob(e,t):e instanceof ArrayBuffer?yield this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yield this._decode_Image(e,t):e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?yield this._decode_Canvas(e,t):e instanceof HTMLVideoElement?yield this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e,t):yield this._decode_Url(e,t):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}))}decodeBase64String(e){return d(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}))}decodeUrl(e){return d(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}))}_decodeBuffer_Uint8Array(e,t,i,n,r,o){return d(this,void 0,void 0,(function*(){return yield new Promise(((s,a)=>{let d=u._nextTaskID++;u._taskCallbackMap.set(d,(e=>{if(e.success){let t,i=u._onLog?Date.now():0;u._onLog&&u._onLog("worker return result: "+i),this._lastInnerDecodeDuration=e.duration;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return a(e)}if(u._onLog){let e=Date.now();u._onLog("DBR time get result: "+i),u._onLog("Handle image cost: "+(this._timeEnterInnerDBR-this._timeStartDecode)),u._onLog("DBR worker decode image cost: "+(i-this._timeEnterInnerDBR)),u._onLog("DBR worker handle results: "+(e-i)),u._onLog("Total decode image cost: "+(e-this._timeStartDecode))}return s(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}})),this._timeEnterInnerDBR=Date.now(),u._onLog&&u._onLog("Send buffer to worker:"+this._timeEnterInnerDBR),u._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:this._instanceID,body:{buffer:e,width:t,height:i,stride:n,format:r,config:o}},[e.buffer]),u._onLog&&o&&o._timeEndGettingFrame&&u._onLog("decode image delay: "+(this._timeEnterInnerDBR-o._timeEndGettingFrame))}))}))}_decodeBuffer_Blob(e,t,i,n,r,o){return d(this,void 0,void 0,(function*(){u._onLog&&u._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const s=e.arrayBuffer?yield e.arrayBuffer():yield new Promise(((t,i)=>{let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{t(n.result)},n.onerror=()=>{i(n.error)}}));return yield this._decodeBuffer_Uint8Array(new Uint8Array(s),t,i,n,r,o)}))}decodeBuffer(e,t,i,n,r,o){return d(this,void 0,void 0,(function*(){let s;return u._onLog&&u._onLog("decodeBuffer(buffer,width,height,stride,format)"),u._onLog&&(this._timeStartDecode=Date.now()),_?e instanceof Uint8Array?s=yield this._decodeBuffer_Uint8Array(e,t,i,n,r,o):e instanceof Buffer&&(s=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,n,r,o)):e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=yield this._decodeBuffer_Uint8Array(e,t,i,n,r,o):e instanceof ArrayBuffer?s=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,n,r,o):e instanceof Blob&&(s=yield this._decodeBuffer_Blob(e,t,i,n,r,o)),s}))}_decodeFileInMemory_Uint8Array(e){return d(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(e=>{if(e.success){let n;this._lastInnerDecodeDuration=e.duration;try{n=this._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),u._dbrWorker.postMessage({type:"decodeFileInMemory",id:n,instanceID:this._instanceID,body:{bytes:e}})}))}))}getRuntimeSettings(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success){let t=JSON.parse(i.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}updateRuntimeSettings(t){return d(this,void 0,void 0,(function*(){let i;if("string"==typeof t)if("speed"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region}else i=JSON.parse(t);else{if("object"!=typeof t)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(t)),i.region instanceof Array){let e=i.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(i.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!u._bUseFullFeature){if(0!=(i.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(!_)if(this.bFilterRegionInJs){let e=i.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return yield new Promise(((e,t)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(i=>{if(i.success){try{this._handleRetJsonString(i.updateReturn)}catch(e){t(e)}return e()}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})}))}))}resetRuntimeSettings(){return d(this,void 0,void 0,(function*(){return this.userDefinedRegion=null,this.region=null,yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}outputSettingsToString(){return d(this,void 0,void 0,(function*(){if(!u._bUseFullFeature)throw Error("outputSettingsToString() is not supported in the compact version. Please try the full-featured version.");return yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"outputSettingsToString",id:i,instanceID:this._instanceID})}))}))}initRuntimeSettingsWithString(e){return d(this,void 0,void 0,(function*(){if(!u._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise(((t,i)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),u._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:n,instanceID:this._instanceID,body:{settings:e}})}))}))}_decode_Blob(e,t){return d(this,void 0,void 0,(function*(){u._onLog&&u._onLog("_decode_Blob(blob: Blob)");let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=yield createImageBitmap(e)}catch(e){}i||(n=yield function(e){return new Promise(((t,i)=>{let n=URL.createObjectURL(e),r=new Image;r.dbrObjUrl=n,r.src=n,r.onload=()=>{t(r)},r.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=yield this._decode_Image(i||n,t);return i&&i.close(),r}))}_decode_ArrayBuffer(e,t){return d(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),t)}))}_decode_Uint8Array(e,t){return d(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),t)}))}_decode_Image(e,t){return d(this,void 0,void 0,(function*(){u._onLog&&u._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),t=t||{};let i,n,r,o,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,d=t.region;if(d){let e,t,r,o;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,t=d.regionTop*a/100,r=d.regionRight*s/100,o=d.regionBottom*a/100):(e=d.regionLeft,t=d.regionTop,r=d.regionRight,o=d.regionBottom),i=e,n=t,s=Math.round(r-e),a=Math.round(o-t)}else i=0,n=0;const _=Math.max(s,a);if(_>this._canvasMaxWH){const e=this._canvasMaxWH/_;s>a?(r=this._canvasMaxWH,o=Math.round(a*e)):(r=Math.round(s*e),o=this._canvasMaxWH)}else r=s,o=a;let l,g;!this.bSaveOriCanvas&&c.OffscreenCanvas?l=new OffscreenCanvas(r,o):(l=document.createElement("canvas"),l.width=r,l.height=o),l.getContext("2d").drawImage(e,i,n,s,a,0,0,r,o),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),d?(g=JSON.parse(JSON.stringify(t)),delete g.region):g=t;let h=yield this._decode_Canvas(l,g);return u.fixResultLocationWhenFilterRegionInJs(d,h,i,n,s,a,r,o),h}))}_decode_Canvas(t,i){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=t);let n=(t.dbrCtx2d||t.getContext("2d")).getImageData(0,0,t.width,t.height).data;return yield this._decodeBuffer_Uint8Array(n,t.width,t.height,4*t.width,e.EnumImagePixelFormat.IPF_ABGR_8888,i)}))}_decode_Video(e,t){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";t=t||{};let i,n,r,o,s=e.videoWidth,a=e.videoHeight,d=t.region;if(d){let e,t,r,o;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,t=d.regionTop*a/100,r=d.regionRight*s/100,o=d.regionBottom*a/100):(e=d.regionLeft,t=d.regionTop,r=d.regionRight,o=d.regionBottom),i=e,n=t,s=Math.round(r-e),a=Math.round(o-t)}else i=0,n=0;const _=Math.max(s,a);if(_>this._canvasMaxWH){const e=this._canvasMaxWH/_;s>a?(r=this._canvasMaxWH,o=Math.round(a*e)):(r=Math.round(s*e),o=this._canvasMaxWH)}else r=s,o=a;let l=null;!this.bSaveOriCanvas&&c.OffscreenCanvas?l=new OffscreenCanvas(r,o):(l=document.createElement("canvas"),l.width=r,l.height=o);let g;(l.dbrCtx2d=l.getContext("2d")).drawImage(e,i,n,s,a,0,0,r,o),d?(g=JSON.parse(JSON.stringify(t)),delete g.region):g=t;let h=yield this._decode_Canvas(l,t);return d&&u.fixResultLocationWhenFilterRegionInJs(d,h,i,n,s,a,r,o),h}))}_decode_Base64(e,t){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");if("data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1)),_){let t=Buffer.from(e,"base64");return yield this._decodeFileInMemory_Uint8Array(new Uint8Array(t))}{let i=atob(e),n=i.length,r=new Uint8Array(n);for(;n--;)r[n]=i.charCodeAt(n);return yield this._decode_Blob(new Blob([r]),t)}}))}_decode_Url(e,t){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");if(e=e,_){let t=yield new Promise(((t,i)=>d(this,void 0,void 0,(function*(){(e.startsWith("https")?yield import("https"):yield import("http")).get(e,(e=>{if(200==e.statusCode){let i=[];e.on("data",(e=>{i.push(e)})).on("end",(()=>{t(new Uint8Array(Buffer.concat(i)))}))}else i("http get fail, statusCode: "+e.statusCode)}))}))));return yield this._decodeFileInMemory_Uint8Array(t)}{let i=yield new Promise(((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.send(),n.onloadend=()=>d(this,void 0,void 0,(function*(){t(n.response)})),n.onerror=()=>{i(new Error("Network Error: "+n.statusText))}}));return yield this._decode_Blob(i,t)}}))}_decode_FilePath(e,t){return d(this,void 0,void 0,(function*(){if(u._onLog&&u._onLog("_decode_FilePath(path)"),!_)throw Error("'_decode_FilePath(path, config)': The method is only supported in node environment.");if("string"!=typeof e)throw TypeError("'_decode_FilePath(path, config)': Type of 'path' should be 'string'.");const t=yield import("fs");let i=yield new Promise(((i,n)=>{t.readFile(e,((e,t)=>{e?n(e):i(new Uint8Array(t))}))}));return yield this._decodeFileInMemory_Uint8Array(i)}))}static fixResultLocationWhenFilterRegionInJs(e,t,i,n,r,o,s,a){if(e&&t.length>0)for(let e of t){let t=e.localizationResult;2==t.resultCoordinateType&&(t.x1*=.01*s,t.x2*=.01*s,t.x3*=.01*s,t.x4*=.01*s,t.y1*=.01*a,t.y2*=.01*a,t.y3*=.01*a,t.y4*=.01*a);let d=s/r,_=a/o;t.x1=t.x1/d+i,t.x2=t.x2/d+i,t.x3=t.x3/d+i,t.x4=t.x4/d+i,t.y1=t.y1/_+n,t.y2=t.y2/_+n,t.y3=t.y3/_+n,t.y4=t.y4/_+n,2==t.resultCoordinateType&&(t.x1*=100/r,t.x2*=100/r,t.x3*=100/r,t.x4*=100/r,t.y1*=100/o,t.y2*=100/o,t.y3*=100/o,t.y4*=100/o)}}static BarcodeReaderException(t,i){let n,r=e.EnumErrorCode.DBR_UNKNOWN;return"number"==typeof t?(r=t,n=new Error(i)):n=new Error(t),n.code=r,n}_handleRetJsonString(t){let i=e.EnumErrorCode;if(t.textResults){for(let e=0;e<t.textResults.length;e++){let i=t.textResults[e];try{let e=i.barcodeText,t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);try{i.barcodeText=decodeURIComponent(escape(t))}catch(e){i.barcodeText=t}}catch(e){i.barcodeText=""}if(null!=i.exception){u._setWarnnedEx.has(i.exception)||(u._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let i=t.indexOf(":");e[t.substring(0,i)]=t.substring(i+1)})),i.exception=e}}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.exception&&!u._setWarnnedEx.has(t.description)&&(u._setWarnnedEx.add(t.description),console.warn(t.description)),t.textResults}if(t.exception==i.DBR_SUCCESS)return t.data;throw u.BarcodeReaderException(t.exception,t.description)}setModeArgument(e,t,i,n){return d(this,void 0,void 0,(function*(){return yield new Promise(((r,o)=>{let s=u._nextTaskID++;u._taskCallbackMap.set(s,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return o(e)}return r()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),u._dbrWorker.postMessage({type:"setModeArgument",id:s,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i,argumentValue:n}})}))}))}getModeArgument(e,t,i){return d(this,void 0,void 0,(function*(){return yield new Promise(((n,r)=>{let o=u._nextTaskID++;u._taskCallbackMap.set(o,(e=>{if(e.success){let t;try{t=this._handleRetJsonString(e.getReturn)}catch(e){return r(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),u._dbrWorker.postMessage({type:"getModeArgument",id:o,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i}})}))}))}getIntermediateResults(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID})}))}))}getIntermediateCanvas(){return d(this,void 0,void 0,(function*(){let t=yield this.getIntermediateResults(),i=[];for(let n of t)if(n.dataType==e.EnumIMResultDataType.IMRDT_IMAGE)for(let t of n.results){const n=t.bytes;let r;switch(u._onLog&&u._onLog(" "+n.length+" "+n.byteLength+" "+t.width+" "+t.height+" "+t.stride+" "+t.format),t.format){case e.EnumImagePixelFormat.IPF_ABGR_8888:r=new Uint8ClampedArray(n);break;case e.EnumImagePixelFormat.IPF_RGB_888:{const e=n.length/3;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)r[4*t]=n[3*t+2],r[4*t+1]=n[3*t+1],r[4*t+2]=n[3*t],r[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_GrayScaled:{const e=n.length;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)r[4*t]=r[4*t+1]=r[4*t+2]=n[t],r[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_Binary:case e.EnumImagePixelFormat.IPF_BinaryInverted:{t.width=8*t.stride,t.height=n.length/t.stride;const e=n.length;r=new Uint8ClampedArray(8*e*4);for(let t=0;t<e;t++){let e=n[t];for(let i=0;i<8;++i)r[4*(8*t+i)]=r[4*(8*t+i)+1]=r[4*(8*t+i)+2]=(128&e)/128*255,r[4*(8*t+i)+3]=255,e<<=1}break}default:console.warn("unknow intermediate image",t)}if(!r)continue;let o=new ImageData(r,t.width,t.height),s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").putImageData(o,0,0),i.push(s)}return i}))}destroy(){return this.destroyContext()}destroyContext(){if(u._onLog&&u._onLog("destroyContext()"),!this.bDestroyed)return this.bDestroyed=!0,new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"destroyContext",id:i,instanceID:this._instanceID})}))}}u._jsVersion="8.8.7",u._jsEditVersion="20220125",u._version="loading...(JS "+u._jsVersion+"."+u._jsEditVersion+")",u._license=_||l||!document.currentScript?"":document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")||"",u._sessionPassword=_||l||!document.currentScript?"":document.currentScript.getAttribute("data-sessionPassword")||"",u.browserInfo=function(){if(!_&&!l){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(l)return{browser:"ssr",version:0,OS:"ssr"};if(_){const e={browser:"node",version:process.version.substring(1),OS:"loading"};return(()=>{d(this,void 0,void 0,(function*(){const t=yield import("os");e.OS=t&&t.platform?t.platform()+t.release():"Unknown"}))})(),e}}(),u._workerName="dbr-"+u._jsVersion+".worker.js",u._engineResourcePath=(()=>{if(_)return __dirname+"/";if(!l&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),u._licenseServer=[],u._deviceFriendlyName="",u._isShowRelDecodeTimeInResults=!1,u._bWasmDebug=!1,u._bNeverShowDialog=!1,u.__bUseFullFeature=!0,u._nextTaskID=0,u._taskCallbackMap=new Map,u._loadWasmStatus="unload",u._loadWasmCallbackArr=[],u._lastErrorCode=0,u._lastErrorString="",u._setWarnnedEx=new Set,u._loadWasmErr=null;const g=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement);class h extends u{constructor(){super(),this._clickIptSingleFrameMode=()=>{},this.intervalTime=0,this.bSaveOriCanvas=!1,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._selCam=null,this._selRsl=null,this._btnClose=null,this._soundOnSuccessfullRead=new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this.barcodeFillStyle="rgba(254,180,32,0.3)",this.barcodeStrokeStyle="rgba(254,180,32,0.9)",this.barcodeLineWidth=1,this.beingLazyDrawRegionsults=!1,this.dce=null,this._onCameraSelChange=()=>{this._divScanLight&&(this._divScanLight.style.display="none"),this._drawRegionsults(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this._onResolutionSelChange=()=>{this._divScanLight&&(this._divScanLight.style.display="none"),this._drawRegionsults(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this._onCloseBtnClick=()=>{this.hide()}}static get defaultUIElementURL(){var e;return null===(e=h._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",u.engineResourcePath)}static set defaultUIElementURL(e){h._defaultUIElementURL=e}getUIElement(){return this.dce.getUIElement()}setUIElement(e){return d(this,void 0,void 0,(function*(){yield this.dce.setUIElement(e)}))}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e&&(()=>{d(this,void 0,void 0,(function*(){let e=yield this.getScanSettings();e.oneDTrustFrameCount=1,yield this.updateScanSettings(e)}))})()}get ifSaveOriginalImageInACanvas(){return this.bSaveOriCanvas}set ifSaveOriginalImageInACanvas(e){this.bSaveOriCanvas=e,this.dce&&(this.dce.ifSaveOriginalImageInACanvas=e)}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}get soundOnSuccessfullRead(){return this._soundOnSuccessfullRead}set soundOnSuccessfullRead(e){e instanceof HTMLAudioElement?this._soundOnSuccessfullRead=e:this._soundOnSuccessfullRead=new Audio(e)}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set region(e){this._region=e,this.dce&&(this.dce.region=e),this.singleFrameMode||(this.beingLazyDrawRegionsults=!0,setTimeout((()=>{this.beingLazyDrawRegionsults&&this._drawRegionsults()}),500)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}createDCEInstance(){return d(this,void 0,void 0,(function*(){this.dce||(u._onLog&&u._onLog("createDCEInstance()"),t.CameraEnhancer.defaultUIElementURL=null,this.dce=yield t.CameraEnhancer.createInstance(),this.dce.bChangeRegionIndexManually=!0,this.dce.regionIndex=0,this.dce.bufferRefreshInterval=200,this.dce.alwaysRefreshBuffer=!1,this.dce.ifSaveOriginalImageInACanvas=!1,this.dce.onSingleFrameAcquired=e=>d(this,void 0,void 0,(function*(){let t=yield this.decode(e);yield this.clearMapDecodeRecord();for(let e of t)delete e.bUnduplicated;if(this._drawRegionsults(t),this.onFrameRead&&this.isOpen()&&!this._bPauseScan&&this.onFrameRead(t),this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let e of t)this.onUniqueRead(e.barcodeText,e)})),this._clickIptSingleFrameMode=this.dce._clickIptSingleFrameMode)}))}static createInstance(e){return d(this,void 0,void 0,(function*(){if(g)throw new Error("`BarcodeScanner` is not supported in Node.js.");let t=new h;yield t.createDCEInstance(),t._instanceID=yield h.createInstanceInWorker(!0),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(h.defaultUIElementURL),t.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.singleFrameMode||(yield t.updateRuntimeSettings("single")),t}))}decode(e){return super.decode(e)}decodeBase64String(e){return super.decodeBase64String(e)}decodeUrl(e){return super.decodeUrl(e)}decodeBuffer(e,t,i,n,r,o){return super.decodeBuffer(e,t,i,n,r,o)}decodeCurrentFrame(t){return d(this,void 0,void 0,(function*(){this._assertOpen();let i=null;t&&t.region&&(i=t.region);let n=this.dce.getFrame(i);if(n&&null===n.canvas){let{data:t,width:i,height:r}=n;return yield this._decodeBuffer_Uint8Array(t,i,r,i,e.EnumImagePixelFormat.IPF_GrayScaled)}if(n&&n.canvas){let{data:t,canvas:i,region:r,sx:o,sy:s,sWidth:a,sHeight:d}=n;(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=i);let _=yield this._decodeBuffer_Uint8Array(t,i.width,i.height,4*i.width,e.EnumImagePixelFormat.IPF_ABGR_8888);return u.fixResultLocationWhenFilterRegionInJs(r,_,o,s,a,d,i.width,i.height),_}}))}clearMapDecodeRecord(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:i,instanceID:this._instanceID})}))}))}static isRegionSinglePreset(e){return JSON.stringify(e)==JSON.stringify(h.singlePresetRegion)}static isRegionNormalPreset(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}updateRuntimeSettings(t){return d(this,void 0,void 0,(function*(){let i;if("string"==typeof t)if("speed"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,h.isRegionSinglePreset(e.region)||(i.region=e.region)}else if("balance"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,h.isRegionSinglePreset(e.region)||(i.region=e.region),i.deblurLevel=3,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0],i.timeout=1e5}else if("coverage"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,h.isRegionSinglePreset(e.region)||(i.region=e.region),i.deblurLevel=5,i.expectedBarcodesCount=512,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.timeout=1e5}else if("single"==t){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),i=yield this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,h.isRegionNormalPreset(e.region)?i.region=JSON.parse(JSON.stringify(h.singlePresetRegion)):i.region=e.region,i.expectedBarcodesCount=1,i.localizationModes=[16,2,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=0}else i=JSON.parse(t);else{if("object"!=typeof t)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(t)),i.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(i.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!u._bUseFullFeature){if(0!=(i.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let e=i.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(e)):this.userDefinedRegion=null,e instanceof Array)if(e.length){for(let t=0;t<e.length;++t){let i=e[t];i&&((i.regionLeft||i.regionTop||i.regionRight||i.regionBottom||i.regionMeasuredByPercentage)&&(i.regionLeft||i.regionTop||100!=i.regionRight||100!=i.regionBottom||!i.regionMeasuredByPercentage)||(e[t]=null))}this.region=e}else this.region=null;else(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null;this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}yield new Promise(((e,t)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(i=>{if(i.success){try{this._handleRetJsonString(i.updateReturn)}catch(e){t(e)}return e()}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),u._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})})),"single"==t&&(yield this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0"),yield this.setModeArgument("LocalizationModes",0,"ScanDirection","2"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeX","71"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeY","71"))}))}_bindUI(){let e=this.getUIElement();if(!e)throw new Error("Need to define `UIElement` before opening.");let t=[e];for(let e=0;e<t.length;++e)for(let i of t[e].children)t.push(i);for(let e of t)this.dce._video||!e.classList.contains("dce-video")&&!e.classList.contains("dbrScanner-video")?this.dce._bgLoading||!e.classList.contains("dce-bg-loading")&&!e.classList.contains("dbrScanner-bg-loading")?this.dce._bgCamera||!e.classList.contains("dce-bg-camera")&&!e.classList.contains("dbrScanner-bg-camera")?!this._cvsDrawArea&&e.classList.contains("dbrScanner-cvs-drawarea")?this._cvsDrawArea=e:!this._divScanArea&&e.classList.contains("dbrScanner-cvs-scanarea")?this._divScanArea=e:!this._divScanLight&&e.classList.contains("dbrScanner-scanlight")?this._divScanLight=e:this.dce._selCam||!e.classList.contains("dce-sel-camera")&&!e.classList.contains("dbrScanner-sel-camera")?!this.dce._selRsl&&e.classList.contains("dbrScanner-sel-resolution")?(this.dce._selRsl=e,this.dce._selRsl.options.length||(this.dce._selRsl.innerHTML=[this.dce._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920 x 1080</option>','<option data-width="1280" data-height="720">ask 1280 x 720</option>','<option data-width="640" data-height="480">ask 640 x 480</option>'].join(""),this.dce._optGotRsl=this.dce._optGotRsl||this.dce._selRsl.options[0])):this.dce._optGotRsl||!e.classList.contains("dce-opt-gotResolution")&&!e.classList.contains("dbrScanner-opt-gotResolution")?this.dce._btnClose||!e.classList.contains("dce-btn-close")&&!e.classList.contains("dbrScanner-btn-close")?this.dce._video||!e.classList.contains("dce-existingVideo")&&!e.classList.contains("dbrScanner-existingVideo")||(this.dce._video=e,this.dce._video.setAttribute("playsinline","true"),this.dce.singleFrameMode=!1):this.dce._btnClose=e:this.dce._optGotRsl=e:this.dce._selCam=e:this.dce._bgCamera=e:this.dce._bgLoading=e:(this.dce._video=e,this.dce._video.setAttribute("playsinline","true"));if(this.dce._bindUI(),this._selCam=this.dce._selCam,this._selRsl=this.dce._selRsl,this._btnClose=this.dce._btnClose,this.singleFrameMode&&(this._cvsDrawArea&&(this._cvsDrawArea.addEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="pointer",this._cvsDrawArea.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo"))),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),!this.dce.video)throw this._unbindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.")}_unbindUI(){this._clearRegionsults(),this.singleFrameMode&&(this._cvsDrawArea&&(this._cvsDrawArea.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="",this._cvsDrawArea.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title"))),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.dce._unbindUI(),this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._selCam=null,this._selRsl=null,this._btnClose=null}set onPlayed(e){this.dce.onPlayed=e}get onPlayed(){return this.dce.onPlayed}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}getAllCameras(){return d(this,void 0,void 0,(function*(){return this.dce.getAllCameras()}))}getCurrentCamera(){return d(this,void 0,void 0,(function*(){return this.dce.getSelectedCamera()}))}setCurrentCamera(e){return d(this,void 0,void 0,(function*(){return this.dce.selectCamera(e)}))}getResolution(){return this.dce.getResolution()}setResolution(e,t){return d(this,void 0,void 0,(function*(){return this.dce.setResolution(e,t)}))}getScanSettings(){return d(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=u._nextTaskID++;u._taskCallbackMap.set(i,(i=>{if(i.success){let t=i.results;return t.intervalTime=this.intervalTime,e(t)}{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}})),u._dbrWorker.postMessage({type:"getScanSettings",id:i,instanceID:this._instanceID})}))}))}updateScanSettings(e){return d(this,void 0,void 0,(function*(){return this.intervalTime=e.intervalTime,yield new Promise(((t,i)=>{let n=u._nextTaskID++;u._taskCallbackMap.set(n,(e=>{if(e.success)return t();{let t=new Error(e.message);return t.stack+="\n"+e.stack,i(t)}})),h._dbrWorker.postMessage({type:"updateScanSettings",id:n,instanceID:this._instanceID,body:{settings:e}})}))}))}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}_show(){let e=this.getUIElement();e.parentNode||(e.style.position="fixed",e.style.left="0",e.style.top="0",document.body.append(e)),"none"==e.style.display&&(e.style.display="")}stop(){this.dce.stop(),this._divScanLight&&(this._divScanLight.style.display="none"),this._drawRegionsults(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause(),this._divScanLight&&(this._divScanLight.style.display="none")}play(e,t,i){return d(this,void 0,void 0,(function*(){return this.dce.play(e,t,i)}))}pauseScan(){this._assertOpen(),this._bPauseScan=!0,this._divScanLight&&(this._divScanLight.style.display="none")}resumeScan(){this._assertOpen(),this._bPauseScan=!1}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}applyConstraints(e){return d(this,void 0,void 0,(function*(){return this.dce.applyConstraints(e)}))}turnOnTorch(){return d(this,void 0,void 0,(function*(){return this.dce.turnOnTorch()}))}turnOffTorch(){return d(this,void 0,void 0,(function*(){return this.dce.turnOffTorch()}))}setColorTemperature(e){return d(this,void 0,void 0,(function*(){return this.dce.setColorTemperature(e)}))}setExposureCompensation(e){return d(this,void 0,void 0,(function*(){return this.dce.setExposureCompensation(e)}))}setZoom(e){return d(this,void 0,void 0,(function*(){return this.dce.setZoom(e)}))}setFrameRate(e){return d(this,void 0,void 0,(function*(){return this.dce.setFrameRate(e)}))}getFrameRate(){return this.dce.getFrameRate()}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}_loopReadVideo(){return d(this,void 0,void 0,(function*(){if(this.bDestroyed)return void this.dce.stopFetchingLoop();if(!this.isOpen())return this.dce.stopFetchingLoop(),void(yield this.clearMapDecodeRecord());if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return u._onLog&&u._onLog("Video or scan is paused. Ask in 1s."),this.dce.stopFetchingLoop(),yield this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display=""),u._onLog&&u._onLog("======= once read ======="),u._onLog&&(this._timeStartDecode=Date.now());let t=this._getVideoFrame();if(!t)return this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(()=>d(this,void 0,void 0,(function*(){if(t&&null===t.canvas){let{data:i,width:n,height:r,timeStamp:o}=t,s={timeStamp:o};return yield this._decodeBuffer_Uint8Array(i,n,r,n,e.EnumImagePixelFormat.IPF_GrayScaled,s)}if(t&&t.canvas){let{data:i,canvas:n,region:r,sx:o,sy:s,width:a,height:d,timeStamp:_}=t,l={timeStamp:_};(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=n);let c=yield this._decodeBuffer_Uint8Array(i,n.width,n.height,4*n.width,e.EnumImagePixelFormat.IPF_ABGR_8888,l);return u.fixResultLocationWhenFilterRegionInJs(r,c,o,s,n.width,n.height,a,d),c}{let e=new Error("imgData is empty.");return new Promise((t=>t(e)))}})))().then((e=>{u._onLog&&u._onLog(e);let t=this.array_decodeFrameTimeCost,i=this.array_getFrameTimeCost,n=this._indexCurrentDecodingFrame;if((()=>{if(this.region instanceof Array){for(t[n]&&t[n]instanceof Array||(t[n]=[]);t[n].length>=5;)t[n].shift();t[n].push(this._lastInnerDecodeDuration)}else{for(;t.length>=5;)t.shift();t.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=(()=>{let e=0;if(this.region instanceof Array){let r=0,o=0;r=n+1>=this.region.length?0:n+1,o=r+1>=this.region.length?0:r+1,e=t[r]&&t[r].length&&i[o]&&i[o].length?Math.min(...t[r])-Math.max(...i[o]):0}else if(i&&i.length){let n=Math.min(...t),r=Math.max(...i);n&&r&&(e=n-r)}else e=0;return e>0?e:0})()+this.intervalTime,this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unduplicated"===this.bPlaySoundOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}t&&(this.soundOnSuccessfullRead.currentTime=0,this.soundOnSuccessfullRead.play().catch((e=>{console.warn("Autoplay not allowed. User interaction required: "+(e.message||e))})))}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unduplicated"===this.bVibrateOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onFrameRead){let t=this._cloneDecodeResults(e);for(let e of t)delete e.bUnduplicated;this.onFrameRead(t)}if(this.onUniqueRead)for(let t of e)t.bUnduplicated&&this.onUniqueRead(t.barcodeText,this._cloneDecodeResults(t));this._drawRegionsults(e)}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce.stopFetchingLoop(),u._onLog&&u._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}))}_getVideoFrame(){let e=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,e||this.dce.startFetchingLoop(),!this.dce.getQueueLength())return this.dce.loopInterval=0,null;let t=this.dce.getFrameFromBuffer();this._indexCurrentDecodingFrame=this.dce.regionIndex,this.region instanceof Array&&this.dce.regionIndex++;return(e=>{let t=e.timeSpent,i=this.array_getFrameTimeCost;if(this.region instanceof Array){let e=this._indexCurrentDecodingFrame;for(i[e]&&i[e]instanceof Array||(i[e]=[]);i[e].length>=5;)i[e].shift();i[e].push(t)}else{for(;i.length>=5;)i.shift();i.push(t)}})(t),t}_drawRegionsults(e){let t,i,n;if(this.beingLazyDrawRegionsults=!1,this.singleFrameMode){if(!this.oriCanvas)return;t="contain",i=this.oriCanvas.width,n=this.oriCanvas.height}else{if(!this.dce.video)return;t=this.dce.video.style.objectFit||"contain",i=this.dce.video.videoWidth,n=this.dce.video.videoHeight}let r=this.region;if(r&&(!r.regionLeft&&!r.regionRight&&!r.regionTop&&!r.regionBottom&&!r.regionMeasuredByPercentage||r instanceof Array?r=null:r.regionMeasuredByPercentage?r=r.regionLeft||r.regionRight||100!==r.regionTop||100!==r.regionBottom?{regionLeft:Math.round(r.regionLeft/100*i),regionTop:Math.round(r.regionTop/100*n),regionRight:Math.round(r.regionRight/100*i),regionBottom:Math.round(r.regionBottom/100*n)}:null:(r=JSON.parse(JSON.stringify(r)),delete r.regionMeasuredByPercentage)),this._cvsDrawArea){this._cvsDrawArea.style.objectFit=t;let o=this._cvsDrawArea;o.width=i,o.height=n;let s=o.getContext("2d");if(r){s.fillStyle=this.regionMaskFillStyle,s.fillRect(0,0,o.width,o.height),s.globalCompositeOperation="destination-out",s.fillStyle="#000";let e=Math.round(this.regionMaskLineWidth/2);s.fillRect(r.regionLeft-e,r.regionTop-e,r.regionRight-r.regionLeft+2*e,r.regionBottom-r.regionTop+2*e),s.globalCompositeOperation="source-over",s.strokeStyle=this.regionMaskStrokeStyle,s.lineWidth=this.regionMaskLineWidth,s.rect(r.regionLeft,r.regionTop,r.regionRight-r.regionLeft,r.regionBottom-r.regionTop),s.stroke()}if(e){s.globalCompositeOperation="destination-over",s.fillStyle=this.barcodeFillStyle,s.strokeStyle=this.barcodeStrokeStyle,s.lineWidth=this.barcodeLineWidth,e=e||[];for(let t of e){let e=t.localizationResult;s.beginPath(),s.moveTo(e.x1,e.y1),s.lineTo(e.x2,e.y2),s.lineTo(e.x3,e.y3),s.lineTo(e.x4,e.y4),s.fill(),s.beginPath(),s.moveTo(e.x1,e.y1),s.lineTo(e.x2,e.y2),s.lineTo(e.x3,e.y3),s.lineTo(e.x4,e.y4),s.closePath(),s.stroke()}}this.singleFrameMode&&(s.globalCompositeOperation="destination-over",s.drawImage(this.oriCanvas,0,0))}if(this._divScanArea&&this.dce.video){let e=this.dce.video.offsetWidth,t=this.dce.video.offsetHeight,o=1;e/t<i/n?(o=e/i,this._divScanArea.style.left="0",this._divScanArea.style.top=Math.round((t-n*o)/2)+"px"):(o=t/n,this._divScanArea.style.left=Math.round((e-i*o)/2)+"px",this._divScanArea.style.top="0");let s=r?Math.round(r.regionLeft*o):0,a=r?Math.round(r.regionTop*o):0,d=r?Math.round(r.regionRight*o-s):Math.round(i*o),_=r?Math.round(r.regionBottom*o-a):Math.round(n*o);this._divScanArea.style.marginLeft=s+"px",this._divScanArea.style.marginTop=a+"px",this._divScanArea.style.width=d+"px",this._divScanArea.style.height=_+"px"}}_clearRegionsults(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)}open(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.play();return this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),e}))}openVideo(){return d(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.play();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),e}))}close(){return d(this,void 0,void 0,(function*(){this.stop(),this._unbindUI(),this._bPauseScan=!1}))}show(){return d(this,void 0,void 0,(function*(){this._bindUI(),this._show();let e=yield this.play();return this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),e}))}showVideo(){return d(this,void 0,void 0,(function*(){this._bindUI(),this._show();let e=yield this.play();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),e}))}hide(){return d(this,void 0,void 0,(function*(){this.stop(),this._unbindUI(),this._bPauseScan=!1,this.getUIElement().style.display="none"}))}destroy(){return this.destroyContext()}destroyContext(){const e=Object.create(null,{destroyContext:{get:()=>super.destroyContext}});return d(this,void 0,void 0,(function*(){yield this.close(),this.bDestroyed||(yield e.destroyContext.call(this))}))}}var E,R,m,I,A,D,S,f,T,M,C,y,L,O,p,v,B,N,b,F,P,w,V,U,k,G,x;h._defaultUIElementURL="@engineResourcePath/dbr.scanner.html",h.singlePresetRegion=[null,{regionLeft:0,regionTop:30,regionRight:100,regionBottom:70,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1}],e.EnumBarcodeColourMode=void 0,(E=e.EnumBarcodeColourMode||(e.EnumBarcodeColourMode={}))[E.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",E[E.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",E[E.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",E[E.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",E[E.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",E[E.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",E[E.BICM_SKIP=0]="BICM_SKIP",E[E.BICM_REV=2147483648]="BICM_REV",e.EnumBarcodeComplementMode=void 0,(R=e.EnumBarcodeComplementMode||(e.EnumBarcodeComplementMode={}))[R.BCM_AUTO=1]="BCM_AUTO",R[R.BCM_GENERAL=2]="BCM_GENERAL",R[R.BCM_SKIP=0]="BCM_SKIP",R[R.BCM_REV=2147483648]="BCM_REV",e.EnumBarcodeFormat_2=void 0,(m=e.EnumBarcodeFormat_2||(e.EnumBarcodeFormat_2={}))[m.BF2_NULL=0]="BF2_NULL",m[m.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",m[m.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",m[m.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",m[m.BF2_POSTNET=2097152]="BF2_POSTNET",m[m.BF2_PLANET=4194304]="BF2_PLANET",m[m.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",m[m.BF2_RM4SCC=16777216]="BF2_RM4SCC",m[m.BF2_DOTCODE=2]="BF2_DOTCODE",e.EnumBinarizationMode=void 0,(I=e.EnumBinarizationMode||(e.EnumBinarizationMode={}))[I.BM_AUTO=1]="BM_AUTO",I[I.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",I[I.BM_SKIP=0]="BM_SKIP",I[I.BM_THRESHOLD=4]="BM_THRESHOLD",I[I.BM_REV=2147483648]="BM_REV",e.EnumClarityCalculationMethod=void 0,(A=e.EnumClarityCalculationMethod||(e.EnumClarityCalculationMethod={}))[A.ECCM_CONTRAST=1]="ECCM_CONTRAST",e.EnumClarityFilterMode=void 0,(D=e.EnumClarityFilterMode||(e.EnumClarityFilterMode={}))[D.CFM_GENERAL=1]="CFM_GENERAL",e.EnumColourClusteringMode=void 0,(S=e.EnumColourClusteringMode||(e.EnumColourClusteringMode={}))[S.CCM_AUTO=1]="CCM_AUTO",S[S.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",S[S.CCM_SKIP=0]="CCM_SKIP",S[S.CCM_REV=2147483648]="CCM_REV",e.EnumColourConversionMode=void 0,(f=e.EnumColourConversionMode||(e.EnumColourConversionMode={}))[f.CICM_GENERAL=1]="CICM_GENERAL",f[f.CICM_SKIP=0]="CICM_SKIP",f[f.CICM_REV=2147483648]="CICM_REV",e.EnumConflictMode=void 0,(T=e.EnumConflictMode||(e.EnumConflictMode={}))[T.CM_IGNORE=1]="CM_IGNORE",T[T.CM_OVERWRITE=2]="CM_OVERWRITE",e.EnumDeblurMode=void 0,(M=e.EnumDeblurMode||(e.EnumDeblurMode={}))[M.DM_SKIP=0]="DM_SKIP",M[M.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",M[M.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",M[M.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",M[M.DM_SMOOTHING=8]="DM_SMOOTHING",M[M.DM_MORPHING=16]="DM_MORPHING",M[M.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",M[M.DM_SHARPENING=64]="DM_SHARPENING",M[M.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",M[M.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e.EnumDeformationResistingMode=void 0,(C=e.EnumDeformationResistingMode||(e.EnumDeformationResistingMode={}))[C.DRM_AUTO=1]="DRM_AUTO",C[C.DRM_GENERAL=2]="DRM_GENERAL",C[C.DRM_SKIP=0]="DRM_SKIP",C[C.DRM_REV=2147483648]="DRM_REV",e.EnumDPMCodeReadingMode=void 0,(y=e.EnumDPMCodeReadingMode||(e.EnumDPMCodeReadingMode={}))[y.DPMCRM_AUTO=1]="DPMCRM_AUTO",y[y.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",y[y.DPMCRM_SKIP=0]="DPMCRM_SKIP",y[y.DPMCRM_REV=2147483648]="DPMCRM_REV",e.EnumGrayscaleTransformationMode=void 0,(L=e.EnumGrayscaleTransformationMode||(e.EnumGrayscaleTransformationMode={}))[L.GTM_INVERTED=1]="GTM_INVERTED",L[L.GTM_ORIGINAL=2]="GTM_ORIGINAL",L[L.GTM_SKIP=0]="GTM_SKIP",L[L.GTM_REV=2147483648]="GTM_REV",e.EnumImagePreprocessingMode=void 0,(O=e.EnumImagePreprocessingMode||(e.EnumImagePreprocessingMode={}))[O.IPM_AUTO=1]="IPM_AUTO",O[O.IPM_GENERAL=2]="IPM_GENERAL",O[O.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",O[O.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",O[O.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",O[O.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",O[O.IPM_SKIP=0]="IPM_SKIP",O[O.IPM_REV=2147483648]="IPM_REV",e.EnumIntermediateResultSavingMode=void 0,(p=e.EnumIntermediateResultSavingMode||(e.EnumIntermediateResultSavingMode={}))[p.IRSM_MEMORY=1]="IRSM_MEMORY",p[p.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",p[p.IRSM_BOTH=4]="IRSM_BOTH",e.EnumIntermediateResultType=void 0,(v=e.EnumIntermediateResultType||(e.EnumIntermediateResultType={}))[v.IRT_NO_RESULT=0]="IRT_NO_RESULT",v[v.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",v[v.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",v[v.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",v[v.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",v[v.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",v[v.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",v[v.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",v[v.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",v[v.IRT_CONTOUR=256]="IRT_CONTOUR",v[v.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",v[v.IRT_FORM=1024]="IRT_FORM",v[v.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",v[v.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",v[v.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL",e.EnumLocalizationMode=void 0,(B=e.EnumLocalizationMode||(e.EnumLocalizationMode={}))[B.LM_SKIP=0]="LM_SKIP",B[B.LM_AUTO=1]="LM_AUTO",B[B.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",B[B.LM_LINES=8]="LM_LINES",B[B.LM_STATISTICS=4]="LM_STATISTICS",B[B.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",B[B.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",B[B.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",B[B.LM_CENTRE=128]="LM_CENTRE",B[B.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",B[B.LM_REV=2147483648]="LM_REV",e.EnumPDFReadingMode=void 0,(N=e.EnumPDFReadingMode||(e.EnumPDFReadingMode={}))[N.PDFRM_RASTER=1]="PDFRM_RASTER",N[N.PDFRM_AUTO=2]="PDFRM_AUTO",N[N.PDFRM_VECTOR=4]="PDFRM_VECTOR",N[N.PDFRM_REV=2147483648]="PDFRM_REV",e.EnumQRCodeErrorCorrectionLevel=void 0,(b=e.EnumQRCodeErrorCorrectionLevel||(e.EnumQRCodeErrorCorrectionLevel={}))[b.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",b[b.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",b[b.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",b[b.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q",e.EnumRegionPredetectionMode=void 0,(F=e.EnumRegionPredetectionMode||(e.EnumRegionPredetectionMode={}))[F.RPM_AUTO=1]="RPM_AUTO",F[F.RPM_GENERAL=2]="RPM_GENERAL",F[F.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",F[F.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",F[F.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",F[F.RPM_SKIP=0]="RPM_SKIP",F[F.RPM_REV=2147483648]="RPM_REV",e.EnumResultCoordinateType=void 0,(P=e.EnumResultCoordinateType||(e.EnumResultCoordinateType={}))[P.RCT_PIXEL=1]="RCT_PIXEL",P[P.RCT_PERCENTAGE=2]="RCT_PERCENTAGE",e.EnumResultType=void 0,(w=e.EnumResultType||(e.EnumResultType={}))[w.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",w[w.RT_RAW_TEXT=1]="RT_RAW_TEXT",w[w.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",w[w.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT",e.EnumScaleUpMode=void 0,(V=e.EnumScaleUpMode||(e.EnumScaleUpMode={}))[V.SUM_AUTO=1]="SUM_AUTO",V[V.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",V[V.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",V[V.SUM_SKIP=0]="SUM_SKIP",V[V.SUM_REV=2147483648]="SUM_REV",e.EnumTerminatePhase=void 0,(U=e.EnumTerminatePhase||(e.EnumTerminatePhase={}))[U.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",U[U.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",U[U.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",U[U.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",U[U.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",U[U.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED",e.EnumTextFilterMode=void 0,(k=e.EnumTextFilterMode||(e.EnumTextFilterMode={}))[k.TFM_AUTO=1]="TFM_AUTO",k[k.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",k[k.TFM_SKIP=0]="TFM_SKIP",k[k.TFM_REV=2147483648]="TFM_REV",e.EnumTextResultOrderMode=void 0,(G=e.EnumTextResultOrderMode||(e.EnumTextResultOrderMode={}))[G.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",G[G.TROM_POSITION=2]="TROM_POSITION",G[G.TROM_FORMAT=4]="TROM_FORMAT",G[G.TROM_SKIP=0]="TROM_SKIP",G[G.TROM_REV=2147483648]="TROM_REV",e.EnumTextureDetectionMode=void 0,(x=e.EnumTextureDetectionMode||(e.EnumTextureDetectionMode={}))[x.TDM_AUTO=1]="TDM_AUTO",x[x.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",x[x.TDM_SKIP=0]="TDM_SKIP",x[x.TDM_REV=2147483648]="TDM_REV";class W{static get version(){return u.version}static get productKeys(){return u.productKeys}static set productKeys(e){u.productKeys=e}static get handshakeCode(){return u.handshakeCode}static set handshakeCode(e){u.handshakeCode=e}static get organizationID(){return u.organizationID}static set organizationID(e){u.organizationID=e}static get sessionPassword(){return u.sessionPassword}static set sessionPassword(e){u.sessionPassword=e}static get browserInfo(){return u.browserInfo}static detectEnvironment(){return u.detectEnvironment()}static get _workerName(){return u._workerName}static set _workerName(e){u._workerName=e}static get engineResourcePath(){return u.engineResourcePath}static set engineResourcePath(e){u.engineResourcePath=e}static get licenseServer(){return u.licenseServer}static set licenseServer(e){u.licenseServer=e}static get deviceFriendlyName(){return u.deviceFriendlyName}static set deviceFriendlyName(e){u.deviceFriendlyName=e}static get _onLog(){return u._onLog}static set _onLog(e){u._onLog=e}static get _bWasmDebug(){return u._bWasmDebug}static set _bWasmDebug(e){u._bWasmDebug=e}static get _bUseFullFeature(){return u._bUseFullFeature}static set _bUseFullFeature(e){u._bUseFullFeature=e}static get _dbrWorker(){return u._dbrWorker}static isLoaded(){return u.isLoaded()}static isWasmLoaded(){return u.isLoaded()}static loadWasm(){return u.loadWasm()}}W.DBR=W,W.BarcodeReader=u,W.BarcodeScanner=h,W.CameraEnhancer=a.default,W.EnumBarcodeColourMode=e.EnumBarcodeColourMode,W.EnumBarcodeComplementMode=e.EnumBarcodeComplementMode,W.EnumBarcodeFormat=e.EnumBarcodeFormat,W.EnumBarcodeFormat_2=e.EnumBarcodeFormat_2,W.EnumBinarizationMode=e.EnumBinarizationMode,W.EnumClarityCalculationMethod=e.EnumClarityCalculationMethod,W.EnumClarityFilterMode=e.EnumClarityFilterMode,W.EnumColourClusteringMode=e.EnumColourClusteringMode,W.EnumColourConversionMode=e.EnumColourConversionMode,W.EnumConflictMode=e.EnumConflictMode,W.EnumDeblurMode=e.EnumDeblurMode,W.EnumDeformationResistingMode=e.EnumDeformationResistingMode,W.EnumDPMCodeReadingMode=e.EnumDPMCodeReadingMode,W.EnumErrorCode=e.EnumErrorCode,W.EnumGrayscaleTransformationMode=e.EnumGrayscaleTransformationMode,W.EnumImagePixelFormat=e.EnumImagePixelFormat,W.EnumImagePreprocessingMode=e.EnumImagePreprocessingMode,W.EnumIMResultDataType=e.EnumIMResultDataType,W.EnumIntermediateResultSavingMode=e.EnumIntermediateResultSavingMode,W.EnumIntermediateResultType=e.EnumIntermediateResultType,W.EnumLocalizationMode=e.EnumLocalizationMode,W.EnumPDFReadingMode=e.EnumPDFReadingMode,W.EnumQRCodeErrorCorrectionLevel=e.EnumQRCodeErrorCorrectionLevel,W.EnumRegionPredetectionMode=e.EnumRegionPredetectionMode,W.EnumResultCoordinateType=e.EnumResultCoordinateType,W.EnumResultType=e.EnumResultType,W.EnumScaleUpMode=e.EnumScaleUpMode,W.EnumTerminatePhase=e.EnumTerminatePhase,W.EnumTextFilterMode=e.EnumTextFilterMode,W.EnumTextResultOrderMode=e.EnumTextResultOrderMode,W.EnumTextureDetectionMode=e.EnumTextureDetectionMode,Object.defineProperty(e,"CameraEnhancer",{enumerable:!0,get:function(){return a.default}}),e.BarcodeReader=u,e.BarcodeScanner=h,e.DBR=W,e.default=W,Object.defineProperty(e,"__esModule",{value:!0})}));
