/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 9.0.0 (js 20220322)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft.DBR={}))}(this,(function(e){"use strict";function t(e,t,i,o){return new(i||(i=Promise))((function(r,n){function s(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))}var i,o,r,n;e.EnumImagePixelFormat=void 0,(i=e.EnumImagePixelFormat||(e.EnumImagePixelFormat={}))[i.IPF_Binary=0]="IPF_Binary",i[i.IPF_BinaryInverted=1]="IPF_BinaryInverted",i[i.IPF_GrayScaled=2]="IPF_GrayScaled",i[i.IPF_NV21=3]="IPF_NV21",i[i.IPF_RGB_565=4]="IPF_RGB_565",i[i.IPF_RGB_555=5]="IPF_RGB_555",i[i.IPF_RGB_888=6]="IPF_RGB_888",i[i.IPF_ARGB_8888=7]="IPF_ARGB_8888",i[i.IPF_RGB_161616=8]="IPF_RGB_161616",i[i.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",i[i.IPF_ABGR_8888=10]="IPF_ABGR_8888",i[i.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",i[i.IPF_BGR_888=12]="IPF_BGR_888",e.EnumErrorCode=void 0,(o=e.EnumErrorCode||(e.EnumErrorCode={}))[o.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",o[o.DBR_SUCCESS=0]="DBR_SUCCESS",o[o.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",o[o.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",o[o.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",o[o.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",o[o.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",o[o.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",o[o.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",o[o.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",o[o.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",o[o.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",o[o.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",o[o.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",o[o.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",o[o.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",o[o.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",o[o.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",o[o.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",o[o.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",o[o.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",o[o.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",o[o.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",o[o.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",o[o.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",o[o.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",o[o.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",o[o.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",o[o.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",o[o.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",o[o.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",o[o.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",o[o.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",o[o.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",o[o.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",o[o.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",o[o.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",o[o.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",o[o.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",o[o.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",o[o.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",o[o.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",o[o.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",o[o.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",o[o.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",o[o.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",o[o.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",o[o.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",o[o.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",o[o.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",o[o.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",o[o.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",o[o.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",o[o.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",o[o.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",o[o.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",o[o.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",o[o.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",o[o.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",o[o.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",o[o.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",o[o.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS",e.EnumIMResultDataType=void 0,(r=e.EnumIMResultDataType||(e.EnumIMResultDataType={}))[r.IMRDT_IMAGE=1]="IMRDT_IMAGE",r[r.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",r[r.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",r[r.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",r[r.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",r[r.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL",e.EnumBarcodeFormat=void 0,(n=e.EnumBarcodeFormat||(e.EnumBarcodeFormat={}))[n.BF_ALL=4265607167]="BF_ALL",n[n.BF_ONED=3147775]="BF_ONED",n[n.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",n[n.BF_CODE_39=1]="BF_CODE_39",n[n.BF_CODE_128=2]="BF_CODE_128",n[n.BF_CODE_93=4]="BF_CODE_93",n[n.BF_CODABAR=8]="BF_CODABAR",n[n.BF_ITF=16]="BF_ITF",n[n.BF_EAN_13=32]="BF_EAN_13",n[n.BF_EAN_8=64]="BF_EAN_8",n[n.BF_UPC_A=128]="BF_UPC_A",n[n.BF_UPC_E=256]="BF_UPC_E",n[n.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",n[n.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",n[n.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",n[n.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",n[n.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",n[n.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",n[n.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",n[n.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",n[n.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",n[n.BF_PATCHCODE=262144]="BF_PATCHCODE",n[n.BF_PDF417=33554432]="BF_PDF417",n[n.BF_QR_CODE=67108864]="BF_QR_CODE",n[n.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",n[n.BF_AZTEC=268435456]="BF_AZTEC",n[n.BF_MAXICODE=536870912]="BF_MAXICODE",n[n.BF_MICRO_QR=1073741824]="BF_MICRO_QR",n[n.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",n[n.BF_GS1_COMPOSITE=2147483648]="BF_GS1_COMPOSITE",n[n.BF_MSI_CODE=1048576]="BF_MSI_CODE",n[n.BF_CODE_11=2097152]="BF_CODE_11",n[n.BF_NULL=0]="BF_NULL";const s=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),a=!s&&"undefined"==typeof self,d=s?global:a?{}:self;class l{constructor(){this._canvasMaxWH="iPhone"==l.browserInfo.OS||"Android"==l.browserInfo.OS?2048:4096,this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}static get version(){return this._version}static get license(){return this._license}static set license(e){if("unload"!=this._loadWasmStatus)throw new Error("`license` is not allowed to change after `createInstance` or `loadWasm` is called.");l._license=e}static get productKeys(){return this._license}static set productKeys(e){l.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){l.license=e}static get organizationID(){return this._license}static set organizationID(e){l.license=e}static set sessionPassword(e){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after `createInstance` or `loadWasm` is called.");l._sessionPassword=e}static get sessionPassword(){return this._sessionPassword}static detectEnvironment(){return t(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!!(s?process.version>="v12":"undefined"!=typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e&&(e="./"),s||a)l._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,l._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(l._engineResourcePath+="/")}static get licenseServer(){return this._licenseServer}static set licenseServer(e){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e)l._licenseServer=[];else{e instanceof Array||(e=[e]);for(let t=0;t<e.length;++t){if(!s&&!a){let i=document.createElement("a");i.href=e[t],e[t]=i.href}e[t].endsWith("/")||(e[t]+="/")}l._licenseServer=e}}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after `createInstance` or `loadWasm` is called.");l._deviceFriendlyName=e||""}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");l.__bUseFullFeature=e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isWasmLoaded(){return"loadSuccess"==this._loadWasmStatus}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static loadWasm(){return t(this,void 0,void 0,(function*(){switch(l._loadWasmStatus){case"unload":{if(s&&process.version<"v12")throw new Error("DBRJS SDK requires nodejs version >= v12.");let i,o=l._license,r=JSON.parse(JSON.stringify(l._licenseServer)),n=l._sessionPassword,a=null,h=null,c=0;if(o.startsWith("t")||o.startsWith("f"))c=0;else if(0===o.length||o.startsWith("P")||o.startsWith("L")||o.startsWith("Y")||o.startsWith("A"))c=1;else{c=2;const e=o.indexOf(":");if(-1!=e&&(o=o.substring(e+1)),o.startsWith("DLS2")){let e=o.substring(4);e=s?Buffer.from(e,"base64").toString("binary"):atob(e);const t=JSON.parse(e);if(t.handshakeCode?o=t.handshakeCode:t.organizationID&&(o=t.organizationID),"number"==typeof o&&(o=JSON.stringify(o)),o||(o=""),0===r.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),l.licenseServer=e,r=l.licenseServer}!n&&t.sessionPassword&&(n=t.sessionPassword),t.chargeWay&&(h=t.chargeWay),t.limitedLicenseModules&&(a=t.limitedLicenseModules)}}if(c&&(s?process.version<"v15"&&(i="To use online key requires nodejs version >= v15."):(d.crypto||(i="Please upgrade your browser to support online key."),d.crypto.subtle||(i="Require https to use online key in this browser."))),i){if(1!==c)throw new Error(i);c=0,console.warn(i),l._lastErrorCode=e.EnumErrorCode.DMERR_FAILED_TO_REACH_LTS,l._lastErrorString=i}1===c&&(o="",console.warn("Applying for a public trial license ...")),l._loadWasmStatus="loading";let _=l.engineResourcePath+l._workerName;if(s||l.engineResourcePath.startsWith(location.origin)||(_=yield fetch(_).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),s){const e=yield import("worker_threads");l._dbrWorker=new e.Worker(_)}else l._dbrWorker=new Worker(_);l._dbrWorker.onerror=e=>{l._loadWasmStatus="loadFail";let t=new Error(e.message);l._loadWasmErr=t;for(let e of l._loadWasmCallbackArr)e(t);l._loadWasmCallbackArr=[]},l._dbrWorker.onmessage=e=>t(this,void 0,void 0,(function*(){let t=e.data?e.data:e;switch(t.type){case"log":l._onLog&&l._onLog(t.message);break;case"load":{t.message&&(t.message=t.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let e=!1;if(1===c&&(e=!0),t.success){l._loadWasmStatus="loadSuccess",l._version=t.version+"(JS "+l._jsVersion+"."+l._jsEditVersion+")",l._onLog&&l._onLog("load dbr worker success");for(let e of l._loadWasmCallbackArr)e();l._loadWasmCallbackArr=[],l._dbrWorker.onerror=null,t.message&&console.warn(t.message)}else{let i=new Error(t.message);i.stack=t.stack+"\n"+i.stack,l._loadWasmStatus="loadFail",l._loadWasmErr=i;for(let e of l._loadWasmCallbackArr)e(i);l._loadWasmCallbackArr=[],e||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(e=!0)}e&&l.showDialog(t.success?"warn":"error",t.message);break}case"task":{let e=t.id,i=t.body;try{l._taskCallbackMap.get(e)(i),l._taskCallbackMap.delete(e)}catch(t){throw l._taskCallbackMap.delete(e),t}break}default:l._onLog&&l._onLog(e)}})),s&&l._dbrWorker.on("message",l._dbrWorker.onmessage),l._dbrWorker.postMessage({type:"loadWasm",bd:l._bWasmDebug,engineResourcePath:l.engineResourcePath,version:l._jsVersion,brtk:!!c,bptk:1===c,lcs:o,dm:!s&&location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:l._bUseFullFeature,browserInfo:l.browserInfo,deviceFriendlyName:l.deviceFriendlyName,ls:r,sp:n,lm:a,cw:h})}case"loading":yield new Promise(((e,t)=>{l._loadWasmCallbackArr.push((i=>{i?t(i):e()}))}));break;case"loadSuccess":break;case"loadFail":throw l._loadWasmErr;default:throw new Error("Unexpected status")}}))}static showDialog(e,i){return t(this,void 0,void 0,(function*(){if(!s&&!l._bNeverShowDialog)try{let t=yield fetch(l.engineResourcePath+"dls.license.dialog.html");if(!t.ok)throw Error("Get license dialog fail. Network Error: "+t.statusText);let o=yield t.text();if(!o.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let r=document.createElement("div");r.innerHTML=o;let n=[];for(let e=0;e<r.childElementCount;++e){let t=r.children[e];t instanceof HTMLStyleElement&&(n.push(t),document.head.append(t))}let s=1==r.childElementCount?r.children[0]:r;s.remove();let a,d,h,c,_,g=[s],u=s.children;for(let e of u)g.push(e);for(let e=0;e<g.length;++e)for(let t of g[e].children)g.push(t);for(let t of g)if(!a&&t.classList.contains("dls-license-mask"))a=t,t.addEventListener("click",(e=>{if(t==e.target){s.remove();for(let e of n)e.remove()}}));else if(!d&&t.classList.contains("dls-license-icon-close"))d=t,t.addEventListener("click",(()=>{s.remove();for(let e of n)e.remove()}));else if(!h&&t.classList.contains("dls-license-icon-error"))h=t,"error"!=e&&t.remove();else if(!c&&t.classList.contains("dls-license-icon-warn"))c=t,"warn"!=e&&t.remove();else if(!_&&t.classList.contains("dls-license-msg-content")){_=t;let e=i;for(;e;){let i=e.indexOf("["),o=e.indexOf("]",i),r=e.indexOf("(",o),n=e.indexOf(")",r);if(-1==i||-1==o||-1==r||-1==n){t.appendChild(new Text(e));break}i>0&&t.appendChild(new Text(e.substring(0,i)));let s=document.createElement("a"),a=e.substring(i+1,o);s.innerText=a;let d=e.substring(r+1,n);s.setAttribute("href",d),s.setAttribute("target","_blank"),t.appendChild(s),e=e.substring(n+1)}}document.body.appendChild(s)}catch(e){l._onLog&&l._onLog(e.message||e)}}))}static createInstanceInWorker(e=!1){return t(this,void 0,void 0,(function*(){return yield l.loadWasm(),yield new Promise(((t,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),l._dbrWorker.postMessage({type:"createInstance",id:o,bScanner:e})}))}))}static createInstance(){return t(this,void 0,void 0,(function*(){let e=new l;return e._instanceID=yield l.createInstanceInWorker(),e}))}decode(e){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("decode(source: any)"),l._onLog&&(this._timeStartDecode=Date.now()),s)return e instanceof Buffer?yield this._decodeFileInMemory_Uint8Array(new Uint8Array(e)):e instanceof Uint8Array?yield this._decodeFileInMemory_Uint8Array(e):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e):"http"==e.substring(0,4)?yield this._decode_Url(e):yield this._decode_FilePath(e):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Buffer', 'Uint8Array', 'String(base64 with image mime)' or 'String(url)'."));{let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?yield this._decode_Blob(e,t):e instanceof ArrayBuffer?yield this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yield this._decode_Image(e,t):e instanceof HTMLCanvasElement?yield this._decode_Canvas(e,t):e instanceof HTMLVideoElement?yield this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e,t):yield this._decode_Url(e,t):e&&"object"==typeof e?yield this._decode_DCEFrame(e,t):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}))}decodeBase64String(e){return t(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}))}decodeUrl(e){return t(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}))}_decodeBuffer_Uint8Array(e,i,o,r,n,s){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,a)=>{let d=l._nextTaskID++;l._taskCallbackMap.set(d,(e=>{if(e.success){let i,o=l._onLog?Date.now():0;l._onLog&&l._onLog("worker return result: "+o),this._lastInnerDecodeDuration=e.duration;try{i=this._handleRetJsonString(e.decodeReturn)}catch(e){return a(e)}if(l._onLog){let e=Date.now();l._onLog("DBR time get result: "+o),l._onLog("Handle image cost: "+(this._timeEnterInnerDBR-this._timeStartDecode)),l._onLog("DBR worker decode image cost: "+(o-this._timeEnterInnerDBR)),l._onLog("DBR worker handle results: "+(e-o)),l._onLog("Total decode image cost: "+(e-this._timeStartDecode))}return t(i)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}})),this._timeEnterInnerDBR=Date.now(),l._onLog&&l._onLog("Send buffer to worker:"+this._timeEnterInnerDBR),l._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:this._instanceID,body:{buffer:e,width:i,height:o,stride:r,format:n,config:s}},[e.buffer]),l._onLog&&s&&s._timeEndGettingFrame&&l._onLog("decode image delay: "+(this._timeEnterInnerDBR-s._timeEndGettingFrame))}))}))}_decodeBuffer_Blob(e,i,o,r,n,s){return t(this,void 0,void 0,(function*(){l._onLog&&l._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const t=e.arrayBuffer?yield e.arrayBuffer():yield new Promise(((t,i)=>{let o=new FileReader;o.readAsArrayBuffer(e),o.onload=()=>{t(o.result)},o.onerror=()=>{i(o.error)}}));return yield this._decodeBuffer_Uint8Array(new Uint8Array(t),i,o,r,n,s)}))}decodeBuffer(e,i,o,r,n,a){return t(this,void 0,void 0,(function*(){let t;return l._onLog&&l._onLog("decodeBuffer(buffer,width,height,stride,format)"),l._onLog&&(this._timeStartDecode=Date.now()),s?e instanceof Uint8Array?t=yield this._decodeBuffer_Uint8Array(e,i,o,r,n,a):e instanceof Buffer&&(t=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),i,o,r,n,a)):e instanceof Uint8Array||e instanceof Uint8ClampedArray?t=yield this._decodeBuffer_Uint8Array(e,i,o,r,n,a):e instanceof ArrayBuffer?t=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),i,o,r,n,a):e instanceof Blob&&(t=yield this._decodeBuffer_Blob(e,i,o,r,n,a)),t}))}_decodeFileInMemory_Uint8Array(e){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(e=>{if(e.success){let o;this._lastInnerDecodeDuration=e.duration;try{o=this._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return t(o)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),l._dbrWorker.postMessage({type:"decodeFileInMemory",id:o,instanceID:this._instanceID,body:{bytes:e}})}))}))}getRuntimeSettings(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success){let t=JSON.parse(i.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),l._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}updateRuntimeSettings(i){return t(this,void 0,void 0,(function*(){let t;if("string"==typeof i)if("speed"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=3,t.expectedBarcodesCount=0,t.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=5,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region}else t=JSON.parse(i);else{if("object"!=typeof i)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(i)),t.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!l._bUseFullFeature){if(0!=(t.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(!s)if(this.bFilterRegionInJs){let e=t.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return yield new Promise(((e,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),l._dbrWorker.postMessage({type:"updateRuntimeSettings",id:o,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})}))}))}resetRuntimeSettings(){return t(this,void 0,void 0,(function*(){return this.userDefinedRegion=null,this.region=null,yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),l._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})}))}))}outputRuntimeSettingsToString(){return t(this,void 0,void 0,(function*(){if(!l._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),l._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:i,instanceID:this._instanceID})}))}))}initRuntimeSettingsWithString(e){return t(this,void 0,void 0,(function*(){if(!l._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise(((t,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),l._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:o,instanceID:this._instanceID,body:{settings:e}})}))}))}_decode_Blob(e,i){return t(this,void 0,void 0,(function*(){l._onLog&&l._onLog("_decode_Blob(blob: Blob)");let t=null,o=null;if("undefined"!=typeof createImageBitmap)try{t=yield createImageBitmap(e)}catch(e){}t||(o=yield function(e){return new Promise(((t,i)=>{let o=URL.createObjectURL(e),r=new Image;r.dbrObjUrl=o,r.src=o,r.onload=()=>{t(r)},r.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let r=yield this._decode_Image(t||o,i);return t&&t.close(),r}))}_decode_ArrayBuffer(e,i){return t(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),i)}))}_decode_Uint8Array(e,i){return t(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),i)}))}_decode_Image(e,i){return t(this,void 0,void 0,(function*(){l._onLog&&l._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),i=i||{};let t,o,r,n,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,d=i.region;if(d){let e,i,r,n;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,i=d.regionTop*a/100,r=d.regionRight*s/100,n=d.regionBottom*a/100):(e=d.regionLeft,i=d.regionTop,r=d.regionRight,n=d.regionBottom),t=e,o=i,s=Math.round(r-e),a=Math.round(n-i)}else t=0,o=0;const h=Math.max(s,a);if(h>this._canvasMaxWH){const e=this._canvasMaxWH/h;s>a?(r=this._canvasMaxWH,n=Math.round(a*e)):(r=Math.round(s*e),n=this._canvasMaxWH)}else r=s,n=a;let c,_;c=document.createElement("canvas"),c.width=r,c.height=n,c.getContext("2d").drawImage(e,t,o,s,a,0,0,r,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),d?(_=JSON.parse(JSON.stringify(i)),delete _.region):_=i;let g=yield this._decode_Canvas(c,_);return l.fixResultLocationWhenFilterRegionInJs(d,g,t,o,s,a,r,n),g}))}_decode_Canvas(i,o){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),i.crossOrigin&&"anonymous"!=i.crossOrigin)throw"cors";this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=i,this.oriCanvasData=null);let t=(i.dbrCtx2d||i.getContext("2d")).getImageData(0,0,i.width,i.height).data;return yield this._decodeBuffer_Uint8Array(t,i.width,i.height,4*i.width,e.EnumImagePixelFormat.IPF_ABGR_8888,o)}))}_decode_Video(e,i){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";i=i||{};let t,o,r,n,s=e.videoWidth,a=e.videoHeight,d=i.region;if(d){let e,i,r,n;d.regionMeasuredByPercentage?(e=d.regionLeft*s/100,i=d.regionTop*a/100,r=d.regionRight*s/100,n=d.regionBottom*a/100):(e=d.regionLeft,i=d.regionTop,r=d.regionRight,n=d.regionBottom),t=e,o=i,s=Math.round(r-e),a=Math.round(n-i)}else t=0,o=0;const h=Math.max(s,a);if(h>this._canvasMaxWH){const e=this._canvasMaxWH/h;s>a?(r=this._canvasMaxWH,n=Math.round(a*e)):(r=Math.round(s*e),n=this._canvasMaxWH)}else r=s,n=a;let c=null;c=document.createElement("canvas"),c.width=r,c.height=n;let _;(c.dbrCtx2d=c.getContext("2d")).drawImage(e,t,o,s,a,0,0,r,n),d?(_=JSON.parse(JSON.stringify(i)),delete _.region):_=i;let g=yield this._decode_Canvas(c,i);return d&&l.fixResultLocationWhenFilterRegionInJs(d,g,t,o,s,a,r,n),g}))}_decode_DCEFrame(i,o){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_DCEFrame(dceFrame)"),!i)return null;let t;if(this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:i.width,height:i.height,colorMode:i.colorMode,data:new Uint8Array(i.data),toCanvas:i.toCanvas}),"grey"===i.colorMode){let{data:o,width:r,height:n,timeStamp:s}=i,a={timeStamp:s};t=yield this._decodeBuffer_Uint8Array(o,r,n,r,e.EnumImagePixelFormat.IPF_GrayScaled,a)}else if("rgba"===i.colorMode){let{data:o,width:r,height:n,timeStamp:s}=i,a={timeStamp:s};t=yield this._decodeBuffer_Uint8Array(o,r,n,4*r,e.EnumImagePixelFormat.IPF_ABGR_8888,a)}else{if("bgra"!==i.colorMode)throw new Error(`Color mode '${i.colorMode}' is not supported.`);{let{data:o,width:r,height:n,timeStamp:s}=i,a={timeStamp:s};t=yield this._decodeBuffer_Uint8Array(o,r,n,4*r,e.EnumImagePixelFormat.IPF_ARGB_8888,a)}}return t}))}_decode_Base64(e,i){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");if("data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1)),s){let t=Buffer.from(e,"base64");return yield this._decodeFileInMemory_Uint8Array(new Uint8Array(t))}{let t=atob(e),o=t.length,r=new Uint8Array(o);for(;o--;)r[o]=t.charCodeAt(o);return yield this._decode_Blob(new Blob([r]),i)}}))}_decode_Url(e,i){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");if(e=e,s){let i=yield new Promise(((i,o)=>t(this,void 0,void 0,(function*(){(e.startsWith("https")?yield import("https"):yield import("http")).get(e,(e=>{if(200==e.statusCode){let t=[];e.on("data",(e=>{t.push(e)})).on("end",(()=>{i(new Uint8Array(Buffer.concat(t)))}))}else o("http get fail, statusCode: "+e.statusCode)}))}))));return yield this._decodeFileInMemory_Uint8Array(i)}{let o=yield new Promise(((i,o)=>{let r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.send(),r.onloadend=()=>t(this,void 0,void 0,(function*(){i(r.response)})),r.onerror=()=>{o(new Error("Network Error: "+r.statusText))}}));return yield this._decode_Blob(o,i)}}))}_decode_FilePath(e,i){return t(this,void 0,void 0,(function*(){if(l._onLog&&l._onLog("_decode_FilePath(path)"),!s)throw Error("'_decode_FilePath(path, config)': The method is only supported in node environment.");if("string"!=typeof e)throw TypeError("'_decode_FilePath(path, config)': Type of 'path' should be 'string'.");const t=yield import("fs");let i=yield new Promise(((i,o)=>{t.readFile(e,((e,t)=>{e?o(e):i(new Uint8Array(t))}))}));return yield this._decodeFileInMemory_Uint8Array(i)}))}static fixResultLocationWhenFilterRegionInJs(e,t,i,o,r,n,s,a){if(e&&t.length>0)for(let e of t){let t=e.localizationResult;2==t.resultCoordinateType&&(t.x1*=.01*s,t.x2*=.01*s,t.x3*=.01*s,t.x4*=.01*s,t.y1*=.01*a,t.y2*=.01*a,t.y3*=.01*a,t.y4*=.01*a);let d=s/r,l=a/n;t.x1=t.x1/d+i,t.x2=t.x2/d+i,t.x3=t.x3/d+i,t.x4=t.x4/d+i,t.y1=t.y1/l+o,t.y2=t.y2/l+o,t.y3=t.y3/l+o,t.y4=t.y4/l+o,2==t.resultCoordinateType&&(t.x1*=100/r,t.x2*=100/r,t.x3*=100/r,t.x4*=100/r,t.y1*=100/n,t.y2*=100/n,t.y3*=100/n,t.y4*=100/n)}}static BarcodeReaderException(t,i){let o,r=e.EnumErrorCode.DBR_UNKNOWN;return"number"==typeof t?(r=t,o=new Error(i)):o=new Error(t),o.code=r,o}_handleRetJsonString(t){let i=e.EnumErrorCode;if(t.textResults){for(let e=0;e<t.textResults.length;e++){let i=t.textResults[e];try{let e=i.barcodeText,t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);try{i.barcodeText=decodeURIComponent(escape(t))}catch(e){i.barcodeText=t}}catch(e){i.barcodeText=""}if(null!=i.exception){l._setWarnnedEx.has(i.exception)||(l._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let i=t.indexOf(":");e[t.substring(0,i)]=t.substring(i+1)})),i.exception=e}}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.exception&&!l._setWarnnedEx.has(t.description)&&(l._setWarnnedEx.add(t.description),console.warn(t.description)),t.textResults}if(t.exception==i.DBR_SUCCESS)return t.data;throw l.BarcodeReaderException(t.exception,t.description)}setModeArgument(e,i,o,r){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,n)=>{let s=l._nextTaskID++;l._taskCallbackMap.set(s,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return n(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,n(t)}})),l._dbrWorker.postMessage({type:"setModeArgument",id:s,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:o,argumentValue:r}})}))}))}getModeArgument(e,i,o){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{let n=l._nextTaskID++;l._taskCallbackMap.set(n,(e=>{if(e.success){let i;try{i=this._handleRetJsonString(e.getReturn)}catch(e){return r(e)}return t(i)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),l._dbrWorker.postMessage({type:"getModeArgument",id:n,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:o}})}))}))}getIntermediateResults(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),l._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID})}))}))}getIntermediateCanvas(){return t(this,void 0,void 0,(function*(){let t=yield this.getIntermediateResults(),i=[];for(let o of t)if(o.dataType==e.EnumIMResultDataType.IMRDT_IMAGE)for(let t of o.results){const o=t.bytes;let r;switch(l._onLog&&l._onLog(" "+o.length+" "+o.byteLength+" "+t.width+" "+t.height+" "+t.stride+" "+t.format),t.format){case e.EnumImagePixelFormat.IPF_ABGR_8888:r=new Uint8ClampedArray(o);break;case e.EnumImagePixelFormat.IPF_RGB_888:{const e=o.length/3;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)r[4*t]=o[3*t+2],r[4*t+1]=o[3*t+1],r[4*t+2]=o[3*t],r[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_GrayScaled:{const e=o.length;r=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)r[4*t]=r[4*t+1]=r[4*t+2]=o[t],r[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_Binary:case e.EnumImagePixelFormat.IPF_BinaryInverted:{t.width=8*t.stride,t.height=o.length/t.stride;const e=o.length;r=new Uint8ClampedArray(8*e*4);for(let t=0;t<e;t++){let e=o[t];for(let i=0;i<8;++i)r[4*(8*t+i)]=r[4*(8*t+i)+1]=r[4*(8*t+i)+2]=(128&e)/128*255,r[4*(8*t+i)+3]=255,e<<=1}break}default:console.warn("unknow intermediate image",t)}if(!r)continue;let n=new ImageData(r,t.width,t.height),s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").putImageData(n,0,0),i.push(s)}return i}))}destroyContext(){if(l._onLog&&l._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0;let e=l._nextTaskID++;l._taskCallbackMap.set(e,(e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}})),l._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}
/*!
     * Dynamsoft JavaScript Library
     * @product Dynamsoft Camera Enhancer JS Edition
     * @website https://www.dynamsoft.com
     * @copyright Copyright 2022, Dynamsoft Corporation
     * @author Dynamsoft
     * @version 2.3.1 (js 20220321)
     * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
     * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
     */
function h(e,t,i,o){return new(i||(i=Promise))((function(r,n){function s(e){try{d(o.next(e))}catch(e){n(e)}}function a(e){try{d(o.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((o=o.apply(e,t||[])).next())}))}l._jsVersion="9.0.0",l._jsEditVersion="20220322",l._version="loading...(JS "+l._jsVersion+"."+l._jsEditVersion+")",l._license=s||a||!document.currentScript?"":document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")||"",l._sessionPassword=s||a||!document.currentScript?"":document.currentScript.getAttribute("data-sessionPassword")||"",l.browserInfo=function(){if(!s&&!a){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,o=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(o)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(a)return{browser:"ssr",version:0,OS:"ssr"};if(s){const e={browser:"node",version:process.version.substring(1),OS:"loading"};return(()=>{t(this,void 0,void 0,(function*(){const t=yield import("os");e.OS=t&&t.platform?t.platform()+t.release():"Unknown"}))})(),e}}(),l._workerName="dbr-"+l._jsVersion+".worker.js",l._engineResourcePath=(()=>{if(s)return __dirname+"/";if(!a&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),l._licenseServer=[],l._deviceFriendlyName="",l._isShowRelDecodeTimeInResults=!1,l._bWasmDebug=!1,l._bNeverShowDialog=!1,l.__bUseFullFeature=!0,l._nextTaskID=0,l._taskCallbackMap=new Map,l._loadWasmStatus="unload",l._loadWasmCallbackArr=[],l._lastErrorCode=0,l._lastErrorString="",l._setWarnnedEx=new Set,l._loadWasmErr=null;const c=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),_=!c&&"undefined"==typeof self;class g{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this.predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this.mapCameraResolutions=new Map,this._bWebGLSupported=!0,this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",(()=>h(this,void 0,void 0,(function*(){const t=e.files[0];e.value="";const i=yield(e=>h(this,void 0,void 0,(function*(){let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=yield createImageBitmap(e),t)return t}catch(t){}var o;return t||(i=yield(o=e,new Promise(((e,t)=>{let i=URL.createObjectURL(o),r=new Image;r.dbrObjUrl=i,r.src=i,r.onload=()=>{e(r)},r.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})))(t),o=i instanceof HTMLImageElement?i.naturalWidth:i.width,r=i instanceof HTMLImageElement?i.naturalHeight:i.height;this._imgWidth=o,this._imgHeight=r,(e=>{if(!this._cvsSingleFrameMode){if(this._cvsSingleFrameMode=document.createElement("canvas"),this._cvsSingleFrameMode.className="cvs-single-frame-mode",this._cvsSingleFrameMode.addEventListener("click",this._clickIptSingleFrameMode),this._cvsSingleFrameMode.style.cursor="pointer",this._cvsSingleFrameMode.setAttribute("title","Take a photo"),!this._video)throw new Error("'video' is null.");this._video.after(this._cvsSingleFrameMode)}const t=this._cvsSingleFrameMode;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit="contain",t.width==o&&t.height==r||(t.width=o,t.height=r);let i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0)})(i),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);const n=(e=>{const t=Date.now();if(0===o||0===r)return null;const i=this._scanRegion,n=this.getFrameSize(o,r,i,this.maxCvsSideLength);if(!n)return null;let s,a;s=o!==n.sWidth||r!==n.sHeight,a=n.sWidth!==n.dWidth||n.sHeight!==n.dHeight;const d=(()=>!(!this._bWebGLSupported||a))(),l={data:null,region:i?JSON.parse(JSON.stringify(i)):null,sx:n.sx,sy:n.sy,width:n.dWidth,height:n.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},h=this._getImageData(e,o,r,n,null,{targetColorMode:this.frameColorMode,bUseWebGL:d});if(!h)return null;const c=Date.now();return g._onLog&&g._onLog("DCE: _getVideoFrame(region?) END: "+c),l.data=h.data,l.colorMode=h.colorMode,l._bUseWebGL=h._bUseWebGL,l.timeSpent=c-t,l.timeStamp=c,l})(i),s=this.mapCameraEvents.get("singleFrameAcquired");for(let e of s)try{const t={data:new Uint8Array(n.data),region:JSON.parse(JSON.stringify(n.region)),sx:n.sx,sy:n.sy,width:n.width,height:n.height,colorMode:n.colorMode,timeSpent:n.timeSpent,timeStamp:n.timeStamp,isCropped:n.isCropped,toCanvas:n.toCanvas,_bUseWebGL:n._bUseWebGL};yield e(t)}catch(e){console.error(e)}})))),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._frameColorMode=void 0,this._defaultFrameColorMode="RGBA",this.currentFSColorMode="rgba",this.ifReuseArrayBufferView=!1,this.maxVideoCvsLength=3,this.canvas=null,this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.toCanvas=function(){const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,"grey"===this.colorMode){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e},this._onCameraSelChange=()=>h(this,void 0,void 0,(function*(){yield this.selectCamera(this._selCam.value),this._bOpen||this.stop()})),this._onResolutionSelChange=()=>h(this,void 0,void 0,(function*(){let e,t;if(this._selRsl&&-1!=this._selRsl.selectedIndex){let i=this._selRsl.options[this._selRsl.selectedIndex];e=i.getAttribute("data-width"),t=i.getAttribute("data-height")}yield this.setResolution(e,t),this._bOpen||this.stop()})),this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{"visible"===document.visibilityState?this._vc_bPlayingVideoBeforeHide&&("Firefox"==g.browserInfo.browser?this.play():this._video.play(),this._vc_bPlayingVideoBeforeHide=!1):this._video&&!this._video.paused&&(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause())},this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._bStoppedByPause=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateCanvasTimeout=500,this.referenceConfigurationArray=[],this._onWindowResize=()=>{this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout((()=>{this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}),this._updateCanvasTimeout)},this.bDestroyed=!1,this.mapCameraEvents=new Map([["cameraOpen",[]],["cameraClose",[]],["cameraChange",[]],["resolutionChange",[]],["played",[]],["singleFrameAcquired",[]],["frameAddedToBuffer",[]]])}static getVersion(){return this._version}static detectEnvironment(){return h(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!!(c?process.version>="v12":"undefined"!=typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");if(null==e&&(e="./"),c||_)g._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,g._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(g._engineResourcePath+="/")}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}set maxCvsSideLength(e){if(e<=0)throw new Error("The 'maxCvsSideLength' should be greater than 0.");this._maxCvsSideLength=e}get maxCvsSideLength(){return void 0!==this._maxCvsSideLength?this._maxCvsSideLength:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxCvsSideLength")?this.referenceConfigurationArray[0].maxCvsSideLength:this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){g._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=g._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",g.engineResourcePath)}getUIElement(){return this.UIElement}setUIElement(e){return h(this,void 0,void 0,(function*(){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if("string"==typeof e||e instanceof String){if(!e.trim().startsWith("<")){let t=yield fetch(e);if(!t.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+t.statusText);e=yield t.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let t=document.createElement("div");t.innerHTML=e;for(let e=0;e<t.childElementCount;++e){let i=t.children[e];i instanceof HTMLStyleElement&&(this.styleEls.push(i),document.head.append(i))}(e=1==t.childElementCount?t.children[0]:t).remove()}this.UIElement=e}))}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._frameColorMode=e}get frameColorMode(){return void 0!==this._frameColorMode?this._frameColorMode:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("frameColorMode")?this.referenceConfigurationArray[0].frameColorMode:this._defaultFrameColorMode}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");let e=[this.UIElement];for(let t=0;t<e.length;++t)for(let i of e[t].children)e.push(i);for(let t of e)if(!this._video&&t.classList.contains("dce-video-container")){const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),t.prepend(e),this._video=e}else!this._divScanArea&&t.classList.contains("dce-scanarea")?this._divScanArea=t:!this._divScanLight&&t.classList.contains("dce-scanlight")?this._divScanLight=t:!this._bgLoading&&t.classList.contains("dce-bg-loading")?this._bgLoading=t:!this._bgCamera&&t.classList.contains("dce-bg-camera")?this._bgCamera=t:!this._selCam&&t.classList.contains("dce-sel-camera")?this._selCam=t:!this._selRsl&&t.classList.contains("dce-sel-resolution")?(this._selRsl=t,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&t.classList.contains("dce-opt-gotResolution")?this._optGotRsl=t:!this._btnClose&&t.classList.contains("dce-btn-close")&&(this._btnClose=t);if(!this._video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'");this.singleFrameMode?(this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="")):this._bgLoading&&(this._bgLoading.style.display=""),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.addEventListener("resize",this._onWindowResize)}_unbindUI(){this.singleFrameMode?(this._video&&(this._video.removeEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="",this._video.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this._cvsViewDecorator&&(this._cvsViewDecorator.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="",this._cvsViewDecorator.removeAttribute("title"));for(let e of this._arrScanRegionOverlays)e&&(e.removeEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="",e.removeAttribute("title"));this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._video&&(this._video.onloadedmetadata=null,this._video.remove()),this._video=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.removeEventListener("resize",this._onWindowResize)}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._bShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this._bShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this._cvsViewDecorator&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this.showScanRegionOverlays();for(let e of this._arrScanRegionOverlays)e&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo"))}}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}set ifSaveLastUsedCamera(e){e?g.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`It is not allowed to set '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}}getVideoFit(){return this.videoFit}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&"none"==this._cvsScanRegion.style.display&&(this._cvsScanRegion.style.display="")}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none")}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){return this._bShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="")}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none")}_checkValidRegion(e){return!(null!==e&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("The region is invalid.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(e.className="cvs-scan-region-overlay-"+this._arrScanRegionOverlays.length,this.singleFrameMode&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo")),this._updateScanRegionOverlay(e),this._arrScanRegionOverlays.length>0){const t=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[t-1].after(e)}else if(this._cvsScanRegion)this._cvsScanRegion.before(e);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._video)throw new Error("'video' is null.");this._video.after(e)}return this._arrScanRegionOverlays.push(e),e}_updateScanRegionOverlay(e){if(!e)return;let t,i,o;if(this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,o="contain";else{if(!this._video)return;t=this._video.videoWidth,i=this._video.videoHeight,o=this.getVideoFit()}if(t<=0||i<=0)return e.width=0,void(e.height=0);const r=this._getRegionInPixels(t,i,this._scanRegion),n=r.regionRight-r.regionLeft,s=r.regionBottom-r.regionTop;e.width==n&&e.height==s||(e.width=n,e.height=s);const a=window.getComputedStyle(this._video),d=parseFloat(a.width),l=parseFloat(a.height),h=d/l,c=t/i;let _,g,u,m,f=1;if("contain"===o)h<c?(f=d/t,_=0,g=(l-i*f)/2):(f=l/i,_=(d-t*f)/2,g=0),_+=r.regionLeft*f,g+=r.regionTop*f,u=(r.regionRight-r.regionLeft)*f,m=(r.regionBottom-r.regionTop)*f;else if("cover"===o)if(h<c){f=l/i,_=r.regionLeft*f-(t*f-d)/2,_=Math.max(_,0),_=Math.min(_,parseFloat(a.width)),g=r.regionTop*f;let e=r.regionRight*f-(t*f-d)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.width)),u=e-_,m=(r.regionBottom-r.regionTop)*f}else{f=d/t,_=r.regionLeft*f,g=r.regionTop*f-(i*f-l)/2,g=Math.max(g,0),g=Math.min(g,parseFloat(a.height));let e=r.regionBottom*f-(i*f-l)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.height)),u=(r.regionRight-r.regionLeft)*f,m=e-g}else _=0,g=0,u=0,m=0;e.style.position="absolute",e.style.left=_+"px",e.style.top=g+"px",e.style.width=u+"px",e.style.height=m+"px"}showScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&"none"==e.style.display&&(e.style.display="")}hideScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none")}setViewDecorator(e,t){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));this._assertOpen();let i=[];if("string"==typeof e?i.push(e):Array.isArray(e)&&(i=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator)if(this._cvsViewDecorator=document.createElement("canvas"),this._cvsViewDecorator.className="cvs-view-decorator",this.singleFrameMode&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this._divScanArea)this._divScanArea.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsViewDecorator)}else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._video)throw new Error("'video' is null.");this._video.after(this._cvsViewDecorator)}this._decoratorArea=JSON.parse(JSON.stringify(t)),this._decoratorType.length=0;const o=["rectangle","focus"],r=["crossline","crosshair"];let n=!1,s=!1;for(let e of i)e=e.toLowerCase(),o.includes(e)&&!n&&(n=!0,this._decoratorType.push(e)),r.includes(e)&&!s&&(s=!0,!this._decoratorType.includes(e)&&this._decoratorType.push(e));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&"none"==this._cvsViewDecorator.style.display&&(this._cvsViewDecorator.style.display="")}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none")}setViewDecoratorLineWidth(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=t,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=t,this._updateViewDecorator()}setViewDecoratorFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=t,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=t,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen)return;if(!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const t=this._cvsViewDecorator;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit=e;const i=this.getVisibleRegion(!0),o=i.regionRight-i.regionLeft,r=i.regionBottom-i.regionTop;t.width==o&&t.height==r||(t.width=o,t.height=r);const n=t.getContext("2d");n.clearRect(0,0,t.width,t.height);const s=this._decoratorArea.x/100*o,a=this._decoratorArea.y/100*r,d=this._decoratorArea.width/100*o,l=this._decoratorArea.height/100*r;for(let e of this._decoratorType){if("rectangle"===e){n.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,n.fillRect(0,0,t.width,t.height),n.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,n.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,n.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const e=n.lineWidth/2;n.strokeRect(Math.round(s-e),Math.round(a-e),Math.round(d+n.lineWidth),Math.round(l+n.lineWidth))}if("focus"===e){n.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,n.fillRect(0,0,t.width,t.height),n.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.fillStyle=this._viewDecoratorInfo.focus.fillStyle,n.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),n.lineWidth=this._viewDecoratorInfo.focus.lineWidth,n.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const e=n.lineWidth/2,i=[0,.25,.75,1],o=[0,.25,.75,1];n.beginPath();for(let e=0;e<i.length;e++)if(0==e||3==e)for(let t=0;t<o.length;t+=2)n.moveTo(Math.round(s+i[e]*d),Math.round(a+o[t]*l)),n.lineTo(Math.round(s+i[e]*d),Math.round(a+o[t+1]*l));for(let t=0;t<o.length;t++)if(0==t||3==t)for(let r=0;r<i.length;r+=2)n.moveTo(Math.round(s+i[r]*d-e),Math.round(a+o[t]*l)),n.lineTo(Math.round(s+i[r+1]*d+e),Math.round(a+o[t]*l));n.stroke()}if("crossline"===e&&(n.beginPath(),n.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,n.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,n.moveTo(Math.round(s),Math.round(a+l/2)),n.lineTo(Math.round(s+d),Math.round(a+l/2)),n.moveTo(Math.round(s+d/2),Math.round(a)),n.lineTo(Math.round(s+d/2),Math.round(a+l)),n.stroke()),"crosshair"===e){n.beginPath();const e=.05*Math.min(d,l);n.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,n.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,n.moveTo(Math.round(s+(d-e)/2),Math.round(a+l/2)),n.lineTo(Math.round(s+(d+e)/2),Math.round(a+l/2)),n.moveTo(Math.round(s+d/2),Math.round(a+(l-e)/2)),n.lineTo(Math.round(s+d/2),Math.round(a+(l+e)/2)),n.stroke()}}}getVisibleRegion(e){let t,i,o;if(this._assertOpen(),this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,o="contain";else{if(!this._video)return null;t=this._video.videoWidth,i=this._video.videoHeight,o=this.getVideoFit()}let r=(()=>{const e=parseFloat(window.getComputedStyle(this._video).width),r=parseFloat(window.getComputedStyle(this._video).height);let n,s={regionBottom:i,regionRight:t,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return"cover"===o?e/r<t/i?(n=i/r,s.regionLeft=Math.floor((t-n*e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):(n=t/e,s.regionTop=Math.floor((i-n*r)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t):"none"===o&&(e<t&&r<i?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=Math.floor((i-r)/2),s.regionBottom=Math.ceil(i-s.regionTop)):e<t?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):r<i&&(s.regionTop=Math.floor((i-r)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t)),s})();return e?r.regionMeasuredByPercentage=!1:(r.regionBottom=Math.ceil(r.regionBottom/i*100),r.regionRight=Math.ceil(r.regionRight/t*100),r.regionLeft=Math.floor(r.regionLeft/t*100),r.regionTop=Math.floor(r.regionTop/i*100),r.regionMeasuredByPercentage=!0),r}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,t,i){if(!(e<=0||t<=0))return i?i.regionMeasuredByPercentage?{regionLeft:Math.round(i.regionLeft/100*e),regionTop:Math.round(i.regionTop/100*t),regionRight:Math.round(i.regionRight/100*e),regionBottom:Math.round(i.regionBottom/100*t),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(i)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:t,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(e<=0||t<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const o=this._getRegionInPixels(e,t,this._scanRegion);if(!this._cvsScanRegion)if(this._cvsScanRegion=document.createElement("canvas"),this._cvsScanRegion.className="cvs-scan-region",this.singleFrameMode&&(this._cvsScanRegion.addEventListener("click",this._clickIptSingleFrameMode),this._cvsScanRegion.style.cursor="pointer",this._cvsScanRegion.setAttribute("title","Take a photo")),this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsScanRegion)}else this._cvsSingleFrameMode?this._cvsSingleFrameMode.after(this._cvsScanRegion):this._video.after(this._cvsScanRegion);const r=this._cvsScanRegion;r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.left="0",r.style.top="0",r.style.objectFit=i,r.width==e&&r.height==t||(r.width=e,r.height=t);const n=r.getContext("2d");if(n.clearRect(0,0,r.width,r.height),0!=o.regionLeft||o.regionRight!=e||0!=o.regionTop||o.regionBottom!=t){const e=o.regionLeft,t=o.regionTop,i=o.regionRight-o.regionLeft,s=o.regionBottom-o.regionTop;n.fillStyle=this.regionMaskFillStyle,n.fillRect(0,0,r.width,r.height),n.clearRect(Math.round(e),Math.round(t),Math.round(i),Math.round(s)),n.strokeStyle=this.regionMaskStrokeStyle,n.lineWidth=this.regionMaskLineWidth;const a=n.lineWidth/2;n.strokeRect(Math.round(e-a),Math.round(t-a),Math.round(i+n.lineWidth),Math.round(s+n.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(!this._divScanArea)return;if(e<=0||t<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const o=this._getRegionInPixels(e,t,this._scanRegion),r=window.getComputedStyle(this._video),n=parseFloat(r.width),s=parseFloat(r.height),a=n/s,d=e/t;let l,h,c,_,g=1;if("contain"===i)a<d?(g=n/e,l=0,h=(s-t*g)/2):(g=s/t,l=(n-e*g)/2,h=0),l+=o.regionLeft*g,h+=o.regionTop*g,c=(o.regionRight-o.regionLeft)*g,_=(o.regionBottom-o.regionTop)*g;else if("cover"===i)if(a<d){g=s/t,l=o.regionLeft*g-(e*g-n)/2,l=Math.max(l,0),l=Math.min(l,parseFloat(r.width)),h=o.regionTop*g;let i=o.regionRight*g-(e*g-n)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(r.width)),c=i-l,_=(o.regionBottom-o.regionTop)*g}else{g=n/e,l=o.regionLeft*g,h=o.regionTop*g-(t*g-s)/2,h=Math.max(h,0),h=Math.min(h,parseFloat(r.height));let i=o.regionBottom*g-(t*g-s)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(r.height)),c=(o.regionRight-o.regionLeft)*g,_=i-h}else l=0,h=0,c=0,_=0;this._divScanArea.style.left=l+"px",this._divScanArea.style.top=h+"px",this._divScanArea.style.width=c+"px",this._divScanArea.style.height=_+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){return void 0!==this._croppingRegions?this._croppingRegions:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("croppingRegions")?this.referenceConfigurationArray[0].croppingRegions:this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'loopInterval' should be greater than or equal to 0.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){return void 0!==this._loopInterval?this._loopInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("loopInterval")?this.referenceConfigurationArray[0].loopInterval:this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("The 'maxNumberOfFramesInBuffer' should be greater than 0.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){return void 0!==this._maxNumberOfFramesInBuffer?this._maxNumberOfFramesInBuffer:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxNumberOfFramesInBuffer")?this.referenceConfigurationArray[0].maxNumberOfFramesInBuffer:this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){return void 0!==this._refreshInterval?this._refreshInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("refreshInterval")?this.referenceConfigurationArray[0].refreshInterval:this._defaultRefreshInterval}isContextDestroyed(){return this.bDestroyed}static createInstance(e){return h(this,void 0,void 0,(function*(){if(c)throw new Error("`CameraEnhancer` is not supported in Node.js.");let t=new g;("string"==typeof e||e instanceof String)&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(g.defaultUIElementURL),this._hasEngineResourceLoaded=!0,t}))}play(e,t,i){return h(this,void 0,void 0,(function*(){if(this._video&&this.videoSrc){yield new Promise(((e,t)=>{this._video.onloadedmetadata=()=>h(this,void 0,void 0,(function*(){this._video&&(this._video.onloadedmetadata=null,yield this._video.play(),e())})),"string"==typeof this.videoSrc||this.videoSrc instanceof String?this._video.src=this.videoSrc:this._video.srcObject=this.videoSrc,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}));let e={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};const t=this.mapCameraEvents.get("played");for(let i of t){const t=JSON.parse(JSON.stringify(e));setTimeout((()=>i(t)),0)}return e}if(this.singleFrameMode)return this._clickIptSingleFrameMode(),{width:0,height:0,deviceId:null};if(!this._video)return null;const o=++this.iPlayRound;let r=null,n=0,s=0;return this._currentCamera&&(r=this._currentCamera.deviceId),this._video&&(n=this._video.videoWidth,s=this._video.videoHeight),this.promisePlay&&(yield this.promisePlay,o<this.iPlayRound)?{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId}:(this.promisePlay=(()=>h(this,void 0,void 0,(function*(){var o;try{this._video&&this._video.srcObject&&this.stop(),g._onLog&&g._onLog("DCE: ======before video========");const a=()=>{if(!this._video)throw u&&u.getTracks().forEach((e=>{e.stop()})),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null.")},d=this.getVideoSettings();let l;"boolean"==typeof d.video&&(d.video={});const c=["rear","back","rück","arrière","trasera","trás","traseira","posteriore","后面","後面","背面","后置","後置","背置","задней","الخلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","takakamera","belakang","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक"],_=()=>{for(let e of this._allCameras){let t=e.label.toLowerCase();if(t&&c.some((e=>-1!=t.indexOf(e)))&&/\b0(\b)?/.test(t)){delete d.video.facingMode,d.video.deviceId={ideal:e.deviceId};break}}d.video.deviceId||-1==["Android","HarmonyOS"].indexOf(g.browserInfo.OS)||(delete d.video.facingMode,d.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})};if(e)delete d.video.facingMode,d.video.deviceId={exact:e};else if(d.video.deviceId);else if(this._lastDeviceId)delete d.video.facingMode,d.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&g.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete d.video.facingMode,d.video.deviceId={exact:window.localStorage.getItem("dce_last_camera_id")};const T=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),D=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));T&&D&&(d.video.width=T,d.video.height=D)}else if(this.ifSkipCameraInspection);else if(d.video.facingMode){if(yield this.getAllCameras(),!this._video)return null;let C=d.video.facingMode;C instanceof Array&&C.length&&(C=C[0]),C=C.exact||C.ideal||C,"environment"===C&&(l=!!d.video.facingMode,_())}let u;t&&(d.video.width={ideal:t}),i&&(d.video.height={ideal:i}),g._onLog&&g._onLog("DCE: ======try getUserMedia========");let m,f=[0,500],R=null,v=null;function E(e){return h(this,void 0,void 0,(function*(){for(let t of f){a(),t&&(yield new Promise((e=>setTimeout(e,t)))),a();{const t=e.video.deviceId;v=t?t.exact||t.ideal||t:null}try{g._onLog&&g._onLog("DCE: ask "+JSON.stringify(e)),u=yield navigator.mediaDevices.getUserMedia(e),a();break}catch(e){R=e,g._onLog&&g._onLog("DCE: "+e.message||e)}}}))}if(yield E(d),u||(g._onLog&&g._onLog("DCE: ======try getUserMedia again========"),m=JSON.parse(JSON.stringify(d)),"object"==typeof m.video&&("iPhone"==g.browserInfo.OS?(t>=1280||i>=1280?m.video.width=1280:t>=640||i>=640?m.video.width=640:(t<640||i<640)&&(m.video.width=320),delete m.video.height):l&&!d.video.deviceId?(delete m.video.facingMode,this._allCameras.length&&(m.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):m.video=!0),g._onLog&&g._onLog("DCE: "+m),yield E(m)),u||(f=[1e3,2e3],yield E(d)),u||(yield E(m)),!u)throw R;const S=()=>{const e=u.getVideoTracks();let t,i;if(e.length&&(t=this._videoTrack=e[0]),this._video&&t){const e=t.getSettings();if(e)for(let o of this._allCameras)if(e.deviceId===o.deviceId){o._checked=!0,o.label=t.label,i=o;break}if(!i&&v)for(let e of this._allCameras)if(v==e.deviceId){t.label&&(e._checked=!0,e.label=t.label),i=e;break}}this._currentCamera=i};if(yield this.getAllCameras(),a(),l){S(),_();let M=d.video.deviceId;M&&(M=M.exact||M.ideal||M);let L=null===(o=this._currentCamera)||void 0===o?void 0:o.deviceId;!M||L&&M==L||(u.getTracks().forEach((e=>{e.stop()})),f=[0,500,1e3,2e3],yield E(d))}a();const p=()=>h(this,void 0,void 0,(function*(){g._onLog&&g._onLog("======play video========"),yield new Promise(((e,t)=>{a(),this._video.onloadedmetadata=()=>h(this,void 0,void 0,(function*(){a(),this._video.onloadedmetadata=null,yield this._video.play(),e()})),this._video.srcObject=u,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}))}));yield p(),a(),g._onLog&&g._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const I=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=I,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),g._onLog&&g._onLog("DCE: got "+I),S(),a(),this._renderSelCameraInfo();const y={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};y.deviceId&&(this._lastDeviceId=y.deviceId,this.ifSaveLastUsedCamera&&g.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),d.video.width&&d.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(d.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(d.video.height)))));const A=this.mapCameraEvents.get("played");for(let O of A){const b=JSON.parse(JSON.stringify(y));setTimeout((()=>O(b)),0)}if(r&&r!=y.deviceId){const w=this.mapCameraEvents.get("cameraChange");for(let F of w){const B=JSON.parse(JSON.stringify(y));setTimeout((()=>F(B)),0)}}if(n&&s&&(n!=y.width||s!=y.height)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let P of this._arrScanRegionOverlays)P&&this._updateScanRegionOverlay(P);const N=this.mapCameraEvents.get("resolutionChange");for(let V of N){const k=JSON.parse(JSON.stringify(y));setTimeout((()=>V(k)),0)}}return this.promisePlay=null,y}catch(U){throw this.promisePlay=null,U}})))(),yield this.promisePlay)}))}resume(){return h(this,void 0,void 0,(function*(){this._assertOpen(),yield this.play(),this._bStoppedByPause&&(this._bStoppedByPause=!1,this.startFetchingLoop()),this._bShowScanRegionLaser&&this.showScanRegionLaser()}))}pause(){this._bOpen||console.warn("The camera is not open."),this._video&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._bStoppedByPause=!0),this._bShowScanRegionLaser&&this.hideScanRegionLaser()}close(e){if(!this._video)return;this.stop(),this._unbindUI(),e&&(this.UIElement.style.display="none"),this.stopFetchingLoop(),this.bOpen=!1;const t=this.mapCameraEvents.get("cameraClose");for(let e of t){const t={width:0,height:0,deviceId:null};setTimeout((()=>e(t)),0)}}open(e){return h(this,void 0,void 0,(function*(){this._bindUI(),e&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""));let t=yield this.play();this.bOpen=!0;const i=this.mapCameraEvents.get("cameraOpen");for(let e of i){const i=JSON.parse(JSON.stringify(t));setTimeout((()=>e(i)),0)}return t}))}stop(){this._video&&this._video.srcObject&&(g._onLog&&g._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach((e=>{e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(g._onLog&&g._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0}getAllCameras(){return h(this,void 0,void 0,(function*(){let e=yield navigator.mediaDevices.enumerateDevices();if(!e[0].deviceId){let t=yield navigator.mediaDevices.getUserMedia({video:!0});e=yield navigator.mediaDevices.enumerateDevices(),t.getTracks().forEach((e=>{e.stop()})),t=null}const t=[],i=[];if(this._allCameras)for(let e of this._allCameras)e._checked&&i.push(e);for(let o=0;o<e.length;o++){let r,n=e[o];if("videoinput"==n.kind){for(let e of i)n.deviceId==e.deviceId&&(r=e);r||(r={},r.deviceId=n.deviceId,r.label=n.label?n.label:"camera "+o),t.push(r)}}return this._allCameras=t,g._onLog&&g._onLog("DCE: "+JSON.stringify(this._allCameras)),Promise.resolve(t)}))}_renderSelCameraInfo(){if(this._selCam&&(this._selCam.innerHTML=""),this._selCam){let e;for(let t of this._allCameras){let i=document.createElement("option");i.value=t.deviceId,i.innerText=t.label,this._selCam.append(i),t.deviceId&&this._currentCamera&&this._currentCamera.deviceId==t.deviceId&&(e=i)}this._selCam.value=e?e.value:""}}getSelectedCamera(){if(!this._bOpen){let e="";const t=this.videoSettings.video.deviceId;t&&(e=t.exact||t.ideal||t);for(let t of this._allCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}selectCamera(e){return h(this,void 0,void 0,(function*(){let t="";return e&&(t=e.deviceId||e),this.videoSettings.video.deviceId={exact:t},this._bOpen?yield this.play(e.deviceId||e):null}))}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,t=0;const i=this.videoSettings.video.width,o=this.videoSettings.video.height;return i&&(e=i.exact||i.ideal||i),o&&(t=o.exact||o.ideal||o),[e,t]}}setResolution(e,t){return h(this,void 0,void 0,(function*(){let i,o;return e instanceof Array?(i=e[0],o=e[1]):(i=e,o=t),this.videoSettings.video.width={ideal:i},this.videoSettings.video.height={ideal:o},this._bOpen?yield this.play(null,i,o):null}))}getResolutions(e){return h(this,void 0,void 0,(function*(){let t="";const i=(e,t)=>{const i=this.mapCameraResolutions.get(e);if(!i||!i.length)return!1;for(let e of i)if(e[0]===t.width&&e[1]===t.height)return!0;return!1},o=(e,t,i)=>h(this,void 0,void 0,(function*(){const o={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let r=null;try{r=yield navigator.mediaDevices.getUserMedia(o)}catch(o){return null}if(!r)return null;const n=r.getVideoTracks();let s=null;try{const e=n[0].getSettings();s={width:e.width,height:e.height}}catch(o){const e=document.createElement("video");e.srcObject=r,s={width:e.videoWidth,height:e.videoHeight},e.srcObject=null}return n.forEach((e=>{e.stop()})),s}));if(!this._bOpen){const r=this.videoSettings.video.deviceId;if(!r)return null;if(t=r.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:r.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!t)return null;let n=this.mapCameraResolutions.get(t);if(n&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),n=this.mapCameraResolutions.get(t);for(let e of this.predefinedResolutions){const r=yield o(t,e.width,e.height);r&&!i(t,r)&&n.push([r.width,r.height])}return n}if(this._currentCamera){t=this._currentCamera.deviceId;let o=this.mapCameraResolutions.get(t);if(o&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),o=this.mapCameraResolutions.get(t);const r=this.getConstraints();for(let e of this.predefinedResolutions){yield this._videoTrack.applyConstraints({width:{ideal:e.width},height:{ideal:e.height}});const r=this._videoTrack.getSettings(),n={width:r.width,height:r.height};i(t,n)||o.push([n.width,n.height])}return yield this._videoTrack.applyConstraints(r),o}return null}))}on(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e);i.includes(t)||i.push(t)}off(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e),o=i.indexOf(t);-1!==o&&i.splice(o,1)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen?this.play():Promise.resolve()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getSettings()}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getConstraints()}applyConstraints(e){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return yield this._videoTrack.applyConstraints(e)}))}turnOnTorch(){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}))}turnOffTorch(){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}))}setColorTemperature(e){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let t=this.getCapabilities().colorTemperature;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]})}))}setExposureCompensation(e){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let t=this.getCapabilities().exposureCompensation;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}))}setZoom(e){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");let t=this.getCapabilities().zoom;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{zoom:e}]})}))}setFrameRate(e){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let t=this.getCapabilities().frameRate;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}))}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(e,t){return h(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");const i=this.getCapabilities().focusMode,o=this.getCapabilities().focusDistance;if(!i||!i.includes(e)||!o)throw Error("Not supported.");return t?(t<o.min?t=o.min:t>o.max&&(t=o.max),yield this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:t}]})):yield this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}))}getFocus(){const e=this.getCameraSettings().focusMode;return"continuous"===e?{mode:e}:{mode:e,distance:this.getCameraSettings().focusDistance}}getFrameSize(e,t,i,o){if(!e||!t)return null;let r,n,s,a,d=e,l=t;const h={regionLeft:0,regionTop:0,regionRight:d,regionBottom:l,regionMeasuredByPercentage:!1};i?(i.regionMeasuredByPercentage?(h.regionLeft=i.regionLeft*d/100,h.regionTop=i.regionTop*l/100,h.regionRight=i.regionRight*d/100,h.regionBottom=i.regionBottom*l/100):(h.regionLeft=i.regionLeft,h.regionTop=i.regionTop,h.regionRight=i.regionRight,h.regionBottom=i.regionBottom),r=h.regionLeft,n=h.regionTop,d=Math.round(h.regionRight-h.regionLeft),l=Math.round(h.regionBottom-h.regionTop)):(r=0,n=0);const c=Math.max(d,l);if(o&&o>0&&c>o){const e=o/c;d>l?(s=o,a=Math.round(l*e)):(s=Math.round(d*e),a=o)}else s=d,a=l;return s<=0||a<=0?null:{sx:r,sy:n,sWidth:d,sHeight:l,dWidth:s,dHeight:a}}getFrame(){if(this.singleFrameMode)throw Error("'getFrame()' is unavailable in singleFrameMode.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoFrame(this._scanRegion)}_getVideoFrame(e,t){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoFrame()' is unavailable in singleFrameMode.");const i=Date.now();g._onLog&&g._onLog("DCE: _getVideoFrame(region?) START: "+i);const o=this._video.videoWidth,r=this._video.videoHeight;if(0===o||0===r)return null;const n=this.getFrameSize(o,r,e,this.maxCvsSideLength);if(!n)return null;let s,a;s=o!==n.sWidth||r!==n.sHeight,a=n.sWidth!==n.dWidth||n.sHeight!==n.dHeight;const d=(()=>!(!this._bWebGLSupported||a))(),l={data:null,region:e?JSON.parse(JSON.stringify(e)):null,sx:n.sx,sy:n.sy,width:n.dWidth,height:n.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},h=this._getImageData(this._video,o,r,n,t,{targetColorMode:this.frameColorMode,bUseWebGL:d});if(!h)return null;const c=Date.now();return g._onLog&&g._onLog("DCE: _getVideoFrame(region?) END: "+c),l.data=h.data,l.colorMode=h.colorMode,l._bUseWebGL=h._bUseWebGL,l.timeSpent=c-i,l.timeStamp=c,l}_getImageData(e,t,i,o,r,n){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(!t||!i)return null;g._onLog&&g._onLog("DCE: _getImageData() START: "+Date.now());const{sx:s,sy:a,sWidth:d,sHeight:l,dWidth:h,dHeight:c}=o;let _;if(_=n&&n.targetColorMode?n.targetColorMode.toLowerCase():"rgba",n&&n.bUseWebGL){this.videoGlCvs||(this.videoGlCvs=document.createElement("canvas"));const d=this.videoGlCvs;d.width==t&&d.height==i||(d.width=t,d.height=i,this.videoGl&&this.videoGl.viewport(0,0,t,i));const l=this.videoGl||d.getContext("webgl",{antialias:!1})||d.getContext("experimental-webgl",{antialias:!1});if(!l){this.videoGl=null,this._bWebGLSupported=!1;let s=null;return n?(s=JSON.parse(JSON.stringify(n)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,o,r,s)}if(l.enable(l.SCISSOR_TEST),l.scissor(s,a,h,c),!this.videoGl||_!==this.currentFSColorMode){this.videoGl=l;const e=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{position:t,indices:i}},t=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i=(e,t,i)=>{const r=o(e,e.VERTEX_SHADER,t),n=o(e,e.FRAGMENT_SHADER,i),s=e.createProgram();return e.attachShader(s,r),e.attachShader(s,n),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s)),null)},o=(e,t,i)=>{const o=e.createShader(t);return e.shaderSource(o,i),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),e.deleteShader(o),null)},r="\n                  attribute mediump vec2 aVertexPosition;\n                  varying mediump vec2 vDirection;\n          \n                  void main( void )\n                  {\n                      gl_Position = vec4(aVertexPosition, 1.0, 1.0) * 2.0;\n                      vDirection = aVertexPosition;\n                  }\n                ";let n;n=["rgba","rbga","grba","gbra","brga","bgra"].includes(_)?_.slice(0,3):"rgb";const s=i(l,r,`\n                    precision mediump float;\n\n                    varying mediump vec2 vDirection;\n                    uniform sampler2D uSampler;\n                    uniform lowp float uColorFactor;\n            \n                    void main(void)\n                    {\n                        vec4 sample = texture2D(uSampler, vec2(vDirection.x * 0.5 + 0.5, vDirection.y * 0.5 + 0.5));\n                        lowp float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                        gl_FragColor = vec4(sample.${n} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                    }\n                `);this.webglProgramInfo={program:s,attribLocations:{vertexPosition:l.getAttribLocation(s,"aVertexPosition")},uniformLocations:{uSampler:l.getUniformLocation(s,"uSampler"),uColorFactor:l.getUniformLocation(s,"uColorFactor")}},this.webglBuffers=e(l),this.webglTexture=t(l),this.currentFSColorMode=_}const u=(e,t,i)=>{const o=e.RGBA,r=e.RGBA,n=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,o,r,n,i)},m=(e,t,i,o)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indices),e.useProgram(t.program);{const o=2,r=e.FLOAT,n=!1,s=0,a=0;e.bindBuffer(e.ARRAY_BUFFER,i.position),e.vertexAttribPointer(t.attribLocations.vertexPosition,o,r,n,s,a),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,"grey"===_||"grey32"===_?1:0);const r=e.UNSIGNED_SHORT;e.drawElements(e.TRIANGLES,6,r,0)};let f;if(u(l,this.webglTexture,e),m(l,this.webglProgramInfo,this.webglBuffers,this.webglTexture),r){if(r.length<h*c*4)return null;f=r}else this.ifReuseArrayBufferView||"grey"===_?(this.glImgData&&this.glImgData.length===h*c*4||(this.glImgData=new Uint8Array(h*c*4)),f=this.glImgData):f=new Uint8Array(h*c*4);if(l.readPixels(s,a,h,c,l.RGBA,l.UNSIGNED_BYTE,f),l.disable(l.SCISSOR_TEST),255!==f[3]){g._onLog&&g._onLog("DCE: WebGL draw frame incorrectly."),this.forceLoseContext(),this._bWebGLSupported=!1;let s=null;return n?(s=JSON.parse(JSON.stringify(n)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,o,r,s)}if("grey"===_){let e=g._onLog?Date.now():0;if(f=new Uint8Array(new Uint32Array(f.buffer)),r){if(r.length<f.length)return null;r.set(f)}g._onLog&&g._onLog("DCE: Extract grey cost: "+(Date.now()-e))}return g._onLog&&g._onLog("DCE: _getImageData END: "+Date.now()),{data:f,colorMode:_,_bUseWebGL:!0}}{this.canvas||(this.canvas=document.createElement("canvas"));const t=this.canvas;t.width===h&&t.height===c||(t.width=h,t.height=c),t.ctx2d||(t.ctx2d=t.getContext("2d"));const i=t.ctx2d;i.drawImage(e,s,a,d,l,0,0,h,c);let o=i.getImageData(0,0,t.width,t.height).data;if(["rbga","grba","gbra","brga","bgra"].includes(_)){const e=_.indexOf("r"),t=_.indexOf("g"),i=_.indexOf("b");let r=0;1===e||2===e?r=e:2===t&&(r=t);for(let n=0;n<o.length;n+=4){let s;r&&(s=o[n+r]),o[n+e]=o[n],o[n+t]=1===r?s:o[n+1],o[n+i]=2===r?s:o[n+2]}}else if("grey"===_||"grey32"===_)for(let e=0;e<o.length;e+=4){const t=.21*o[e]+.71*o[e+1]+.07*o[e+2];o[e]=t,o[e+1]=t,o[e+2]=t}if(o="grey"===_?new Uint8Array(new Uint32Array(o.buffer)):new Uint8Array(o.buffer),r){if(r.length<o.length)return null;r.set(o)}return g._onLog&&g._onLog("DCE: _getVideoFrame(region?) END: "+Date.now()),{data:o,colorMode:_,_bUseWebGL:!1}}}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.bDestroyed)return void this.stopFetchingLoop();if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();if(this._video.paused)return g._onLog&&g._onLog("DCE: Video is paused. Ask in 1s."),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),void(this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),1e3));const t=()=>{g._onLog&&g._onLog("DCE: start fetching a frame: "+Date.now());const e=this.getCurrentRegion();let t=this._getVideoFrame(e);if(!t)return void(g._onLog&&g._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(t),g._onLog&&g._onLog("DCE: finish fetching a frame: "+Date.now());const i=this.mapCameraEvents.get("frameAddedToBuffer");for(let e of i)setTimeout(e,0)},i=()=>{this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout((()=>{this.bDestroyed?this.stopFetchingLoop():this._bOpen&&this.isFetchingLoopStarted()?this._video.paused?this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId):(g._onLog&&g._onLog("DCE: second timeout executes: "+Date.now()),t(),i()):this.stopFetchingLoop()}),this.refreshInterval))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(t(),this.refreshInterval>0&&i()):this.refreshInterval>0?(t(),i()):0===this.refreshInterval?t():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),this.loopInterval)}startFetchingLoop(){if(this.bDestroyed)throw Error("The DCE instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");if(this._video.paused)throw Error("The video is paused.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,g._onLog&&g._onLog("start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(g._onLog&&g._onLog("stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.shift()):null}forceLoseContext(){if(!this.videoGl)return;const e=this.videoGl;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.videoGl=null,this.videoGlCvs=null}dispose(e){this.close(!0),this.forceLoseContext(),this.setViewDecorator(null,null);for(let e of this._arrScanRegionOverlays)e&&e.remove();e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null}}g._jsVersion="2.3.1",g._jsEditVersion="20220321",g._version="JS "+g._jsVersion+"."+g._jsEditVersion,g.browserInfo=function(){if(!c&&!_){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,o=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(o)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(_)return{browser:"ssr",version:0,OS:"ssr"}}(),g._hasEngineResourceLoaded=!1,g._engineResourcePath=(()=>{if(c)return"";if(!_&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),g._defaultUIElementURL="@engineResourcePath/dce.ui.html";const u=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement);class m extends l{constructor(){super(),this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this.resultsOverlay=null,this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundOnSuccessfullRead=new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.barcodeFillStyle="rgba(254,180,32,0.3)",this.barcodeStrokeStyle="rgba(254,180,32,0.9)",this.barcodeLineWidth=1,this.beingLazyDrawRegionsults=!1,this.dce=null,this._onCameraSelChange=()=>{},this._onResolutionSelChange=()=>{},this._onCloseBtnClick=()=>{},this._onPlayed=null}static get defaultUIElementURL(){var e;return null===(e=m._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",l.engineResourcePath)}static set defaultUIElementURL(e){m._defaultUIElementURL=e}getUIElement(){return this.dce.getUIElement()}setUIElement(e){return t(this,void 0,void 0,(function*(){yield this.dce.setUIElement(e)}))}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e?(this.dce.ifShowScanRegionLaser=!1,(()=>{t(this,void 0,void 0,(function*(){let e=yield this.getScanSettings();e.oneDTrustFrameCount=1,yield this.updateScanSettings(e)}))})()):this.dce.ifShowScanRegionLaser=!0}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}get soundOnSuccessfullRead(){return this._soundOnSuccessfullRead}set soundOnSuccessfullRead(e){e instanceof HTMLAudioElement?this._soundOnSuccessfullRead=e:this._soundOnSuccessfullRead=new Audio(e)}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({regionMaskFillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({regionMaskStrokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({regionMaskLineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.singleFrameMode||(this.beingLazyDrawRegionsults=!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.frameColorMode=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}createDCEInstance(){return t(this,void 0,void 0,(function*(){this.dce||(l._onLog&&l._onLog("createDCEInstance()"),g.defaultUIElementURL=null,this.dce=yield g.createInstance(),this.dce.refreshInterval=200,this.dce.frameColorMode="grey",this.dce.maxCvsSideLength="iPhone"==m.browserInfo.OS||"Android"==m.browserInfo.OS?2048:4096,this.dce.on("cameraChange",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("resolutionChange",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("cameraClose",(()=>{this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1})),this.dce.on("singleFrameAcquired",(e=>t(this,void 0,void 0,(function*(){if(!e)return;if(!e.data)return;const t=yield this._decode_DCEFrame(e);yield this.clearMapDecodeRecord();for(let e of t)delete e.bUnduplicated;if(this._drawResults(t),this.onFrameRead&&this.isOpen()&&!this._bPauseScan&&this.onFrameRead(t),this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let e of t)this.onUniqueRead(e.barcodeText,e)})))))}))}static createInstance(e){return t(this,void 0,void 0,(function*(){if(u)throw new Error("`BarcodeScanner` is not supported in Node.js.");let t=new m;yield t.createDCEInstance(),t._instanceID=yield m.createInstanceInWorker(!0),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(m.defaultUIElementURL),t.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.singleFrameMode||(yield t.updateRuntimeSettings("single")),t}))}decodeCurrentFrame(e){return t(this,void 0,void 0,(function*(){this._assertOpen();let t=null;e&&e.region&&(t=e.region);let i=this.dce._getVideoFrame(t);return this._decode_DCEFrame(i)}))}clearMapDecodeRecord(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),l._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:i,instanceID:this._instanceID})}))}))}static isRegionNormalPreset(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}updateRuntimeSettings(i){return t(this,void 0,void 0,(function*(){let t;if("string"==typeof i)if("speed"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region)}else if("balance"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region),t.deblurLevel=3,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0],t.timeout=1e5}else if("coverage"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region||(t.region=e.region),t.deblurLevel=5,t.expectedBarcodesCount=512,t.scaleDownThreshold=1e5,t.localizationModes=[2,16,4,8,0,0,0,0],t.timeout=1e5}else if("single"==i){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,m.isRegionNormalPreset(e.region)?t.region=null:t.region=e.region,t.expectedBarcodesCount=1,t.localizationModes=[16,2,0,0,0,0,0,0],t.barcodeZoneMinDistanceToImageBorders=0}else t=JSON.parse(i);else{if("object"!=typeof i)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(i)),t.region instanceof Array){let e=i.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!l._bUseFullFeature){if(0!=(t.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let e=t.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(e)):this.userDefinedRegion=null,e instanceof Array)if(e.length){for(let t=0;t<e.length;++t){let i=e[t];i&&((i.regionLeft||i.regionTop||i.regionRight||i.regionBottom||i.regionMeasuredByPercentage)&&(i.regionLeft||i.regionTop||100!=i.regionRight||100!=i.regionBottom||!i.regionMeasuredByPercentage)||(e[t]=null))}this.region=e}else this.region=null;else e&&(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null;this.bFilterRegionInJs&&(t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}yield new Promise(((e,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){i(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,i(e)}})),l._dbrWorker.postMessage({type:"updateRuntimeSettings",id:o,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})})),"single"==i&&(yield this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0"),yield this.setModeArgument("LocalizationModes",0,"ScanDirection","2"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeX","71"),yield this.setModeArgument("BinarizationModes",0,"BlockSizeY","71"))}))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}getAllCameras(){return t(this,void 0,void 0,(function*(){return this.dce.getAllCameras()}))}getCurrentCamera(){return t(this,void 0,void 0,(function*(){return this.dce.getSelectedCamera()}))}setCurrentCamera(e){return t(this,void 0,void 0,(function*(){return this.dce.selectCamera(e)}))}getResolution(){return this.dce.getResolution()}setResolution(e,i){return t(this,void 0,void 0,(function*(){return this.dce.setResolution(e,i)}))}getScanSettings(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let i=l._nextTaskID++;l._taskCallbackMap.set(i,(i=>{if(i.success){let t=i.results;return t.intervalTime=this.intervalTime,t.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,t.soundOnSuccessfullRead=this.soundOnSuccessfullRead.src,t.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,t.vibrateDuration=this.vibrateDuration,e(t)}{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}})),l._dbrWorker.postMessage({type:"getScanSettings",id:i,instanceID:this._instanceID})}))}))}updateScanSettings(e){return t(this,void 0,void 0,(function*(){if(!e)return;const t=JSON.parse(JSON.stringify(e));return t.hasOwnProperty("intervalTime")&&(this.intervalTime=t.intervalTime,delete t.intervalTime),t.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=t.whenToPlaySoundforSuccessfulRead,delete t.whenToPlaySoundforSuccessfulRead),t.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundOnSuccessfullRead.src=t.soundOnSuccessfullRead,delete t.soundOnSuccessfullRead),t.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=t.whenToVibrateforSuccessfulRead,delete t.whenToVibrateforSuccessfulRead),t.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=t.vibrateDuration,delete t.vibrateDuration),yield new Promise(((e,i)=>{let o=l._nextTaskID++;l._taskCallbackMap.set(o,(t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack+="\n"+t.stack,i(e)}})),m._dbrWorker.postMessage({type:"updateScanSettings",id:o,instanceID:this._instanceID,body:{settings:t}})}))}))}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}stop(){this.dce.stop(),this.dce.hideScanRegionLaser(),this.dce.hideViewDecorator(),this.dce.hideScanRegionOverlays(),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}play(e,i,o){return t(this,void 0,void 0,(function*(){return this.dce.play(e,i,o)}))}pauseScan(){this._assertOpen(),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}applyConstraints(e){return t(this,void 0,void 0,(function*(){return this.dce.applyConstraints(e)}))}turnOnTorch(){return t(this,void 0,void 0,(function*(){return this.dce.turnOnTorch()}))}turnOffTorch(){return t(this,void 0,void 0,(function*(){return this.dce.turnOffTorch()}))}setColorTemperature(e){return t(this,void 0,void 0,(function*(){return this.dce.setColorTemperature(e)}))}setExposureCompensation(e){return t(this,void 0,void 0,(function*(){return this.dce.setExposureCompensation(e)}))}setZoom(e){return t(this,void 0,void 0,(function*(){return this.dce.setZoom(e)}))}setFrameRate(e){return t(this,void 0,void 0,(function*(){return this.dce.setFrameRate(e)}))}getFrameRate(){return this.dce.getFrameRate()}setFocus(e,i){return t(this,void 0,void 0,(function*(){return this.dce.setFocus(e,i)}))}getFocus(){return this.dce.getFocus()}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}_loopReadVideo(){return t(this,void 0,void 0,(function*(){if(this.bDestroyed)return void this.dce.stopFetchingLoop();if(!this.isOpen())return this.dce.stopFetchingLoop(),void(yield this.clearMapDecodeRecord());if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return l._onLog&&l._onLog("Video or scan is paused. Ask in 1s."),this.dce.stopFetchingLoop(),yield this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));this.dce.ifShowScanRegionLaser=!0,l._onLog&&l._onLog("======= once read ======="),l._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(()=>t(this,void 0,void 0,(function*(){return e._bUseWebGL||"grey"!==e.colorMode||(this.dce.frameColorMode="rgba"),this._decode_DCEFrame(e)})))().then((e=>{l._onLog&&l._onLog(e);let t=this.array_decodeFrameTimeCost,i=this.array_getFrameTimeCost,o=this._indexCurrentDecodingFrame;if((()=>{if(this.region instanceof Array){for(t[o]&&t[o]instanceof Array||(t[o]=[]);t[o].length>=5;)t[o].shift();t[o].push(this._lastInnerDecodeDuration)}else{for(;t.length>=5;)t.shift();t.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=(()=>{let e=0;if(this.region instanceof Array){let r=0,n=0;r=o+1>=this.region.length?0:o+1,n=r+1>=this.region.length?0:r+1,e=t[r]&&t[r].length&&i[n]&&i[n].length?Math.min(...t[r])-Math.max(...i[n]):0}else if(i&&i.length){let o=Math.min(...t),r=Math.max(...i);o&&r&&(e=o-r)}else e=0;return e>0?e:0})()+this.intervalTime,this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unique"===this.bPlaySoundOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}t&&(this.soundOnSuccessfullRead.currentTime=0,this.soundOnSuccessfullRead.play().catch((e=>{console.warn("Autoplay not allowed. User interaction required: "+(e.message||e))})))}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unique"===this.bVibrateOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onFrameRead){let t=this._cloneDecodeResults(e);for(let e of t)delete e.bUnduplicated;this.onFrameRead(t)}if(this.onUniqueRead)for(let t of e)t.bUnduplicated&&this.onUniqueRead(t.barcodeText,this._cloneDecodeResults(t));this._drawResults(e)}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce.stopFetchingLoop(),l._onLog&&l._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}))}_getVideoFrame(){let e=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,e||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;const t=this.dce.getFrameFromBuffer();return(e=>{let t=e.timeSpent,i=this.array_getFrameTimeCost;if(this.region instanceof Array){let e=this._indexCurrentDecodingFrame;for(i[e]&&i[e]instanceof Array||(i[e]=[]);i[e].length>=5;)i[e].shift();i[e].push(t)}else{for(;i.length>=5;)i.shift();i.push(t)}})(t),t}_drawResults(e){if(!this.dce)return;this.resultsOverlay||(this.resultsOverlay=this.dce.addScanRegionOverlayCanvas());const t=this.resultsOverlay.getContext("2d");if(t.clearRect(0,0,this.resultsOverlay.width,this.resultsOverlay.height),e){t.globalCompositeOperation="destination-over",t.fillStyle=this.barcodeFillStyle,t.strokeStyle=this.barcodeStrokeStyle,t.lineWidth=this.barcodeLineWidth;for(let i of e){let e=i.localizationResult;t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.fill(),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.closePath(),t.stroke()}}}open(){return t(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}openVideo(){return t(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}close(){this.dce.close(),this._bPauseScan=!0}show(){return t(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}showVideo(){return t(this,void 0,void 0,(function*(){this._bindUI();let e=yield this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),e}))}hide(){this.dce.close(!0),this._bPauseScan=!0}destroyContext(){this.close(),this.bDestroyed||super.destroyContext()}}var f,R,v,E,S,p,I,y,A,T,D,C,M,L,O,b,w,F,B,N,P,V,k,U,x,G,W;m._defaultUIElementURL="@engineResourcePath/dbr.ui.html",e.EnumBarcodeColourMode=void 0,(f=e.EnumBarcodeColourMode||(e.EnumBarcodeColourMode={}))[f.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",f[f.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",f[f.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",f[f.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",f[f.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",f[f.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",f[f.BICM_SKIP=0]="BICM_SKIP",f[f.BICM_REV=2147483648]="BICM_REV",e.EnumBarcodeComplementMode=void 0,(R=e.EnumBarcodeComplementMode||(e.EnumBarcodeComplementMode={}))[R.BCM_AUTO=1]="BCM_AUTO",R[R.BCM_GENERAL=2]="BCM_GENERAL",R[R.BCM_SKIP=0]="BCM_SKIP",R[R.BCM_REV=2147483648]="BCM_REV",e.EnumBarcodeFormat_2=void 0,(v=e.EnumBarcodeFormat_2||(e.EnumBarcodeFormat_2={}))[v.BF2_NULL=0]="BF2_NULL",v[v.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",v[v.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",v[v.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",v[v.BF2_POSTNET=2097152]="BF2_POSTNET",v[v.BF2_PLANET=4194304]="BF2_PLANET",v[v.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",v[v.BF2_RM4SCC=16777216]="BF2_RM4SCC",v[v.BF2_DOTCODE=2]="BF2_DOTCODE",v[v.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",v[v.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",v[v.BF2_PHARMACODE=12]="BF2_PHARMACODE",e.EnumBinarizationMode=void 0,(E=e.EnumBinarizationMode||(e.EnumBinarizationMode={}))[E.BM_AUTO=1]="BM_AUTO",E[E.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",E[E.BM_SKIP=0]="BM_SKIP",E[E.BM_THRESHOLD=4]="BM_THRESHOLD",E[E.BM_REV=2147483648]="BM_REV",e.EnumClarityCalculationMethod=void 0,(S=e.EnumClarityCalculationMethod||(e.EnumClarityCalculationMethod={}))[S.ECCM_CONTRAST=1]="ECCM_CONTRAST",e.EnumClarityFilterMode=void 0,(p=e.EnumClarityFilterMode||(e.EnumClarityFilterMode={}))[p.CFM_GENERAL=1]="CFM_GENERAL",e.EnumColourClusteringMode=void 0,(I=e.EnumColourClusteringMode||(e.EnumColourClusteringMode={}))[I.CCM_AUTO=1]="CCM_AUTO",I[I.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",I[I.CCM_SKIP=0]="CCM_SKIP",I[I.CCM_REV=2147483648]="CCM_REV",e.EnumColourConversionMode=void 0,(y=e.EnumColourConversionMode||(e.EnumColourConversionMode={}))[y.CICM_GENERAL=1]="CICM_GENERAL",y[y.CICM_SKIP=0]="CICM_SKIP",y[y.CICM_REV=2147483648]="CICM_REV",e.EnumConflictMode=void 0,(A=e.EnumConflictMode||(e.EnumConflictMode={}))[A.CM_IGNORE=1]="CM_IGNORE",A[A.CM_OVERWRITE=2]="CM_OVERWRITE",e.EnumDeblurMode=void 0,(T=e.EnumDeblurMode||(e.EnumDeblurMode={}))[T.DM_SKIP=0]="DM_SKIP",T[T.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",T[T.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",T[T.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",T[T.DM_SMOOTHING=8]="DM_SMOOTHING",T[T.DM_MORPHING=16]="DM_MORPHING",T[T.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",T[T.DM_SHARPENING=64]="DM_SHARPENING",T[T.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",T[T.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e.EnumDeformationResistingMode=void 0,(D=e.EnumDeformationResistingMode||(e.EnumDeformationResistingMode={}))[D.DRM_AUTO=1]="DRM_AUTO",D[D.DRM_GENERAL=2]="DRM_GENERAL",D[D.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",D[D.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",D[D.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",D[D.DRM_SKIP=0]="DRM_SKIP",D[D.DRM_REV=2147483648]="DRM_REV",e.EnumDPMCodeReadingMode=void 0,(C=e.EnumDPMCodeReadingMode||(e.EnumDPMCodeReadingMode={}))[C.DPMCRM_AUTO=1]="DPMCRM_AUTO",C[C.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",C[C.DPMCRM_SKIP=0]="DPMCRM_SKIP",C[C.DPMCRM_REV=2147483648]="DPMCRM_REV",e.EnumGrayscaleTransformationMode=void 0,(M=e.EnumGrayscaleTransformationMode||(e.EnumGrayscaleTransformationMode={}))[M.GTM_INVERTED=1]="GTM_INVERTED",M[M.GTM_ORIGINAL=2]="GTM_ORIGINAL",M[M.GTM_SKIP=0]="GTM_SKIP",M[M.GTM_REV=2147483648]="GTM_REV",e.EnumImagePreprocessingMode=void 0,(L=e.EnumImagePreprocessingMode||(e.EnumImagePreprocessingMode={}))[L.IPM_AUTO=1]="IPM_AUTO",L[L.IPM_GENERAL=2]="IPM_GENERAL",L[L.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",L[L.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",L[L.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",L[L.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",L[L.IPM_SKIP=0]="IPM_SKIP",L[L.IPM_REV=2147483648]="IPM_REV",e.EnumIntermediateResultSavingMode=void 0,(O=e.EnumIntermediateResultSavingMode||(e.EnumIntermediateResultSavingMode={}))[O.IRSM_MEMORY=1]="IRSM_MEMORY",O[O.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",O[O.IRSM_BOTH=4]="IRSM_BOTH",e.EnumIntermediateResultType=void 0,(b=e.EnumIntermediateResultType||(e.EnumIntermediateResultType={}))[b.IRT_NO_RESULT=0]="IRT_NO_RESULT",b[b.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",b[b.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",b[b.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",b[b.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",b[b.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",b[b.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",b[b.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",b[b.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",b[b.IRT_CONTOUR=256]="IRT_CONTOUR",b[b.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",b[b.IRT_FORM=1024]="IRT_FORM",b[b.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",b[b.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",b[b.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL",e.EnumLocalizationMode=void 0,(w=e.EnumLocalizationMode||(e.EnumLocalizationMode={}))[w.LM_SKIP=0]="LM_SKIP",w[w.LM_AUTO=1]="LM_AUTO",w[w.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",w[w.LM_LINES=8]="LM_LINES",w[w.LM_STATISTICS=4]="LM_STATISTICS",w[w.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",w[w.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",w[w.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",w[w.LM_CENTRE=128]="LM_CENTRE",w[w.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",w[w.LM_REV=2147483648]="LM_REV",e.EnumPDFReadingMode=void 0,(F=e.EnumPDFReadingMode||(e.EnumPDFReadingMode={}))[F.PDFRM_RASTER=1]="PDFRM_RASTER",F[F.PDFRM_AUTO=2]="PDFRM_AUTO",F[F.PDFRM_VECTOR=4]="PDFRM_VECTOR",F[F.PDFRM_REV=2147483648]="PDFRM_REV",e.EnumQRCodeErrorCorrectionLevel=void 0,(B=e.EnumQRCodeErrorCorrectionLevel||(e.EnumQRCodeErrorCorrectionLevel={}))[B.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",B[B.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",B[B.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",B[B.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q",e.EnumRegionPredetectionMode=void 0,(N=e.EnumRegionPredetectionMode||(e.EnumRegionPredetectionMode={}))[N.RPM_AUTO=1]="RPM_AUTO",N[N.RPM_GENERAL=2]="RPM_GENERAL",N[N.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",N[N.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",N[N.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",N[N.RPM_SKIP=0]="RPM_SKIP",N[N.RPM_REV=2147483648]="RPM_REV",e.EnumResultCoordinateType=void 0,(P=e.EnumResultCoordinateType||(e.EnumResultCoordinateType={}))[P.RCT_PIXEL=1]="RCT_PIXEL",P[P.RCT_PERCENTAGE=2]="RCT_PERCENTAGE",e.EnumResultType=void 0,(V=e.EnumResultType||(e.EnumResultType={}))[V.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",V[V.RT_RAW_TEXT=1]="RT_RAW_TEXT",V[V.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",V[V.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT",e.EnumScaleUpMode=void 0,(k=e.EnumScaleUpMode||(e.EnumScaleUpMode={}))[k.SUM_AUTO=1]="SUM_AUTO",k[k.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",k[k.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",k[k.SUM_SKIP=0]="SUM_SKIP",k[k.SUM_REV=2147483648]="SUM_REV",e.EnumTerminatePhase=void 0,(U=e.EnumTerminatePhase||(e.EnumTerminatePhase={}))[U.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",U[U.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",U[U.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",U[U.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",U[U.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",U[U.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED",e.EnumTextFilterMode=void 0,(x=e.EnumTextFilterMode||(e.EnumTextFilterMode={}))[x.TFM_AUTO=1]="TFM_AUTO",x[x.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",x[x.TFM_SKIP=0]="TFM_SKIP",x[x.TFM_REV=2147483648]="TFM_REV",e.EnumTextResultOrderMode=void 0,(G=e.EnumTextResultOrderMode||(e.EnumTextResultOrderMode={}))[G.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",G[G.TROM_POSITION=2]="TROM_POSITION",G[G.TROM_FORMAT=4]="TROM_FORMAT",G[G.TROM_SKIP=0]="TROM_SKIP",G[G.TROM_REV=2147483648]="TROM_REV",e.EnumTextureDetectionMode=void 0,(W=e.EnumTextureDetectionMode||(e.EnumTextureDetectionMode={}))[W.TDM_AUTO=1]="TDM_AUTO",W[W.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",W[W.TDM_SKIP=0]="TDM_SKIP",W[W.TDM_REV=2147483648]="TDM_REV",e.BarcodeReader=l,e.BarcodeScanner=m,Object.defineProperty(e,"__esModule",{value:!0})}));
