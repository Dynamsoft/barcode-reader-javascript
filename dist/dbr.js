/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 9.0.2 (js 20220505)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft.DBR={}))}(this,(function(e){"use strict";const t="undefined"==typeof self;let i;if(!t){const e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};e.init(),i={browser:e.browser,version:e.version,OS:e.OS}}t&&(i={browser:"ssr",version:0,OS:"ssr"});const n="undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||navigator.userAgent&&!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),o=!("undefined"==typeof Worker),r=!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),s=async()=>{let e=!1;if(r)try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e=!0}catch(e){}return e},a=(()=>{if(!t&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),d=" is not allowed to change after `createInstance` or `loadWasm` is called.",l=!t&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",c=!t&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",h=e=>{if(null==e)e=[];else{e=e instanceof Array?[...e]:[e];for(let i=0;i<e.length;++i){if(!t){let t=document.createElement("a");t.href=e[i],e[i]=t.href}e[i].endsWith("/")||(e[i]+="/")}}return e};var _,u,g,m;e.EnumImagePixelFormat=void 0,(_=e.EnumImagePixelFormat||(e.EnumImagePixelFormat={}))[_.IPF_Binary=0]="IPF_Binary",_[_.IPF_BinaryInverted=1]="IPF_BinaryInverted",_[_.IPF_GrayScaled=2]="IPF_GrayScaled",_[_.IPF_NV21=3]="IPF_NV21",_[_.IPF_RGB_565=4]="IPF_RGB_565",_[_.IPF_RGB_555=5]="IPF_RGB_555",_[_.IPF_RGB_888=6]="IPF_RGB_888",_[_.IPF_ARGB_8888=7]="IPF_ARGB_8888",_[_.IPF_RGB_161616=8]="IPF_RGB_161616",_[_.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",_[_.IPF_ABGR_8888=10]="IPF_ABGR_8888",_[_.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",_[_.IPF_BGR_888=12]="IPF_BGR_888",e.EnumErrorCode=void 0,(u=e.EnumErrorCode||(e.EnumErrorCode={}))[u.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",u[u.DBR_SUCCESS=0]="DBR_SUCCESS",u[u.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",u[u.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",u[u.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",u[u.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",u[u.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",u[u.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",u[u.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",u[u.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",u[u.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",u[u.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",u[u.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",u[u.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",u[u.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",u[u.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",u[u.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",u[u.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",u[u.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",u[u.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",u[u.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",u[u.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",u[u.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",u[u.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",u[u.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",u[u.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",u[u.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",u[u.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",u[u.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",u[u.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",u[u.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",u[u.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",u[u.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",u[u.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",u[u.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",u[u.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",u[u.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",u[u.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",u[u.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",u[u.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",u[u.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",u[u.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",u[u.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",u[u.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",u[u.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",u[u.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",u[u.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",u[u.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",u[u.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",u[u.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",u[u.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",u[u.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",u[u.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",u[u.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",u[u.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",u[u.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",u[u.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",u[u.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",u[u.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",u[u.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",u[u.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",u[u.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS",e.EnumIMResultDataType=void 0,(g=e.EnumIMResultDataType||(e.EnumIMResultDataType={}))[g.IMRDT_IMAGE=1]="IMRDT_IMAGE",g[g.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",g[g.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",g[g.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",g[g.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",g[g.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL",e.EnumBarcodeFormat=void 0,(m=e.EnumBarcodeFormat||(e.EnumBarcodeFormat={}))[m.BF_ALL=4265607167]="BF_ALL",m[m.BF_ONED=3147775]="BF_ONED",m[m.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",m[m.BF_CODE_39=1]="BF_CODE_39",m[m.BF_CODE_128=2]="BF_CODE_128",m[m.BF_CODE_93=4]="BF_CODE_93",m[m.BF_CODABAR=8]="BF_CODABAR",m[m.BF_ITF=16]="BF_ITF",m[m.BF_EAN_13=32]="BF_EAN_13",m[m.BF_EAN_8=64]="BF_EAN_8",m[m.BF_UPC_A=128]="BF_UPC_A",m[m.BF_UPC_E=256]="BF_UPC_E",m[m.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",m[m.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",m[m.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",m[m.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",m[m.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",m[m.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",m[m.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",m[m.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",m[m.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",m[m.BF_PATCHCODE=262144]="BF_PATCHCODE",m[m.BF_PDF417=33554432]="BF_PDF417",m[m.BF_QR_CODE=67108864]="BF_QR_CODE",m[m.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",m[m.BF_AZTEC=268435456]="BF_AZTEC",m[m.BF_MAXICODE=536870912]="BF_MAXICODE",m[m.BF_MICRO_QR=1073741824]="BF_MICRO_QR",m[m.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",m[m.BF_GS1_COMPOSITE=2147483648]="BF_GS1_COMPOSITE",m[m.BF_MSI_CODE=1048576]="BF_MSI_CODE",m[m.BF_CODE_11=2097152]="BF_CODE_11",m[m.BF_NULL=0]="BF_NULL";const f=e=>e&&"object"==typeof e&&"function"==typeof e.then;var p=function(){this.init()};p.prototype={init:function(){var e=this||v;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||v;if(e=parseFloat(e),t.ctx||C(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,v.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),o=0;o<n.length;o++){var r=t._howls[i]._soundById(n[o]);r&&r._node&&(r._node.volume=r._volume*e)}return t}return t._volume},mute:function(e){var t=this||v;t.ctx||C(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,v.ctx.currentTime);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var n=t._howls[i]._getSoundIds(),o=0;o<n.length;o++){var r=t._howls[i]._soundById(n[o]);r&&r._node&&(r._node.muted=!!e||r._muted)}return t},stop:function(){for(var e=this||v,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||v,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,C()),e},codecs:function(e){return(this||v)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||v;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||v,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),n=e._navigator?e._navigator.userAgent:"",o=n.match(/OPR\/([0-6].)/g),r=o&&parseInt(o[0].split("/")[1],10)<33,s=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),a=n.match(/Version\/(.*?) /),d=s&&a&&parseInt(a[1],10)<15;return e._codecs={mp3:!(r||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(d||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||v;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(i){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,e._releaseHtml5Audio(n)}catch(i){e.noAudio=!0;break}for(var o=0;o<e._howls.length;o++)if(!e._howls[o]._webAudio)for(var r=e._howls[o]._getSoundIds(),s=0;s<r.length;s++){var a=e._howls[o]._soundById(r[s]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}e._autoResume();var d=e.ctx.createBufferSource();d.buffer=e._scratchBuffer,d.connect(e.ctx.destination),void 0===d.start?d.noteOn(0):d.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),d.onended=function(){d.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||v;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||v;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&v.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&v.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var v=new p,A=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};A.prototype={init:function(e){var t=this;return v.ctx||C(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=v.usingWebAudio&&!t._html5,void 0!==v.ctx&&v.ctx&&v.autoUnlock&&v._unlockAudio(),v._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(v.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var n,o;if(e._format&&e._format[i])n=e._format[i];else{if("string"!=typeof(o=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(n=/^data:audio\/([^;,]+);/i.exec(o))||(n=/\.([^.]+)$/.exec(o.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&v.codecs(n)){t=e._src[i];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new R(e),e._webAudio&&E(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var i=this,n=null;if("number"==typeof e)n=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if(void 0===e&&(e="__default",!i._playLock)){for(var o=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(o++,n=i._sounds[r]._id);1===o?e=null:n=null}}var s=n?i._soundById(n):i._inactiveSound();if(!s)return null;if(n&&!e&&(e=s._sprite||"__default"),"loaded"!==i._state){s._sprite=e,s._ended=!1;var a=s._id;return i._queue.push({event:"play",action:function(){i.play(a)}}),a}if(n&&!s._paused)return t||i._loadQueue("play"),s._id;i._webAudio&&v._autoResume();var d=Math.max(0,s._seek>0?s._seek:i._sprite[e][0]/1e3),l=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-d),c=1e3*l/Math.abs(s._rate),h=i._sprite[e][0]/1e3,_=(i._sprite[e][0]+i._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var u=function(){s._paused=!1,s._seek=d,s._start=h,s._stop=_,s._loop=!(!s._loop&&!i._sprite[e][2])};if(!(d>=_)){var g=s._node;if(i._webAudio){var m=function(){i._playLock=!1,u(),i._refreshBuffer(s);var e=s._muted||i._muted?0:s._volume;g.gain.setValueAtTime(e,v.ctx.currentTime),s._playStart=v.ctx.currentTime,void 0===g.bufferSource.start?s._loop?g.bufferSource.noteGrainOn(0,d,86400):g.bufferSource.noteGrainOn(0,d,l):s._loop?g.bufferSource.start(0,d,86400):g.bufferSource.start(0,d,l),c!==1/0&&(i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),c)),t||setTimeout((function(){i._emit("play",s._id),i._loadQueue()}),0)};"running"===v.state&&"interrupted"!==v.ctx.state?m():(i._playLock=!0,i.once("resume",m),i._clearTimer(s._id))}else{var f=function(){g.currentTime=d,g.muted=s._muted||i._muted||v._muted||g.muted,g.volume=s._volume*v.volume(),g.playbackRate=s._rate;try{var n=g.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(i._playLock=!0,u(),n.then((function(){i._playLock=!1,g._unlocked=!0,t?i._loadQueue():i._emit("play",s._id)})).catch((function(){i._playLock=!1,i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):t||(i._playLock=!1,u(),i._emit("play",s._id)),g.playbackRate=s._rate,g.paused)return void i._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?i._endTimers[s._id]=setTimeout(i._ended.bind(i,s),c):(i._endTimers[s._id]=function(){i._ended(s),g.removeEventListener("ended",i._endTimers[s._id],!1)},g.addEventListener("ended",i._endTimers[s._id],!1))}catch(e){i._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=i._src,g.load());var p=window&&window.ejecta||!g.readyState&&v._navigator.isCocoonJS;if(g.readyState>=3||p)f();else{i._playLock=!0,i._state="loading";var A=function(){i._state="loaded",f(),g.removeEventListener(v._canPlayEvent,A,!1)};g.addEventListener(v._canPlayEvent,A,!1),i._clearTimer(s._id)}}return s._id}i._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var i=t._getSoundIds(e),n=0;n<i.length;n++){t._clearTimer(i[n]);var o=t._soundById(i[n]);if(o&&!o._paused&&(o._seek=t.seek(i[n]),o._rateSeek=0,o._paused=!0,t._stopFade(i[n]),o._node))if(t._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o?o._id:null)}return t},stop:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(e)}}),i;for(var n=i._getSoundIds(e),o=0;o<n.length;o++){i._clearTimer(n[o]);var r=i._soundById(n[o]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,i._stopFade(n[o]),r._node&&(i._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),i._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause(),r._node.duration===1/0&&i._clearSound(r._node))),t||i._emit("stop",r._id))}return i},mute:function(e,t){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if(void 0===t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var n=i._getSoundIds(t),o=0;o<n.length;o++){var r=i._soundById(n[o]);r&&(r._muted=e,r._interval&&i._stopFade(r._id),i._webAudio&&r._node?r._node.gain.setValueAtTime(e?0:r._volume,v.ctx.currentTime):r._node&&(r._node.muted=!!v._muted||e),i._emit("mute",r._id))}return i},volume:function(){var e,t,i,n=this,o=arguments;if(0===o.length)return n._volume;if(1===o.length||2===o.length&&void 0===o[1]){var r=n._getSoundIds(),s=r.indexOf(o[0]);s>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if(!(void 0!==e&&e>=0&&e<=1))return(i=t?n._soundById(t):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,o)}}),n;void 0===t&&(n._volume=e),t=n._getSoundIds(t);for(var a=0;a<t.length;a++)(i=n._soundById(t[a]))&&(i._volume=e,o[2]||n._stopFade(t[a]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(e,v.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=e*v.volume()),n._emit("volume",i._id));return n},fade:function(e,t,i,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(e,t,i,n)}}),o;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),i=parseFloat(i),o.volume(e,n);for(var r=o._getSoundIds(n),s=0;s<r.length;s++){var a=o._soundById(r[s]);if(a){if(n||o._stopFade(r[s]),o._webAudio&&!a._muted){var d=v.ctx.currentTime,l=d+i/1e3;a._volume=e,a._node.gain.setValueAtTime(e,d),a._node.gain.linearRampToValueAtTime(t,l)}o._startFadeInterval(a,e,t,i,r[s],void 0===n)}}return o},_startFadeInterval:function(e,t,i,n,o,r){var s=this,a=t,d=i-t,l=Math.abs(d/.01),c=Math.max(4,l>0?n/l:n),h=Date.now();e._fadeTo=i,e._interval=setInterval((function(){var o=(Date.now()-h)/n;h=Date.now(),a+=d*o,a=Math.round(100*a)/100,a=d<0?Math.max(i,a):Math.min(i,a),s._webAudio?e._volume=a:s.volume(a,e._id,!0),r&&(s._volume=a),(i<t&&a<=i||i>t&&a>=i)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,s.volume(i,e._id),s._emit("fade",e._id))}),c)},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(v.ctx.currentTime),clearInterval(i._interval),i._interval=null,t.volume(i._fadeTo,e),i._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,i,n=this,o=arguments;if(0===o.length)return n._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(i=n._soundById(parseInt(o[0],10)))&&i._loop;e=o[0],n._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=n._getSoundIds(t),s=0;s<r.length;s++)(i=n._soundById(r[s]))&&(i._loop=e,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=e,e&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,n.playing(r[s])&&(n.pause(r[s],!0),n.play(r[s],!0)))));return n},rate:function(){var e,t,i,n=this,o=arguments;if(0===o.length)t=n._sounds[0]._id;else if(1===o.length){var r=n._getSoundIds(),s=r.indexOf(o[0]);s>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if("number"!=typeof e)return(i=n._soundById(t))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,o)}}),n;void 0===t&&(n._rate=e),t=n._getSoundIds(t);for(var a=0;a<t.length;a++)if(i=n._soundById(t[a])){n.playing(t[a])&&(i._rateSeek=n.seek(t[a]),i._playStart=n._webAudio?v.ctx.currentTime:i._playStart),i._rate=e,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(e,v.ctx.currentTime):i._node&&(i._node.playbackRate=e);var d=n.seek(t[a]),l=(n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-d,c=1e3*l/Math.abs(i._rate);!n._endTimers[t[a]]&&i._paused||(n._clearTimer(t[a]),n._endTimers[t[a]]=setTimeout(n._ended.bind(n,i),c)),n._emit("rate",i._id)}return n},seek:function(){var e,t,i=this,n=arguments;if(0===n.length)i._sounds.length&&(t=i._sounds[0]._id);else if(1===n.length){var o=i._getSoundIds(),r=o.indexOf(n[0]);r>=0?t=parseInt(n[0],10):i._sounds.length&&(t=i._sounds[0]._id,e=parseFloat(n[0]))}else 2===n.length&&(e=parseFloat(n[0]),t=parseInt(n[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var s=i._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var a=i.playing(t)?v.ctx.currentTime-s._playStart:0,d=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(d+a*Math.abs(s._rate))}return s._node.currentTime}var l=i.playing(t);l&&i.pause(t,!0),s._seek=e,s._ended=!1,i._clearTimer(t),i._webAudio||!s._node||isNaN(s._node.duration)||(s._node.currentTime=e);var c=function(){l&&i.play(t,!0),i._emit("seek",t)};if(l&&!i._webAudio){var h=function(){i._playLock?setTimeout(h,0):c()};setTimeout(h,0)}else c()}return i},playing:function(e){var t=this;if("number"==typeof e){var i=t._soundById(e);return!!i&&!i._paused}for(var n=0;n<t._sounds.length;n++)if(!t._sounds[n]._paused)return!0;return!1},duration:function(e){var t=this,i=t._duration,n=t._soundById(e);return n&&(i=t._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++)t[i]._paused||e.stop(t[i]._id),e._webAudio||(e._clearSound(t[i]._node),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(v._canPlayEvent,t[i]._loadFn,!1),t[i]._node.removeEventListener("ended",t[i]._endFn,!1),v._releaseHtml5Audio(t[i]._node)),delete t[i]._node,e._clearTimer(t[i]._id);var n=v._howls.indexOf(e);n>=0&&v._howls.splice(n,1);var o=!0;for(i=0;i<v._howls.length;i++)if(v._howls[i]._src===e._src||e._src.indexOf(v._howls[i]._src)>=0){o=!1;break}return S&&o&&delete S[e._src],v.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,i,n){var o=this["_on"+e];return"function"==typeof t&&o.push(n?{id:i,fn:t,once:n}:{id:i,fn:t}),this},off:function(e,t,i){var n=this,o=n["_on"+e],r=0;if("number"==typeof t&&(i=t,t=null),t||i)for(r=0;r<o.length;r++){var s=i===o[r].id;if(t===o[r].fn&&s||!t&&s){o.splice(r,1);break}}else if(e)n["_on"+e]=[];else{var a=Object.keys(n);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(n[a[r]])&&(n[a[r]]=[])}return n},once:function(e,t,i){return this.on(e,t,i,1),this},_emit:function(e,t,i){for(var n=this,o=n["_on"+e],r=o.length-1;r>=0;r--)o[r].id&&o[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,i)}.bind(n,o[r].fn),0),o[r].once&&n.off(e,o[r].fn,o[r].id));return n._loadQueue(e),n},_loadQueue:function(e){var t=this;if(t._queue.length>0){var i=t._queue[0];i.event===e&&(t._queue.shift(),t._loadQueue()),e||i.action()}return t},_ended:function(e){var t=this,i=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var n=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&n&&t.stop(e._id,!0).play(e._id),t._webAudio&&n){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=v.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)}return t._webAudio&&!n&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),v._autoSuspend()),t._webAudio||n||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var i=t._soundById(e);i&&i._node&&i._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,i=0;i<t._sounds.length;i++)if(e===t._sounds[i]._id)return t._sounds[i];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new R(e)},_drain:function(){var e=this,t=e._pool,i=0,n=0;if(!(e._sounds.length<t)){for(n=0;n<e._sounds.length;n++)e._sounds[n]._ended&&i++;for(n=e._sounds.length-1;n>=0;n--){if(i<=t)return;e._sounds[n]._ended&&(e._webAudio&&e._sounds[n]._node&&e._sounds[n]._node.disconnect(0),e._sounds.splice(n,1),i--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],i=0;i<this._sounds.length;i++)t.push(this._sounds[i]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=v.ctx.createBufferSource(),e._node.bufferSource.buffer=S[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,v.ctx.currentTime),this},_cleanBuffer:function(e){var t=v._navigator&&v._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return this;if(v._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=v._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(v._navigator&&v._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var R=function(e){this._parent=e,this.init()};R.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++v._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=v._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===v.ctx.createGain?v.ctx.createGainNode():v.ctx.createGain(),e._node.gain.setValueAtTime(i,v.ctx.currentTime),e._node.paused=!0,e._node.connect(v.masterGain)):v.noAudio||(e._node=v._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(v._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=i*v.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++v._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(v._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var S={},E=function(e){var t=e._src;if(S[t])return e._duration=S[t].duration,void T(e);if(/^data:[^;]+;base64,/.test(t)){for(var i=atob(t.split(",")[1]),n=new Uint8Array(i.length),o=0;o<i.length;++o)n[o]=i.charCodeAt(o);y(n.buffer,e)}else{var r=new XMLHttpRequest;r.open(e._xhr.method,t,!0),r.withCredentials=e._xhr.withCredentials,r.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){r.setRequestHeader(t,e._xhr.headers[t])})),r.onload=function(){var t=(r.status+"")[0];"0"===t||"2"===t||"3"===t?y(r.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+r.status+".")},r.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete S[t],e.load())},I(r)}},I=function(e){try{e.send()}catch(t){e.onerror()}},y=function(e,t){var i=function(){t._emit("loaderror",null,"Decoding audio data failed.")},n=function(e){e&&t._sounds.length>0?(S[t._src]=e,T(t,e)):i()};"undefined"!=typeof Promise&&1===v.ctx.decodeAudioData.length?v.ctx.decodeAudioData(e).then(n).catch(i):v.ctx.decodeAudioData(e,n,i)},T=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},C=function(){if(v.usingWebAudio){try{"undefined"!=typeof AudioContext?v.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?v.ctx=new webkitAudioContext:v.usingWebAudio=!1}catch(e){v.usingWebAudio=!1}v.ctx||(v.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(v._navigator&&v._navigator.platform),t=v._navigator&&v._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=t?parseInt(t[1],10):null;if(e&&i&&i<9){var n=/safari/.test(v._navigator&&v._navigator.userAgent.toLowerCase());v._navigator&&!n&&(v.usingWebAudio=!1)}v.usingWebAudio&&(v.masterGain=void 0===v.ctx.createGain?v.ctx.createGainNode():v.ctx.createGain(),v.masterGain.gain.setValueAtTime(v._muted?0:v._volume,v.ctx.currentTime),v.masterGain.connect(v.ctx.destination)),v._setup()}};!function(e,t,i,n){var o;e.prototype._pos=[0,0,0],e.prototype._orientation=[0,0,-1,0,1,0],e.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var i=t._howls.length-1;i>=0;i--)t._howls[i].stereo(e);return t},e.prototype.pos=function(e,i,n){var o=this;return o.ctx&&o.ctx.listener?(i="number"!=typeof i?o._pos[1]:i,n="number"!=typeof n?o._pos[2]:n,"number"!=typeof e?o._pos:(o._pos=[e,i,n],void 0!==o.ctx.listener.positionX?(o.ctx.listener.positionX.setTargetAtTime(o._pos[0],t.ctx.currentTime,.1),o.ctx.listener.positionY.setTargetAtTime(o._pos[1],t.ctx.currentTime,.1),o.ctx.listener.positionZ.setTargetAtTime(o._pos[2],t.ctx.currentTime,.1)):o.ctx.listener.setPosition(o._pos[0],o._pos[1],o._pos[2]),o)):o},e.prototype.orientation=function(e,i,n,o,r,s){var a=this;if(!a.ctx||!a.ctx.listener)return a;var d=a._orientation;return i="number"!=typeof i?d[1]:i,n="number"!=typeof n?d[2]:n,o="number"!=typeof o?d[3]:o,r="number"!=typeof r?d[4]:r,s="number"!=typeof s?d[5]:s,"number"!=typeof e?d:(a._orientation=[e,i,n,o,r,s],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(e,t.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(i,t.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(n,t.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(o,t.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(r,t.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(s,t.ctx.currentTime,.1)):a.ctx.listener.setOrientation(e,i,n,o,r,s),a)},i.prototype.init=(o=i.prototype.init,function(e){var t=this;return t._orientation=e.orientation||[1,0,0],t._stereo=e.stereo||null,t._pos=e.pos||null,t._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},t._onstereo=e.onstereo?[{fn:e.onstereo}]:[],t._onpos=e.onpos?[{fn:e.onpos}]:[],t._onorientation=e.onorientation?[{fn:e.onorientation}]:[],o.call(this,e)}),i.prototype.stereo=function(e,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(e,i)}}),n;var o=void 0===t.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof e)return n._stereo;n._stereo=e,n._pos=[e,0,0]}for(var s=n._getSoundIds(i),a=0;a<s.length;a++){var d=n._soundById(s[a]);if(d){if("number"!=typeof e)return d._stereo;d._stereo=e,d._pos=[e,0,0],d._node&&(d._pannerAttr.panningModel="equalpower",d._panner&&d._panner.pan||r(d,o),"spatial"===o?void 0!==d._panner.positionX?(d._panner.positionX.setValueAtTime(e,t.ctx.currentTime),d._panner.positionY.setValueAtTime(0,t.ctx.currentTime),d._panner.positionZ.setValueAtTime(0,t.ctx.currentTime)):d._panner.setPosition(e,0,0):d._panner.pan.setValueAtTime(e,t.ctx.currentTime)),n._emit("stereo",d._id)}}return n},i.prototype.pos=function(e,i,n,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(e,i,n,o)}}),s;if(i="number"!=typeof i?0:i,n="number"!=typeof n?-.5:n,void 0===o){if("number"!=typeof e)return s._pos;s._pos=[e,i,n]}for(var a=s._getSoundIds(o),d=0;d<a.length;d++){var l=s._soundById(a[d]);if(l){if("number"!=typeof e)return l._pos;l._pos=[e,i,n],l._node&&(l._panner&&!l._panner.pan||r(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(e,t.ctx.currentTime),l._panner.positionY.setValueAtTime(i,t.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,t.ctx.currentTime)):l._panner.setPosition(e,i,n)),s._emit("pos",l._id)}}return s},i.prototype.orientation=function(e,i,n,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(e,i,n,o)}}),s;if(i="number"!=typeof i?s._orientation[1]:i,n="number"!=typeof n?s._orientation[2]:n,void 0===o){if("number"!=typeof e)return s._orientation;s._orientation=[e,i,n]}for(var a=s._getSoundIds(o),d=0;d<a.length;d++){var l=s._soundById(a[d]);if(l){if("number"!=typeof e)return l._orientation;l._orientation=[e,i,n],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),r(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(e,t.ctx.currentTime),l._panner.orientationY.setValueAtTime(i,t.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,t.ctx.currentTime)):l._panner.setOrientation(e,i,n)),s._emit("orientation",l._id)}}return s},i.prototype.pannerAttr=function(){var e,t,i,n=this,o=arguments;if(!n._webAudio)return n;if(0===o.length)return n._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(i=n._soundById(parseInt(o[0],10)))?i._pannerAttr:n._pannerAttr;e=o[0],void 0===t&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),n._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:n._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:n._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:n._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:n._panningModel})}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var s=n._getSoundIds(t),a=0;a<s.length;a++)if(i=n._soundById(s[a])){var d=i._pannerAttr;d={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:d.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:d.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:d.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:d.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:d.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:d.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:d.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:d.panningModel};var l=i._panner;l||(i._pos||(i._pos=n._pos||[0,0,-.5]),r(i,"spatial"),l=i._panner),l.coneInnerAngle=d.coneInnerAngle,l.coneOuterAngle=d.coneOuterAngle,l.coneOuterGain=d.coneOuterGain,l.distanceModel=d.distanceModel,l.maxDistance=d.maxDistance,l.refDistance=d.refDistance,l.rolloffFactor=d.rolloffFactor,l.panningModel=d.panningModel}return n},n.prototype.init=function(e){return function(){var t=this,i=t._parent;t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,e.call(this),t._stereo?i.stereo(t._stereo):t._pos&&i.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(n.prototype.init),n.prototype.reset=function(e){return function(){var t=this,i=t._parent;return t._orientation=i._orientation,t._stereo=i._stereo,t._pos=i._pos,t._pannerAttr=i._pannerAttr,t._stereo?i.stereo(t._stereo):t._pos?i.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,i._refreshBuffer(t)),e.call(this)}}(n.prototype.reset);var r=function(e,i){"spatial"===(i=i||"spatial")?(e._panner=t.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],t.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],t.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],t.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],t.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],t.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],t.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=t.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,t.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}(p,v,A,R);class w{constructor(){this._canvasMaxWH="iPhone"==i.OS||"Android"==i.OS?2048:4096,this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this.resultsOverlay=null,this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.beepSound=new A({src:["data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}}),this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.barcodeFillStyle="rgba(254,180,32,0.3)",this.barcodeStrokeStyle="rgba(254,180,32,0.9)",this.barcodeLineWidth=1,this._dce=null,this.dceConfig={},this.imgSource=null,this._maxCvsSideLength="iPhone"==i.OS||"Android"==i.OS?2048:4096,this._tempSolutionStatus="closed"}static get version(){return this._version}static get license(){return this._license}static set license(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`license`"+d);i._license=t})(w,e)}static get productKeys(){return this._license}static set productKeys(e){w.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){w.license=e}static get organizationID(){return this._license}static set organizationID(e){w.license=e}static set sessionPassword(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`sessionPassword`"+d);i._sessionPassword=t})(w,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:n,worker:o,getUserMedia:r,camera:await s(),browser:i.browser,version:i.version,OS:i.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");w._engineResourcePath=(e=>{if(null==e&&(e="./"),!t){let t=document.createElement("a");t.href=e,e=t.href}return e.endsWith("/")||(e+="/"),e})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`licenseServer`"+d);i._licenseServer=h(t)})(w,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((e,t)=>{const i=e;if(!i._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+d);i._deviceFriendlyName=t||""})(w,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");w.__bUseFullFeature=e}static isImageSource(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("width"in e&&("height"in e&&"pixelFormat"in e)))}static isCameraEnhancer(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("referenceConfigurationArray"in e&&("isOpen"in e&&("on"in e&&("off"in e&&("startFetchingLoop"in e&&("stopFetchingLoop"in e&&("getUIElement"in e&&("video"in e&&("isFetchingLoopStarted"in e&&("numberOfFramesInBuffer"in e&&("getFrameFromBuffer"in e&&("addScanRegionOverlayCanvas"in e&&("ifShowScanRegionLaser"in e&&("open"in e&&"close"in e))))))))))))))}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&("data"in e&&("region"in e&&("sx"in e&&("sy"in e&&("width"in e&&("height"in e&&("colorMode"in e&&("timeSpent"in e&&("timeStamp"in e&&("isCropped"in e&&("toCanvas"in e&&"_bUseWebGL"in e)))))))))))}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return null===(e=w._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",w.engineResourcePath)}static set defaultUIElementURL(e){w._defaultUIElementURL=e}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new A({src:[this._soundSource],onplayerror:(e,t)=>{console.warn(`Sound '${e}' playback failure: ${t}`)}})}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set dce(e){this._dce=e}get dce(){return w.isCameraEnhancer(this._dce)?this._dce:null}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dceConfig.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}updateDCEConfig(){if(!this.dce)return;w._onLog&&w._onLog("updateDCEConfig()"),this.dceConfig={bufferRefreshInterval:200,maxCvsSideLength:this._maxCvsSideLength};let e=this.dce.referenceConfigurationArray.indexOf(this.dceConfig);for(;-1!==e;)this.dce.referenceConfigurationArray.splice(e,1),e=this.dce.referenceConfigurationArray.indexOf(this.dceConfig);this.dce.referenceConfigurationArray.push(this.dceConfig),this.callbackCameraChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async e=>{let t=await this._decode_DCEFrame(e,{bCopyData:!1});await this.clearMapDecodeRecord();for(let e of t)delete e.bUnduplicated;if(this._drawResults(t),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan&&this.onImageRead(t),this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let e of t)this.onUniqueRead(e.barcodeText,e)},this.dce.on("cameraChange",this.callbackCameraChange),this.dce.on("resolutionChange",this.callbackResolutionChange),this.dce.on("cameraClose",this.callbackCameraClose),this.dce.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}releaseDCEConfig(){if(this.dce){if(w._onLog&&w._onLog("releaseDCEConfig()"),this.dce&&w.isCameraEnhancer(this.dce)){let e=this.dce.referenceConfigurationArray.indexOf(this.dceConfig);for(;-1!==e;)this.dce.referenceConfigurationArray.splice(e,1),e=this.dce.referenceConfigurationArray.indexOf(this.dceConfig);if(this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this.dce.stopFetchingLoop(),this.resultsOverlay){let e=this.dce._arrScanRegionOverlays.indexOf(this.resultsOverlay);for(;-1!==e;)this.dce._arrScanRegionOverlays.splice(e,1),e=this.dce._arrScanRegionOverlays.indexOf(this.resultsOverlay);this.resultsOverlay.remove(),this.resultsOverlay=null}}this.dce=null}}setImageSource(e){if(null==e)return this.imgSource=null,void this.releaseDCEConfig();if(w.isCameraEnhancer(e))this.dce=e,this.updateDCEConfig(),this.imgSource=null;else{if(!w.isImageSource(e))throw new Error("Invalid value.");this.releaseDCEConfig(),this.imgSource=e}}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:t,ls:n,sp:o,rmk:r}=(e=>{const t=e;if(t._pLoad.isEmpty){let e,i,n=t._license||"",o=JSON.parse(JSON.stringify(t._licenseServer)),r=t._sessionPassword,s=0;if(n.startsWith("t")||n.startsWith("f"))s=0;else if(0===n.length||n.startsWith("P")||n.startsWith("L")||n.startsWith("Y")||n.startsWith("A"))s=1;else{s=2;const t=n.indexOf(":");if(-1!=t&&(n=n.substring(t+1)),n.startsWith("DLS2")){let t=n.substring(4);try{t=atob(t)}catch(e){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}const i=JSON.parse(t);if(n=i.handshakeCode?i.handshakeCode:i.organizationID?i.organizationID:"","number"==typeof n&&(n=JSON.stringify(n)),0===o.length){let e=[];i.mainServerURL&&(e[0]=i.mainServerURL),i.standbyServerURL&&(e[1]=i.standbyServerURL),o=h(e)}!r&&i.sessionPassword&&(r=i.sessionPassword),e=i.remark}("200001"===n||n.startsWith("200001-"))&&(o&&o.length||(n="")),n||(s=1)}if(s&&(globalThis.crypto||(i="Please upgrade your browser to support online key."),globalThis.crypto.subtle||(i="Require https to use online key in this browser.")),i){if(1!==s)throw new Error(i);s=0,console.warn(i),t._lastErrorCode=-1,t._lastErrorString=i}return 1===s&&(n="",console.warn("Applying for a public trial license ...")),{lt:s,l:n,ls:o,sp:r,rmk:e}}throw new Error("Can't preprocess license again"+d)})(w);this._pLoad.task=async(s,a)=>{let d=w.engineResourcePath+w._workerName;w.engineResourcePath.startsWith(location.origin)||(d=await fetch(d).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),w._dbrWorker=new Worker(d),w._dbrWorker.onerror=e=>{let t=new Error(e.message);a(t)},w._dbrWorker.onmessage=async t=>{let i=t.data?t.data:t;switch(i.type){case"log":w._onLog&&w._onLog(i.message);break;case"load":{i.message&&(i.message=i.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let t,n=!1;1===e&&(n=!0),i.success?(w._dbrWorker.onerror=null,w._version=i.version+"(JS "+w._jsVersion+"."+w._jsEditVersion+")",w._onLog&&w._onLog("load dbr worker success"),i.message&&console.warn(i.message)):(t=new Error(i.message),t.stack=i.stack+"\n"+t.stack,n||111==i.ltsErrorCode&&-1!=i.message.toLowerCase().indexOf("trial license")&&(n=!0)),n&&w.showDialog(i.success?"warn":"error",i.message),i.success?s():a(t);break}case"task":{let e=i.id,t=i.body;try{w._taskCallbackMap.get(e)(t),w._taskCallbackMap.delete(e)}catch(t){throw w._taskCallbackMap.delete(e),t}break}default:w._onLog&&w._onLog(t)}},w._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:w.engineResourcePath,bUseFullFeature:w._bUseFullFeature,bd:w._bWasmDebug,v:w._jsVersion,brtk:!!e,bptk:1===e,l:t,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:i,fn:w.deviceFriendlyName,ls:n,sp:o,rmk:r})}}await this._pLoad}static async showDialog(e,t){if(!w._bNeverShowDialog)try{let i=await fetch(w.engineResourcePath+"dls.license.dialog.html");if(!i.ok)throw Error("Get license dialog fail. Network Error: "+i.statusText);let n=await i.text();if(!n.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=n;let r=[];for(let e=0;e<o.childElementCount;++e){let t=o.children[e];t instanceof HTMLStyleElement&&(r.push(t),document.head.append(t))}let s=1==o.childElementCount?o.children[0]:o;s.remove();let a,d,l,c,h,_=[s],u=s.children;for(let e of u)_.push(e);for(let e=0;e<_.length;++e)for(let t of _[e].children)_.push(t);for(let i of _)if(!a&&i.classList.contains("dls-license-mask"))a=i,i.addEventListener("click",(e=>{if(i==e.target){s.remove();for(let e of r)e.remove()}}));else if(!d&&i.classList.contains("dls-license-icon-close"))d=i,i.addEventListener("click",(()=>{s.remove();for(let e of r)e.remove()}));else if(!l&&i.classList.contains("dls-license-icon-error"))l=i,"error"!=e&&i.remove();else if(!c&&i.classList.contains("dls-license-icon-warn"))c=i,"warn"!=e&&i.remove();else if(!h&&i.classList.contains("dls-license-msg-content")){h=i;let e=t;for(;e;){let t=e.indexOf("["),n=e.indexOf("]",t),o=e.indexOf("(",n),r=e.indexOf(")",o);if(-1==t||-1==n||-1==o||-1==r){i.appendChild(new Text(e));break}t>0&&i.appendChild(new Text(e.substring(0,t)));let s=document.createElement("a"),a=e.substring(t+1,n);s.innerText=a;let d=e.substring(o+1,r);s.setAttribute("href",d),s.setAttribute("target","_blank"),i.appendChild(s),e=e.substring(r+1)}}document.body.appendChild(s)}catch(e){w._onLog&&w._onLog(e.message||e)}}static async createInstanceInWorker(e=!1){return await w.loadWasm(),await new Promise(((t,i)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),w._dbrWorker.postMessage({type:"createInstance",id:n,bScanner:e})}))}static async createInstance(){let e=new w;return e._instanceID=await w.createInstanceInWorker(),e}async clearMapDecodeRecord(){return await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:i,instanceID:this._instanceID})}))}async decode(e){w._onLog&&w._onLog("decode(source: any)"),w._onLog&&(this._timeStartDecode=Date.now());{let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,t):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?await this._decode_Image(e,t):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,t):e instanceof HTMLVideoElement?await this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?await this._decode_Base64(e,t):await this._decode_Url(e,t):w.isDCEFrame(e)?(t.bCopyData=!0,await this._decode_DCEFrame(e,t)):w.isDSImage(e)?(t.bCopyData=!0,await this._decode_DSImage(e,t)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}async decodeBase64String(e){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}async decodeUrl(e){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}async _decodeBuffer_Uint8Array(e,t,i,n,o,r){return await new Promise(((s,a)=>{let d=w._nextTaskID++;w._taskCallbackMap.set(d,(e=>{if(e.success){let t,i=w._onLog?Date.now():0;w._onLog&&w._onLog("worker return result: "+i),this._lastInnerDecodeDuration=e.duration;try{t=this._handleRetJsonString(e.decodeReturn)}catch(e){return a(e)}if(w._onLog){let e=Date.now();w._onLog("DBR time get result: "+i),w._onLog("Handle image cost: "+(this._timeEnterInnerDBR-this._timeStartDecode)),w._onLog("DBR worker decode image cost: "+(i-this._timeEnterInnerDBR)),w._onLog("DBR worker handle results: "+(e-i)),w._onLog("Total decode image cost: "+(e-this._timeStartDecode))}return s(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}})),this._timeEnterInnerDBR=Date.now(),w._onLog&&w._onLog("Send buffer to worker:"+this._timeEnterInnerDBR),w._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:this._instanceID,body:{buffer:e,width:t,height:i,stride:n,format:o,config:r}},[e.buffer]),w._onLog&&r&&r.timeStamp&&w._onLog("decode image delay: "+(this._timeEnterInnerDBR-r.timeStamp))}))}async _decodeBuffer_Blob(e,t,i,n,o,r){w._onLog&&w._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const s=e.arrayBuffer?await e.arrayBuffer():await new Promise(((t,i)=>{let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{t(n.result)},n.onerror=()=>{i(n.error)}}));return await this._decodeBuffer_Uint8Array(new Uint8Array(s),t,i,n,o,r)}async decodeBuffer(e,t,i,n,o,r){let s;return w._onLog&&w._onLog("decodeBuffer(buffer,width,height,stride,format)"),w._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?s=await this._decodeBuffer_Uint8Array(e,t,i,n,o,r):e instanceof ArrayBuffer?s=await this._decodeBuffer_Uint8Array(new Uint8Array(e),t,i,n,o,r):e instanceof Blob&&(s=await this._decodeBuffer_Blob(e,t,i,n,o,r)),s}async _decodeFileInMemory_Uint8Array(e){return await new Promise(((t,i)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(e=>{if(e.success){let n;this._lastInnerDecodeDuration=e.duration;try{n=this._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),w._dbrWorker.postMessage({type:"decodeFileInMemory",id:n,instanceID:this._instanceID,body:{bytes:e}})}))}async getRuntimeSettings(){return await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success){let t=JSON.parse(i.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:this._instanceID})}))}async updateRuntimeSettings(t){let i;if("string"==typeof t)if("speed"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,i.region=e.region}else i=JSON.parse(t);else{if("object"!=typeof t)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(t)),i.region instanceof Array){let e=i.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(i.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!w._bUseFullFeature){if(0!=(i.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let e=i.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return await new Promise(((e,t)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(i=>{if(i.success){try{this._handleRetJsonString(i.updateReturn)}catch(e){t(e)}return e()}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})}))}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success)return e();{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:this._instanceID})}))}async outputRuntimeSettingsToString(){if(!w._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:i,instanceID:this._instanceID})}))}async initRuntimeSettingsWithString(e){if(!w._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise(((t,i)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),w._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:n,instanceID:this._instanceID,body:{settings:e}})}))}async _decode_Blob(e,t){w._onLog&&w._onLog("_decode_Blob(blob: Blob)");let i=null,n=null;if("undefined"!=typeof createImageBitmap)try{i=await createImageBitmap(e)}catch(e){}i||(n=await function(e){return new Promise(((t,i)=>{let n=URL.createObjectURL(e),o=new Image;o.dbrObjUrl=n,o.src=n,o.onload=()=>{t(o)},o.onerror=e=>{i(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let o=await this._decode_Image(i||n,t);return i&&i.close(),o}async _decode_ArrayBuffer(e,t){return await this._decode_Blob(new Blob([e]),t)}async _decode_Uint8Array(e,t){return await this._decode_Blob(new Blob([e]),t)}async _decode_Image(e,t){w._onLog&&w._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),t=t||{};let i,n,o=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,s=Math.max(o,r);if(s>this._maxCvsSideLength){let e=this._maxCvsSideLength/s;i=Math.round(o*e),n=Math.round(r*e)}else i=o,n=r;this.canvas||(this.canvas=document.createElement("canvas"));const a=this.canvas;a.width===i&&a.height===n||(a.width=i,a.height=n),a.ctx2d||(a.ctx2d=a.getContext("2d"));return a.ctx2d.drawImage(e,0,0,o,r,0,0,i,n),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._decode_Canvas(a,t)}async _decode_Canvas(t,i){if(w._onLog&&w._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),t.crossOrigin&&"anonymous"!=t.crossOrigin)throw"cors";if(0===t.width||0===t.height)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=t,this.oriCanvasData=null);let n=(t.ctx2d||t.getContext("2d")).getImageData(0,0,t.width,t.height).data;return await this._decodeBuffer_Uint8Array(n,t.width,t.height,4*t.width,e.EnumImagePixelFormat.IPF_ABGR_8888,i)}async _decode_Video(e,t){if(w._onLog&&w._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";t=t||{};let i,n,o=e.videoWidth,r=e.videoHeight,s=Math.max(o,r);if(s>this._maxCvsSideLength){let e=this._maxCvsSideLength/s;i=Math.round(o*e),n=Math.round(r*e)}else i=o,n=r;this.canvas||(this.canvas=document.createElement("canvas"));const a=this.canvas;a.width===i&&a.height===n||(a.width=i,a.height=n),a.ctx2d||(a.ctx2d=a.getContext("2d"));return a.ctx2d.drawImage(e,0,0,o,r,0,0,i,n),await this._decode_Canvas(a,t)}async _decode_DCEFrame(t,i){if(w._onLog&&w._onLog("_decode_DCEFrame(dceFrame)"),!w.isDCEFrame(t))return null;let n;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:t.width,height:t.height,colorMode:t.colorMode,data:new Uint8Array(t.data),toCanvas:t.toCanvas});const{width:o,height:r,colorMode:s,timeStamp:a}=t;let d;d=i&&i.bCopyData?new Uint8Array(t.data):t.data;let l=null;if(i?(l=JSON.parse(JSON.stringify(i)),l.timeStamp=a):l={timeStamp:a},"grey"===s)n=await this._decodeBuffer_Uint8Array(d,o,r,o,e.EnumImagePixelFormat.IPF_GrayScaled,l);else if("rgba"===s)n=await this._decodeBuffer_Uint8Array(d,o,r,4*o,e.EnumImagePixelFormat.IPF_ABGR_8888,l);else{if("bgra"!==s)throw new Error(`Color mode '${s}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(d,o,r,4*o,e.EnumImagePixelFormat.IPF_ARGB_8888,l)}return n}async _decode_DSImage(t,i){if(w._onLog&&w._onLog("_decode_DSImage(dsImage)"),!w.isDSImage(t))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:t.width,height:t.height,pixelFormat:t.pixelFormat.toLowerCase(),data:new Uint8Array(t.data),toCanvas:function(){const e=document.createElement("canvas");let t;switch(e.width=this.width,e.height=this.height,this.pixelFormat){case"grey":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255;break;case"rgb":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"bgr":t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e],t[e+1]=this.data[e+1],t[e+2]=this.data[e+2],t[e+3]=255;break;case"rgba":case"bgra":t=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e}});const{width:n,height:o}=t;let r,s,a,d=t.pixelFormat.toLowerCase();switch(r=i&&i.bCopyData?new Uint8Array(t.data):t.data,d){case"grey":a=e.EnumImagePixelFormat.IPF_GrayScaled,s=n;break;case"rgb":a=e.EnumImagePixelFormat.IPF_BGR_888,s=3*n;break;case"bgr":a=e.EnumImagePixelFormat.IPF_RGB_888,s=3*n;break;case"rgba":a=e.EnumImagePixelFormat.IPF_ABGR_8888,s=4*n;break;case"bgra":a=e.EnumImagePixelFormat.IPF_ARGB_8888,s=4*n;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(r,n,o,s,a,i)}async _decode_Base64(e,t){if(w._onLog&&w._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");"data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1));{let i=atob(e),n=i.length,o=new Uint8Array(n);for(;n--;)o[n]=i.charCodeAt(n);return await this._decode_Blob(new Blob([o]),t)}}async _decode_Url(e,t){if(w._onLog&&w._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let i=await new Promise(((t,i)=>{let n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.send(),n.onloadend=async()=>{t(n.response)},n.onerror=()=>{i(new Error("Network Error: "+n.statusText))}}));return await this._decode_Blob(i,t)}}async _decode_FilePath(e,t){throw w._onLog&&w._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}static fixResultLocationWhenFilterRegionInJs(e,t,i,n,o,r,s,a){if(e&&t.length>0)for(let e of t){let t=e.localizationResult;2==t.resultCoordinateType&&(t.x1*=.01*s,t.x2*=.01*s,t.x3*=.01*s,t.x4*=.01*s,t.y1*=.01*a,t.y2*=.01*a,t.y3*=.01*a,t.y4*=.01*a);let d=s/o,l=a/r;t.x1=t.x1/d+i,t.x2=t.x2/d+i,t.x3=t.x3/d+i,t.x4=t.x4/d+i,t.y1=t.y1/l+n,t.y2=t.y2/l+n,t.y3=t.y3/l+n,t.y4=t.y4/l+n,2==t.resultCoordinateType&&(t.x1*=100/o,t.x2*=100/o,t.x3*=100/o,t.x4*=100/o,t.y1*=100/r,t.y2*=100/r,t.y3*=100/r,t.y4*=100/r)}}static BarcodeReaderException(t,i){let n,o=e.EnumErrorCode.DBR_UNKNOWN;return"number"==typeof t?(o=t,n=new Error(i)):n=new Error(t),n.code=o,n}_handleRetJsonString(t){let i=e.EnumErrorCode;if(t.textResults){for(let e=0;e<t.textResults.length;e++){let i=t.textResults[e];try{let e=i.barcodeText,t="";for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);try{i.barcodeText=decodeURIComponent(escape(t))}catch(e){i.barcodeText=t}}catch(e){i.barcodeText=""}if(null!=i.exception){w._setWarnnedEx.has(i.exception)||(w._setWarnnedEx.add(i.exception),console.warn(i.exception));let e={};i.exception.split(";").forEach((t=>{let i=t.indexOf(":");e[t.substring(0,i)]=t.substring(i+1)})),i.exception=e}}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.exception&&!w._setWarnnedEx.has(t.description)&&(w._setWarnnedEx.add(t.description),console.warn(t.description)),t.textResults}if(t.exception==i.DBR_SUCCESS)return t.data;throw w.BarcodeReaderException(t.exception,t.description)}async setModeArgument(e,t,i,n){return await new Promise(((o,r)=>{let s=w._nextTaskID++;w._taskCallbackMap.set(s,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return r(e)}return o()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),w._dbrWorker.postMessage({type:"setModeArgument",id:s,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i,argumentValue:n}})}))}async getModeArgument(e,t,i){return await new Promise(((n,o)=>{let r=w._nextTaskID++;w._taskCallbackMap.set(r,(e=>{if(e.success){let t;try{t=this._handleRetJsonString(e.getReturn)}catch(e){return o(e)}return n(t)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),w._dbrWorker.postMessage({type:"getModeArgument",id:r,instanceID:this._instanceID,body:{modeName:e,index:t,argumentName:i}})}))}async getIntermediateResults(){return await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success)return e(i.results);{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:this._instanceID})}))}async getIntermediateCanvas(){let t=await this.getIntermediateResults(),i=[];for(let n of t)if(n.dataType==e.EnumIMResultDataType.IMRDT_IMAGE)for(let t of n.results){const n=t.bytes;let o;switch(w._onLog&&w._onLog(" "+n.length+" "+n.byteLength+" "+t.width+" "+t.height+" "+t.stride+" "+t.format),t.format){case e.EnumImagePixelFormat.IPF_ABGR_8888:o=new Uint8ClampedArray(n);break;case e.EnumImagePixelFormat.IPF_RGB_888:{const e=n.length/3;o=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)o[4*t]=n[3*t+2],o[4*t+1]=n[3*t+1],o[4*t+2]=n[3*t],o[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_GrayScaled:{const e=n.length;o=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)o[4*t]=o[4*t+1]=o[4*t+2]=n[t],o[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_Binary:case e.EnumImagePixelFormat.IPF_BinaryInverted:{t.width=8*t.stride,t.height=n.length/t.stride;const e=n.length;o=new Uint8ClampedArray(8*e*4);for(let t=0;t<e;t++){let e=n[t];for(let i=0;i<8;++i)o[4*(8*t+i)]=o[4*(8*t+i)+1]=o[4*(8*t+i)+2]=(128&e)/128*255,o[4*(8*t+i)+3]=255,e<<=1}break}default:console.warn("unknow intermediate image",t)}if(!o)continue;let r=new ImageData(o,t.width,t.height),s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").putImageData(r,0,0),i.push(s)}return i}async keepAlive(){w._dbrWorker.postMessage({type:"keepAlive"})}async getScanSettings(){return await new Promise(((e,t)=>{let i=w._nextTaskID++;w._taskCallbackMap.set(i,(i=>{if(i.success){let t=i.results;return t.intervalTime=this.intervalTime,t.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,t.soundOnSuccessfullRead=this.soundSource,t.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,t.vibrateDuration=this.vibrateDuration,e(t)}{let e=new Error(i.message);return e.stack+="\n"+i.stack,t(e)}})),w._dbrWorker.postMessage({type:"getScanSettings",id:i,instanceID:this._instanceID})}))}async updateScanSettings(e){if(!e)return;const t=JSON.parse(JSON.stringify(e));return t.hasOwnProperty("intervalTime")&&(this.intervalTime=t.intervalTime,delete t.intervalTime),t.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=t.whenToPlaySoundforSuccessfulRead,delete t.whenToPlaySoundforSuccessfulRead),t.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=t.soundOnSuccessfullRead,delete t.soundOnSuccessfullRead),t.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=t.whenToVibrateforSuccessfulRead,delete t.whenToVibrateforSuccessfulRead),t.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=t.vibrateDuration,delete t.vibrateDuration),await new Promise(((e,i)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(t=>{if(t.success)return e();{let e=new Error(t.message);return e.stack+="\n"+t.stack,i(e)}})),w._dbrWorker.postMessage({type:"updateScanSettings",id:n,instanceID:this._instanceID,body:{settings:t}})}))}_cloneDecodeResults(e){if(e instanceof Array){let t=[];for(let i of e)t.push(this._cloneDecodeResults(i));return t}{let t=e;return JSON.parse(JSON.stringify(t,((e,t)=>"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t)))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this.imgSource||this._bPauseScan)return w._onLog&&w._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));w._onLog&&w._onLog("======= once read ======="),w._onLog&&(this._timeStartDecode=Date.now());let e=null,t=null;if(this.dce)e=this._getVideoFrame();else if(this.imgSource&&(t=await this.imgSource.getImage(),!w.isDSImage(t)))throw new Error("Invalid DSImage.");if(!e&&!t)return this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{let i=null;return e?i=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1}):t&&(i=await this._decode_DSImage(t,{bScanner:!0,bCopyData:!1})),i})().then((e=>{if(w._onLog&&w._onLog(e),this.dce){let e=this.array_decodeFrameTimeCost,t=this.array_getFrameTimeCost;this._indexCurrentDecodingFrame;const i=()=>{let i=0;if(t&&t.length){let n=Math.min(...e),o=Math.max(...t);n&&o&&(i=n-o)}else i=0;return i>0?i:0};(()=>{for(;e.length>=5;)e.shift();e.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=i()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this.imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unique"===this.bPlaySoundOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}t&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unique"===this.bVibrateOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onImageRead){let t=this._cloneDecodeResults(e);for(let e of t)delete e.bUnduplicated;this.onImageRead(t)}if(this.onUniqueRead)for(let t of e)t.bUnduplicated&&this.onUniqueRead(t.barcodeText,this._cloneDecodeResults(t));this._drawResults(e)}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce&&this.dce.stopFetchingLoop(),w._onLog&&w._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}_getVideoFrame(){if(!this.dce)return null;let e=this.dce.isFetchingLoopStarted();if(this.dceConfig.loopInterval=this._intervalGetVideoFrame,e||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dceConfig.loopInterval=0,null;const t=this.dce.getFrameFromBuffer();return(e=>{if(!e)return;let t=e.timeSpent,i=this.array_getFrameTimeCost;for(;i.length>=5;)i.shift();i.push(t)})(t),t}_drawResults(e){if(!this.dce||this._bPauseScan)return;if(!this.resultsOverlay){if(!this.dce.isOpen())return;this.resultsOverlay=this.dce.addScanRegionOverlayCanvas()}const t=this.resultsOverlay.getContext("2d");if(t.clearRect(0,0,this.resultsOverlay.width,this.resultsOverlay.height),e){t.globalCompositeOperation="destination-over",t.fillStyle=this.barcodeFillStyle,t.strokeStyle=this.barcodeStrokeStyle,t.lineWidth=this.barcodeLineWidth;for(let i of e){let e=i.localizationResult;t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.fill(),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineTo(e.x3,e.y3),t.lineTo(e.x4,e.y4),t.closePath(),t.stroke()}}}async startScanning(e){if(!this.dce&&!this.imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if("closed"!=this._tempSolutionStatus)return;if(this._tempSolutionStatus="opening","opening"!=this._tempSolutionStatus)return;let t=null;return this.dce&&!this.dce.isOpen()&&(this.dce.ifShowScanRegionLaser=!0,t=await this.dce.open(e)),"opening"==this._tempSolutionStatus?(this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||this._loopReadVideo(),this._tempSolutionStatus="opened",this.keepAlive(),t):void 0}stopScanning(e){this.dce&&(this._drawResults(null),this.dce.ifShowScanRegionLaser=!1,this.dce.close(e)),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._tempSolutionStatus="closed"}pauseScanning(){if(this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.ifShowScanRegionLaser=!0}}destroyContext(){if(w._onLog&&w._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||"opening"===this._tempSolutionStatus)&&this.stopScanning(),this.setImageSource(null);let e=w._nextTaskID++;w._taskCallbackMap.set(e,(e=>{if(!e.success){let t=new Error(e.message);throw t.stack=e.stack+"\n"+t.stack,t}})),w._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}
/*!
     * Dynamsoft JavaScript Library
     * @product Dynamsoft Camera Enhancer JS Edition
     * @website https://www.dynamsoft.com
     * @copyright Copyright 2022, Dynamsoft Corporation
     * @author Dynamsoft
     * @version 2.3.2 (js 20220321)
     * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
     * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
     */
function D(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{d(n.next(e))}catch(e){r(e)}}function a(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}d((n=n.apply(e,t||[])).next())}))}w._jsVersion="9.0.2",w._jsEditVersion="20220505",w._version=`loading...(JS ${w._jsVersion}.${w._jsEditVersion})`,w._license=l,w._sessionPassword=c,w.browserInfo=i,w._workerName=`dbr-${w._jsVersion}.browser.worker.js`,w._engineResourcePath=a,w._licenseServer=[],w._deviceFriendlyName="",w._isShowRelDecodeTimeInResults=!1,w._bWasmDebug=!1,w._bNeverShowDialog=!1,w.__bUseFullFeature=!0,w._nextTaskID=0,w._taskCallbackMap=new Map,w._pLoad=new class extends Promise{constructor(e){let t,i;super(((e,n)=>{t=e,i=n})),this._s="pending",this.resolve=e=>{this.isPending&&(f(e)?this.task=e:(this._s="fulfilled",t(e)))},this.reject=e=>{this.isPending&&(this._s="rejected",i(e))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){let t;this._task=e,f(e)?t=e:"function"==typeof e&&(t=new Promise(e)),t&&(async()=>{try{const i=await t;e===this._task&&this.resolve(i)}catch(t){e===this._task&&this.reject(t)}})()}get isEmpty(){return null==this._task}},w._lastErrorCode=0,w._lastErrorString="",w._setWarnnedEx=new Set,w._defaultUIElementURL="@engineResourcePath/dbr.ui.html";const M="undefined"==typeof self;class b{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this.predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this.mapCameraResolutions=new Map,this._bWebGLSupported=!0,this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._cvsSingleFrameMode=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameModeIpt=null,this._clickIptSingleFrameMode=()=>{if(this.singleFrameMode){if(!this._singleFrameModeIpt){const e=document.createElement("input");this._singleFrameModeIpt=e,e.setAttribute("type","file"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),e.setAttribute("capture",""),e.addEventListener("change",(()=>D(this,void 0,void 0,(function*(){const t=e.files[0];e.value="";const i=yield(e=>D(this,void 0,void 0,(function*(){let t=null,i=null;if("undefined"!=typeof createImageBitmap)try{if(t=yield createImageBitmap(e),t)return t}catch(t){}var n;return t||(i=yield(n=e,new Promise(((e,t)=>{let i=URL.createObjectURL(n),o=new Image;o.dbrObjUrl=i,o.src=i,o.onload=()=>{e(o)},o.onerror=e=>{t(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}})))),i})))(t),n=i instanceof HTMLImageElement?i.naturalWidth:i.width,o=i instanceof HTMLImageElement?i.naturalHeight:i.height;this._imgWidth=n,this._imgHeight=o,(e=>{if(!this._cvsSingleFrameMode){if(this._cvsSingleFrameMode=document.createElement("canvas"),this._cvsSingleFrameMode.className="cvs-single-frame-mode",this._cvsSingleFrameMode.addEventListener("click",this._clickIptSingleFrameMode),this._cvsSingleFrameMode.style.cursor="pointer",this._cvsSingleFrameMode.setAttribute("title","Take a photo"),!this._video)throw new Error("'video' is null.");this._video.after(this._cvsSingleFrameMode)}const t=this._cvsSingleFrameMode;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit="contain",t.width==n&&t.height==o||(t.width=n,t.height=o);let i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.drawImage(e,0,0)})(i),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);const r=(e=>{const t=Date.now();if(0===n||0===o)return null;const i=this._scanRegion,r=this.getFrameSize(n,o,i,this.maxCvsSideLength);if(!r)return null;let s,a;s=n!==r.sWidth||o!==r.sHeight,a=r.sWidth!==r.dWidth||r.sHeight!==r.dHeight;const d=(()=>!(!this._bWebGLSupported||a))(),l={data:null,region:i?JSON.parse(JSON.stringify(i)):null,sx:r.sx,sy:r.sy,width:r.dWidth,height:r.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},c=this._getImageData(e,n,o,r,null,{targetColorMode:this.frameColorMode,bUseWebGL:d});if(!c)return null;const h=Date.now();return b._onLog&&b._onLog("DCE: _getVideoFrame(region?) END: "+h),l.data=c.data,l.colorMode=c.colorMode,l._bUseWebGL=c._bUseWebGL,l.timeSpent=h-t,l.timeStamp=h,l})(i),s=this.mapCameraEvents.get("singleFrameAcquired");for(let e of s)try{const t={data:new Uint8Array(r.data),region:JSON.parse(JSON.stringify(r.region)),sx:r.sx,sy:r.sy,width:r.width,height:r.height,colorMode:r.colorMode,timeSpent:r.timeSpent,timeStamp:r.timeStamp,isCropped:r.isCropped,toCanvas:r.toCanvas,_bUseWebGL:r._bUseWebGL};yield e(t)}catch(e){console.error(e)}})))),e.style.position="fixed",e.style.left="-1px",e.style.top="-1px",e.style.width="1px",e.style.height="1px",e.style.backgroundColor="transparent",e.style.color="transparent",document.body.appendChild(e)}this._singleFrameModeIpt.click()}},this.styleEls=[],this._frameColorMode=void 0,this._defaultFrameColorMode="RGBA",this.currentFSColorMode="rgba",this.ifReuseArrayBufferView=!1,this.maxVideoCvsLength=3,this.canvas=null,this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.toCanvas=function(){const e=document.createElement("canvas");let t;if(e.width=this.width,e.height=this.height,"grey"===this.colorMode){t=new Uint8ClampedArray(this.width*this.height*4);for(let e=0;e<t.length;e+=4)t[e]=this.data[e/4],t[e+1]=this.data[e/4],t[e+2]=this.data[e/4],t[e+3]=255}else t=new Uint8ClampedArray(this.data);const i=new ImageData(t,this.width,this.height);return e.getContext("2d").putImageData(i,0,0),e},this._onCameraSelChange=()=>D(this,void 0,void 0,(function*(){yield this.selectCamera(this._selCam.value),this._bOpen||this.stop()})),this._onResolutionSelChange=()=>D(this,void 0,void 0,(function*(){let e,t;if(this._selRsl&&-1!=this._selRsl.selectedIndex){let i=this._selRsl.options[this._selRsl.selectedIndex];e=i.getAttribute("data-width"),t=i.getAttribute("data-height")}yield this.setResolution(e,t),this._bOpen||this.stop()})),this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.videoSrc=null,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{"visible"===document.visibilityState?this._vc_bPlayingVideoBeforeHide&&("Firefox"==b.browserInfo.browser?this.play():this._video.play(),this._vc_bPlayingVideoBeforeHide=!1):this._video&&!this._video.paused&&(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause())},this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._bStoppedByPause=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateCanvasTimeout=500,this.referenceConfigurationArray=[],this._onWindowResize=()=>{this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout((()=>{this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}),this._updateCanvasTimeout)},this.bDestroyed=!1,this.mapCameraEvents=new Map([["cameraOpen",[]],["cameraClose",[]],["cameraChange",[]],["resolutionChange",[]],["played",[]],["singleFrameAcquired",[]],["frameAddedToBuffer",[]]])}static getVersion(){return this._version}static detectEnvironment(){return D(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!("undefined"==typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");if(null==e&&(e="./"),M)b._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,b._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(b._engineResourcePath+="/")}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let t;try{t=window[e];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}set maxCvsSideLength(e){if(e<=0)throw new Error("The 'maxCvsSideLength' should be greater than 0.");this._maxCvsSideLength=e}get maxCvsSideLength(){return void 0!==this._maxCvsSideLength?this._maxCvsSideLength:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxCvsSideLength")?this.referenceConfigurationArray[0].maxCvsSideLength:this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){b._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=b._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",b.engineResourcePath)}getUIElement(){return this.UIElement}setUIElement(e){return D(this,void 0,void 0,(function*(){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if("string"==typeof e||e instanceof String){if(!e.trim().startsWith("<")){let t=yield fetch(e);if(!t.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+t.statusText);e=yield t.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let t=document.createElement("div");t.innerHTML=e;for(let e=0;e<t.childElementCount;++e){let i=t.children[e];i instanceof HTMLStyleElement&&(this.styleEls.push(i),document.head.append(i))}(e=1==t.childElementCount?t.children[0]:t).remove()}this.UIElement=e}))}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e}set frameColorMode(e){this._frameColorMode=e}get frameColorMode(){return void 0!==this._frameColorMode?this._frameColorMode:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("frameColorMode")?this.referenceConfigurationArray[0].frameColorMode:this._defaultFrameColorMode}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");let e=[this.UIElement];for(let t=0;t<e.length;++t)for(let i of e[t].children)e.push(i);for(let t of e)if(!this._video&&t.classList.contains("dce-video-container")){const e=document.createElement("video");e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e.style.objectFit=this.getVideoFit(),e.setAttribute("playsinline","true"),e.setAttribute("muted","true"),t.prepend(e),this._video=e}else!this._divScanArea&&t.classList.contains("dce-scanarea")?this._divScanArea=t:!this._divScanLight&&t.classList.contains("dce-scanlight")?this._divScanLight=t:!this._bgLoading&&t.classList.contains("dce-bg-loading")?this._bgLoading=t:!this._bgCamera&&t.classList.contains("dce-bg-camera")?this._bgCamera=t:!this._selCam&&t.classList.contains("dce-sel-camera")?this._selCam=t:!this._selRsl&&t.classList.contains("dce-sel-resolution")?(this._selRsl=t,this.videoSrc||this.singleFrameMode||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">1920x1080</option>','<option data-width="1280" data-height="720">1280x720</option>','<option data-width="640" data-height="480">640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&t.classList.contains("dce-opt-gotResolution")?this._optGotRsl=t:!this._btnClose&&t.classList.contains("dce-btn-close")&&(this._btnClose=t);if(!this._video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'");this.singleFrameMode?(this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="")):this._bgLoading&&(this._bgLoading.style.display=""),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.addEventListener("resize",this._onWindowResize)}_unbindUI(){this.singleFrameMode?(this._video&&(this._video.removeEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="",this._video.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this._cvsViewDecorator&&(this._cvsViewDecorator.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="",this._cvsViewDecorator.removeAttribute("title"));for(let e of this._arrScanRegionOverlays)e&&(e.removeEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="",e.removeAttribute("title"));this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._video&&(this._video.onloadedmetadata=null,this._video.remove()),this._video=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameModeIpt&&(this._singleFrameModeIpt.remove(),this._singleFrameModeIpt=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.removeEventListener("resize",this._onWindowResize)}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e);this._bShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this._bShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this._cvsViewDecorator&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this.showScanRegionOverlays();for(let e of this._arrScanRegionOverlays)e&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo"))}}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}set ifSaveLastUsedCamera(e){e?b.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`It is not allowed to set '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this.singleFrameMode)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}}getVideoFit(){return this.videoFit}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&"none"==this._cvsScanRegion.style.display&&(this._cvsScanRegion.style.display="")}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none")}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){return this._bShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display="")}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none")}_checkValidRegion(e){return!(null!==e&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("The region is invalid.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let e of this._arrScanRegionOverlays)e&&this._updateScanRegionOverlay(e)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(e.className="cvs-scan-region-overlay-"+this._arrScanRegionOverlays.length,this.singleFrameMode&&(e.addEventListener("click",this._clickIptSingleFrameMode),e.style.cursor="pointer",e.setAttribute("title","Take a photo")),this._updateScanRegionOverlay(e),this._arrScanRegionOverlays.length>0){const t=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[t-1].after(e)}else if(this._cvsScanRegion)this._cvsScanRegion.before(e);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._video)throw new Error("'video' is null.");this._video.after(e)}return this._arrScanRegionOverlays.push(e),e}_updateScanRegionOverlay(e){if(!e)return;let t,i,n;if(this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,n="contain";else{if(!this._video)return;t=this._video.videoWidth,i=this._video.videoHeight,n=this.getVideoFit()}if(t<=0||i<=0)return e.width=0,void(e.height=0);const o=this._getRegionInPixels(t,i,this._scanRegion),r=this.getFrameSize(t,i,this._scanRegion,this.maxCvsSideLength).dWidth,s=this.getFrameSize(t,i,this._scanRegion,this.maxCvsSideLength).dHeight;e.width==r&&e.height==s||(e.width=r,e.height=s);const a=window.getComputedStyle(this._video),d=parseFloat(a.width),l=parseFloat(a.height),c=d/l,h=t/i;let _,u,g,m,f=1;if("contain"===n)c<h?(f=d/t,_=0,u=(l-i*f)/2):(f=l/i,_=(d-t*f)/2,u=0),_+=o.regionLeft*f,u+=o.regionTop*f,g=(o.regionRight-o.regionLeft)*f,m=(o.regionBottom-o.regionTop)*f;else if("cover"===n)if(c<h){f=l/i,_=o.regionLeft*f-(t*f-d)/2,_=Math.max(_,0),_=Math.min(_,parseFloat(a.width)),u=o.regionTop*f;let e=o.regionRight*f-(t*f-d)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.width)),g=e-_,m=(o.regionBottom-o.regionTop)*f}else{f=d/t,_=o.regionLeft*f,u=o.regionTop*f-(i*f-l)/2,u=Math.max(u,0),u=Math.min(u,parseFloat(a.height));let e=o.regionBottom*f-(i*f-l)/2;e=Math.max(e,0),e=Math.min(e,parseFloat(a.height)),g=(o.regionRight-o.regionLeft)*f,m=e-u}else _=0,u=0,g=0,m=0;e.style.position="absolute",e.style.left=_+"px",e.style.top=u+"px",e.style.width=g+"px",e.style.height=m+"px",e.style.objectFit=n}showScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&"none"==e.style.display&&(e.style.display="")}hideScanRegionOverlays(){for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none")}setViewDecorator(e,t){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));this._assertOpen();let i=[];if("string"==typeof e?i.push(e):Array.isArray(e)&&(i=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator)if(this._cvsViewDecorator=document.createElement("canvas"),this._cvsViewDecorator.className="cvs-view-decorator",this.singleFrameMode&&(this._cvsViewDecorator.addEventListener("click",this._clickIptSingleFrameMode),this._cvsViewDecorator.style.cursor="pointer",this._cvsViewDecorator.setAttribute("title","Take a photo")),this._divScanArea)this._divScanArea.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsViewDecorator)}else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._video)throw new Error("'video' is null.");this._video.after(this._cvsViewDecorator)}this._decoratorArea=JSON.parse(JSON.stringify(t)),this._decoratorType.length=0;const n=["rectangle","focus"],o=["crossline","crosshair"];let r=!1,s=!1;for(let e of i)e=e.toLowerCase(),n.includes(e)&&!r&&(r=!0,this._decoratorType.push(e)),o.includes(e)&&!s&&(s=!0,!this._decoratorType.includes(e)&&this._decoratorType.push(e));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&"none"==this._cvsViewDecorator.style.display&&(this._cvsViewDecorator.style.display="")}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none")}setViewDecoratorLineWidth(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=t,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=t,this._updateViewDecorator()}setViewDecoratorFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=t,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,t){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=t,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen)return;if(!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this.singleFrameMode)e="contain";else{if(!this._video)return;e=this.getVideoFit()}const t=this._cvsViewDecorator;t.style.position="absolute",t.style.width="100%",t.style.height="100%",t.style.left="0",t.style.top="0",t.style.objectFit=e;const i=this.getVisibleRegion(!0),n=i.regionRight-i.regionLeft,o=i.regionBottom-i.regionTop;t.width==n&&t.height==o||(t.width=n,t.height=o);const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const s=this._decoratorArea.x/100*n,a=this._decoratorArea.y/100*o,d=this._decoratorArea.width/100*n,l=this._decoratorArea.height/100*o;for(let e of this._decoratorType){if("rectangle"===e){r.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,r.fillRect(0,0,t.width,t.height),r.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),r.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,r.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),r.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,r.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const e=r.lineWidth/2;r.strokeRect(Math.round(s-e),Math.round(a-e),Math.round(d+r.lineWidth),Math.round(l+r.lineWidth))}if("focus"===e){r.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,r.fillRect(0,0,t.width,t.height),r.clearRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),r.fillStyle=this._viewDecoratorInfo.focus.fillStyle,r.fillRect(Math.round(s),Math.round(a),Math.round(d),Math.round(l)),r.lineWidth=this._viewDecoratorInfo.focus.lineWidth,r.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const e=r.lineWidth/2,i=[0,.25,.75,1],n=[0,.25,.75,1];r.beginPath();for(let e=0;e<i.length;e++)if(0==e||3==e)for(let t=0;t<n.length;t+=2)r.moveTo(Math.round(s+i[e]*d),Math.round(a+n[t]*l)),r.lineTo(Math.round(s+i[e]*d),Math.round(a+n[t+1]*l));for(let t=0;t<n.length;t++)if(0==t||3==t)for(let o=0;o<i.length;o+=2)r.moveTo(Math.round(s+i[o]*d-e),Math.round(a+n[t]*l)),r.lineTo(Math.round(s+i[o+1]*d+e),Math.round(a+n[t]*l));r.stroke()}if("crossline"===e&&(r.beginPath(),r.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,r.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,r.moveTo(Math.round(s),Math.round(a+l/2)),r.lineTo(Math.round(s+d),Math.round(a+l/2)),r.moveTo(Math.round(s+d/2),Math.round(a)),r.lineTo(Math.round(s+d/2),Math.round(a+l)),r.stroke()),"crosshair"===e){r.beginPath();const e=.05*Math.min(d,l);r.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,r.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,r.moveTo(Math.round(s+(d-e)/2),Math.round(a+l/2)),r.lineTo(Math.round(s+(d+e)/2),Math.round(a+l/2)),r.moveTo(Math.round(s+d/2),Math.round(a+(l-e)/2)),r.lineTo(Math.round(s+d/2),Math.round(a+(l+e)/2)),r.stroke()}}}getVisibleRegion(e){let t,i,n;if(this._assertOpen(),this.singleFrameMode)t=this._imgWidth,i=this._imgHeight,n="contain";else{if(!this._video)return null;t=this._video.videoWidth,i=this._video.videoHeight,n=this.getVideoFit()}let o=(()=>{const e=parseFloat(window.getComputedStyle(this._video).width),o=parseFloat(window.getComputedStyle(this._video).height);let r,s={regionBottom:i,regionRight:t,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return"cover"===n?e/o<t/i?(r=i/o,s.regionLeft=Math.floor((t-r*e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):(r=t/e,s.regionTop=Math.floor((i-r*o)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t):"none"===n&&(e<t&&o<i?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=Math.floor((i-o)/2),s.regionBottom=Math.ceil(i-s.regionTop)):e<t?(s.regionLeft=Math.floor((t-e)/2),s.regionRight=Math.ceil(t-s.regionLeft),s.regionTop=0,s.regionBottom=i):o<i&&(s.regionTop=Math.floor((i-o)/2),s.regionBottom=Math.ceil(i-s.regionTop),s.regionLeft=0,s.regionRight=t)),s})();return e?o.regionMeasuredByPercentage=!1:(o.regionBottom=Math.ceil(o.regionBottom/i*100),o.regionRight=Math.ceil(o.regionRight/t*100),o.regionLeft=Math.floor(o.regionLeft/t*100),o.regionTop=Math.floor(o.regionTop/i*100),o.regionMeasuredByPercentage=!0),o}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,t,i){if(!(e<=0||t<=0))return i?i.regionMeasuredByPercentage?{regionLeft:Math.round(i.regionLeft/100*e),regionTop:Math.round(i.regionTop/100*t),regionRight:Math.round(i.regionRight/100*e),regionBottom:Math.round(i.regionBottom/100*t),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(i)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:t,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(e<=0||t<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const n=this._getRegionInPixels(e,t,this._scanRegion);if(!this._cvsScanRegion)if(this._cvsScanRegion=document.createElement("canvas"),this._cvsScanRegion.className="cvs-scan-region",this.singleFrameMode&&(this._cvsScanRegion.addEventListener("click",this._clickIptSingleFrameMode),this._cvsScanRegion.style.cursor="pointer",this._cvsScanRegion.setAttribute("title","Take a photo")),this._arrScanRegionOverlays&&0!=this._arrScanRegionOverlays.length){const e=this._arrScanRegionOverlays.length;this._arrScanRegionOverlays[e-1].after(this._cvsScanRegion)}else this._cvsSingleFrameMode?this._cvsSingleFrameMode.after(this._cvsScanRegion):this._video.after(this._cvsScanRegion);const o=this._cvsScanRegion;o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.left="0",o.style.top="0",o.style.objectFit=i,o.width==e&&o.height==t||(o.width=e,o.height=t);const r=o.getContext("2d");if(r.clearRect(0,0,o.width,o.height),0!=n.regionLeft||n.regionRight!=e||0!=n.regionTop||n.regionBottom!=t){const e=n.regionLeft,t=n.regionTop,i=n.regionRight-n.regionLeft,s=n.regionBottom-n.regionTop;r.fillStyle=this.regionMaskFillStyle,r.fillRect(0,0,o.width,o.height),r.clearRect(Math.round(e),Math.round(t),Math.round(i),Math.round(s)),r.strokeStyle=this.regionMaskStrokeStyle,r.lineWidth=this.regionMaskLineWidth;const a=r.lineWidth/2;r.strokeRect(Math.round(e-a),Math.round(t-a),Math.round(i+r.lineWidth),Math.round(s+r.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e,t,i;if(this.singleFrameMode)e=this._imgWidth,t=this._imgHeight,i="contain";else{if(!this._video)return;e=this._video.videoWidth,t=this._video.videoHeight,i=this.getVideoFit()}if(!this._divScanArea)return;if(e<=0||t<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const n=this._getRegionInPixels(e,t,this._scanRegion),o=window.getComputedStyle(this._video),r=parseFloat(o.width),s=parseFloat(o.height),a=r/s,d=e/t;let l,c,h,_,u=1;if("contain"===i)a<d?(u=r/e,l=0,c=(s-t*u)/2):(u=s/t,l=(r-e*u)/2,c=0),l+=n.regionLeft*u,c+=n.regionTop*u,h=(n.regionRight-n.regionLeft)*u,_=(n.regionBottom-n.regionTop)*u;else if("cover"===i)if(a<d){u=s/t,l=n.regionLeft*u-(e*u-r)/2,l=Math.max(l,0),l=Math.min(l,parseFloat(o.width)),c=n.regionTop*u;let i=n.regionRight*u-(e*u-r)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(o.width)),h=i-l,_=(n.regionBottom-n.regionTop)*u}else{u=r/e,l=n.regionLeft*u,c=n.regionTop*u-(t*u-s)/2,c=Math.max(c,0),c=Math.min(c,parseFloat(o.height));let i=n.regionBottom*u-(t*u-s)/2;i=Math.max(i,0),i=Math.min(i,parseFloat(o.height)),h=(n.regionRight-n.regionLeft)*u,_=i-c}else l=0,c=0,h=0,_=0;this._divScanArea.style.left=l+"px",this._divScanArea.style.top=c+"px",this._divScanArea.style.width=h+"px",this._divScanArea.style.height=_+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){return void 0!==this._croppingRegions?this._croppingRegions:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("croppingRegions")?this.referenceConfigurationArray[0].croppingRegions:this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'loopInterval' should be greater than or equal to 0.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){return void 0!==this._loopInterval?this._loopInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("loopInterval")?this.referenceConfigurationArray[0].loopInterval:this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("The 'maxNumberOfFramesInBuffer' should be greater than 0.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){return void 0!==this._maxNumberOfFramesInBuffer?this._maxNumberOfFramesInBuffer:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("maxNumberOfFramesInBuffer")?this.referenceConfigurationArray[0].maxNumberOfFramesInBuffer:this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){return void 0!==this._refreshInterval?this._refreshInterval:this.referenceConfigurationArray&&1===this.referenceConfigurationArray.length&&this.referenceConfigurationArray[0].hasOwnProperty("refreshInterval")?this.referenceConfigurationArray[0].refreshInterval:this._defaultRefreshInterval}isContextDestroyed(){return this.bDestroyed}static createInstance(e){return D(this,void 0,void 0,(function*(){let t=new b;("string"==typeof e||e instanceof String)&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return yield t.setUIElement(b.defaultUIElementURL),this._hasEngineResourceLoaded=!0,t}))}play(e,t,i){return D(this,void 0,void 0,(function*(){if(this._video&&this.videoSrc){yield new Promise(((e,t)=>{this._video.onloadedmetadata=()=>D(this,void 0,void 0,(function*(){this._video&&(this._video.onloadedmetadata=null,yield this._video.play(),e())})),"string"==typeof this.videoSrc||this.videoSrc instanceof String?this._video.src=this.videoSrc:this._video.srcObject=this.videoSrc,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}));let e={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};const t=this.mapCameraEvents.get("played");for(let i of t){const t=JSON.parse(JSON.stringify(e));setTimeout((()=>i(t)),0)}return e}if(this.singleFrameMode)return this._clickIptSingleFrameMode(),{width:0,height:0,deviceId:null};if(!this._video)return null;const n=++this.iPlayRound;let o=null,r=0,s=0;return this._currentCamera&&(o=this._currentCamera.deviceId),this._video&&(r=this._video.videoWidth,s=this._video.videoHeight),this.promisePlay&&(yield this.promisePlay,n<this.iPlayRound)?{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId}:(this.promisePlay=(()=>D(this,void 0,void 0,(function*(){var n;try{this._video&&this._video.srcObject&&this.stop(),b._onLog&&b._onLog("DCE: ======before video========");const a=()=>{if(!this._video)throw _&&_.getTracks().forEach((e=>{e.stop()})),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null.")},d=this.getVideoSettings();let l;"boolean"==typeof d.video&&(d.video={});const c=["rear","back","rck","arrire","trasera","trs","traseira","posteriore","","","","","","","","","","arka","achterzijde","","baksidan","bagside","sau","bak","tylny","takakamera","belakang","","","spate","hts","zadn","darrere","zadn","","stranja","belakang",""],h=()=>{for(let e of this._allCameras){let t=e.label.toLowerCase();if(t&&c.some((e=>-1!=t.indexOf(e)))&&/\b0(\b)?/.test(t)){delete d.video.facingMode,d.video.deviceId={ideal:e.deviceId};break}}d.video.deviceId||-1==["Android","HarmonyOS"].indexOf(b.browserInfo.OS)||(delete d.video.facingMode,d.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})};if(e)delete d.video.facingMode,d.video.deviceId={exact:e};else if(d.video.deviceId);else if(this._lastDeviceId)delete d.video.facingMode,d.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&b.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete d.video.facingMode,d.video.deviceId={exact:window.localStorage.getItem("dce_last_camera_id")};const I=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),y=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));I&&y&&(d.video.width=I,d.video.height=y)}else if(this.ifSkipCameraInspection);else if(d.video.facingMode){if(yield this.getAllCameras(),!this._video)return null;let T=d.video.facingMode;T instanceof Array&&T.length&&(T=T[0]),T=T.exact||T.ideal||T,"environment"===T&&(l=!!d.video.facingMode,h())}let _;t&&(d.video.width={ideal:t}),i&&(d.video.height={ideal:i}),b._onLog&&b._onLog("DCE: ======try getUserMedia========");let u,g=[0,500],m=null,f=null;function p(e){return D(this,void 0,void 0,(function*(){for(let t of g){a(),t&&(yield new Promise((e=>setTimeout(e,t)))),a();{const t=e.video.deviceId;f=t?t.exact||t.ideal||t:null}try{b._onLog&&b._onLog("DCE: ask "+JSON.stringify(e)),_=yield navigator.mediaDevices.getUserMedia(e),a();break}catch(e){m=e,b._onLog&&b._onLog("DCE: "+e.message||e)}}}))}if(yield p(d),_||(b._onLog&&b._onLog("DCE: ======try getUserMedia again========"),u=JSON.parse(JSON.stringify(d)),"object"==typeof u.video&&("iPhone"==b.browserInfo.OS?(t>=1280||i>=1280?u.video.width=1280:t>=640||i>=640?u.video.width=640:(t<640||i<640)&&(u.video.width=320),delete u.video.height):l&&!d.video.deviceId?(delete u.video.facingMode,this._allCameras.length&&(u.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):u.video=!0),b._onLog&&b._onLog("DCE: "+u),yield p(u)),_||(g=[1e3,2e3],yield p(d)),_||(yield p(u)),!_)throw m;const v=()=>{const e=_.getVideoTracks();let t,i;if(e.length&&(t=this._videoTrack=e[0]),this._video&&t){const e=t.getSettings();if(e)for(let n of this._allCameras)if(e.deviceId===n.deviceId){n._checked=!0,n.label=t.label,i=n;break}if(!i&&f)for(let e of this._allCameras)if(f==e.deviceId){t.label&&(e._checked=!0,e.label=t.label),i=e;break}}this._currentCamera=i};if(yield this.getAllCameras(),a(),l){v(),h();let C=d.video.deviceId;C&&(C=C.exact||C.ideal||C);let w=null===(n=this._currentCamera)||void 0===n?void 0:n.deviceId;!C||w&&C==w||(_.getTracks().forEach((e=>{e.stop()})),g=[0,500,1e3,2e3],yield p(d))}a();const A=()=>D(this,void 0,void 0,(function*(){b._onLog&&b._onLog("======play video========"),yield new Promise(((e,t)=>{a(),this._video.onloadedmetadata=()=>D(this,void 0,void 0,(function*(){a(),this._video.onloadedmetadata=null,yield this._video.play(),e()})),this._video.srcObject=_,setTimeout((()=>t(new Error("Failed to play video. Timeout."))),4e3)}))}));yield A(),a(),b._onLog&&b._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const R=this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=R,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),b._onLog&&b._onLog("DCE: got "+R),v(),a(),this._renderSelCameraInfo();const S={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};S.deviceId&&(this._lastDeviceId=S.deviceId,this.ifSaveLastUsedCamera&&b.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),d.video.width&&d.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(d.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(d.video.height)))));const E=this.mapCameraEvents.get("played");for(let M of E){const L=JSON.parse(JSON.stringify(S));setTimeout((()=>M(L)),0)}if(o&&o!=S.deviceId){const O=this.mapCameraEvents.get("cameraChange");for(let F of O){const B=JSON.parse(JSON.stringify(S));setTimeout((()=>F(B)),0)}}if(r&&s&&(r!=S.width||s!=S.height)){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let N of this._arrScanRegionOverlays)N&&this._updateScanRegionOverlay(N);const P=this.mapCameraEvents.get("resolutionChange");for(let x of P){const V=JSON.parse(JSON.stringify(S));setTimeout((()=>x(V)),0)}}return this.promisePlay=null,S}catch(k){throw this.promisePlay=null,k}})))(),yield this.promisePlay)}))}resume(){return D(this,void 0,void 0,(function*(){this._assertOpen(),yield this.play(),this._bStoppedByPause&&(this._bStoppedByPause=!1,this.startFetchingLoop()),this._bShowScanRegionLaser&&this.showScanRegionLaser()}))}pause(){this._bOpen||console.warn("The camera is not open."),this._video&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._bStoppedByPause=!0),this._bShowScanRegionLaser&&this.hideScanRegionLaser()}close(e){if(!this._video)return;this.stop(),this._unbindUI(),e&&(this.UIElement.style.display="none"),this.stopFetchingLoop(),this.bOpen=!1;const t=this.mapCameraEvents.get("cameraClose");for(let e of t){const t={width:0,height:0,deviceId:null};setTimeout((()=>e(t)),0)}}open(e){return D(this,void 0,void 0,(function*(){this._bindUI(),e&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""));let t=yield this.play();this.bOpen=!0;const i=this.mapCameraEvents.get("cameraOpen");for(let e of i){const i=JSON.parse(JSON.stringify(t));setTimeout((()=>e(i)),0)}return t}))}stop(){this._video&&this._video.srcObject&&(b._onLog&&b._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach((e=>{e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(b._onLog&&b._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0}getAllCameras(){return D(this,void 0,void 0,(function*(){let e=yield navigator.mediaDevices.enumerateDevices();if(!e[0].deviceId){let t=yield navigator.mediaDevices.getUserMedia({video:!0});e=yield navigator.mediaDevices.enumerateDevices(),t.getTracks().forEach((e=>{e.stop()})),t=null}const t=[],i=[];if(this._allCameras)for(let e of this._allCameras)e._checked&&i.push(e);for(let n=0;n<e.length;n++){let o,r=e[n];if("videoinput"==r.kind){for(let e of i)r.deviceId==e.deviceId&&(o=e);o||(o={},o.deviceId=r.deviceId,o.label=r.label?r.label:"camera "+n),t.push(o)}}return this._allCameras=t,b._onLog&&b._onLog("DCE: "+JSON.stringify(this._allCameras)),Promise.resolve(t)}))}_renderSelCameraInfo(){if(this._selCam&&(this._selCam.innerHTML=""),this._selCam){let e;for(let t of this._allCameras){let i=document.createElement("option");i.value=t.deviceId,i.innerText=t.label,this._selCam.append(i),t.deviceId&&this._currentCamera&&this._currentCamera.deviceId==t.deviceId&&(e=i)}this._selCam.value=e?e.value:""}}getSelectedCamera(){if(!this._bOpen){let e="";const t=this.videoSettings.video.deviceId;t&&(e=t.exact||t.ideal||t);for(let t of this._allCameras)if(t.deviceId===e)return JSON.parse(JSON.stringify(t));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}selectCamera(e){return D(this,void 0,void 0,(function*(){let t="";return e&&(t=e.deviceId||e),this.videoSettings.video.deviceId={exact:t},this._bOpen?yield this.play(e.deviceId||e):null}))}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,t=0;const i=this.videoSettings.video.width,n=this.videoSettings.video.height;return i&&(e=i.exact||i.ideal||i),n&&(t=n.exact||n.ideal||n),[e,t]}}setResolution(e,t){return D(this,void 0,void 0,(function*(){let i,n;return e instanceof Array?(i=e[0],n=e[1]):(i=e,n=t),this.videoSettings.video.width={ideal:i},this.videoSettings.video.height={ideal:n},this._bOpen?yield this.play(null,i,n):null}))}getResolutions(e){return D(this,void 0,void 0,(function*(){let t="";const i=(e,t)=>{const i=this.mapCameraResolutions.get(e);if(!i||!i.length)return!1;for(let e of i)if(e[0]===t.width&&e[1]===t.height)return!0;return!1},n=(e,t,i)=>D(this,void 0,void 0,(function*(){const n={video:{deviceId:{exact:e},width:{ideal:t},height:{ideal:i}}};let o=null;try{o=yield navigator.mediaDevices.getUserMedia(n)}catch(n){return null}if(!o)return null;const r=o.getVideoTracks();let s=null;try{const e=r[0].getSettings();s={width:e.width,height:e.height}}catch(n){const e=document.createElement("video");e.srcObject=o,s={width:e.videoWidth,height:e.videoHeight},e.srcObject=null}return r.forEach((e=>{e.stop()})),s}));if(!this._bOpen){const o=this.videoSettings.video.deviceId;if(!o)return null;if(t=o.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:o.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!t)return null;let r=this.mapCameraResolutions.get(t);if(r&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),r=this.mapCameraResolutions.get(t);for(let e of this.predefinedResolutions){const o=yield n(t,e.width,e.height);o&&!i(t,o)&&r.push([o.width,o.height])}return r}if(this._currentCamera){t=this._currentCamera.deviceId;let n=this.mapCameraResolutions.get(t);if(n&&!e)return this.mapCameraResolutions.get(t);this.mapCameraResolutions.set(t,[]),n=this.mapCameraResolutions.get(t);const o=this.getConstraints();for(let e of this.predefinedResolutions){yield this._videoTrack.applyConstraints({width:{ideal:e.width},height:{ideal:e.height}});const o=this._videoTrack.getSettings(),r={width:o.width,height:o.height};i(t,r)||n.push([r.width,r.height])}return yield this._videoTrack.applyConstraints(o),n}return null}))}on(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e);i.includes(t)||i.push(t)}off(e,t){if(!this.mapCameraEvents.has(e))throw new Error(`Event '${e}' is not exists.`);const i=this.mapCameraEvents.get(e),n=i.indexOf(t);-1!==n&&i.splice(n,1)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen?this.play():Promise.resolve()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getSettings()}getConstraints(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'getConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');return this._videoTrack.getConstraints()}applyConstraints(e){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return yield this._videoTrack.applyConstraints(e)}))}turnOnTorch(){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}))}turnOffTorch(){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return yield this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}))}setColorTemperature(e){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let t=this.getCapabilities().colorTemperature;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]})}))}setExposureCompensation(e){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let t=this.getCapabilities().exposureCompensation;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}))}setZoom(e){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setZoom()' is unavailable in singleFrameMode.");let t=this.getCapabilities().zoom;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({advanced:[{zoom:e}]})}))}setFrameRate(e){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let t=this.getCapabilities().frameRate;if(!t)throw Error("Not supported.");return e<t.min?e=t.min:e>t.max&&(e=t.max),yield this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}))}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(e,t){return D(this,void 0,void 0,(function*(){if(this._assertOpen(),this.singleFrameMode)throw new Error("'setFocus()' is unavailable in singleFrameMode.");const i=this.getCapabilities().focusMode,n=this.getCapabilities().focusDistance;if(!i||!i.includes(e)||!n)throw Error("Not supported.");return t?(t<n.min?t=n.min:t>n.max&&(t=n.max),yield this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:t}]})):yield this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}))}getFocus(){const e=this.getCameraSettings().focusMode;return"continuous"===e?{mode:e}:{mode:e,distance:this.getCameraSettings().focusDistance}}getFrameSize(e,t,i,n){if(!e||!t)return null;let o,r,s,a,d=e,l=t;const c={regionLeft:0,regionTop:0,regionRight:d,regionBottom:l,regionMeasuredByPercentage:!1};i?(i.regionMeasuredByPercentage?(c.regionLeft=i.regionLeft*d/100,c.regionTop=i.regionTop*l/100,c.regionRight=i.regionRight*d/100,c.regionBottom=i.regionBottom*l/100):(c.regionLeft=i.regionLeft,c.regionTop=i.regionTop,c.regionRight=i.regionRight,c.regionBottom=i.regionBottom),o=c.regionLeft,r=c.regionTop,d=Math.round(c.regionRight-c.regionLeft),l=Math.round(c.regionBottom-c.regionTop)):(o=0,r=0);const h=Math.max(d,l);if(n&&n>0&&h>n){const e=n/h;d>l?(s=n,a=Math.round(l*e)):(s=Math.round(d*e),a=n)}else s=d,a=l;return s<=0||a<=0?null:{sx:o,sy:r,sWidth:d,sHeight:l,dWidth:s,dHeight:a}}getFrame(){if(this.singleFrameMode)throw Error("'getFrame()' is unavailable in singleFrameMode.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoFrame(this._scanRegion)}_getVideoFrame(e,t){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw new Error("'_getVideoFrame()' is unavailable in singleFrameMode.");const i=Date.now();b._onLog&&b._onLog("DCE: _getVideoFrame(region?) START: "+i);const n=this._video.videoWidth,o=this._video.videoHeight;if(0===n||0===o)return null;const r=this.getFrameSize(n,o,e,this.maxCvsSideLength);if(!r)return null;let s,a;s=n!==r.sWidth||o!==r.sHeight,a=r.sWidth!==r.dWidth||r.sHeight!==r.dHeight;const d=(()=>!(!this._bWebGLSupported||a))(),l={data:null,region:e?JSON.parse(JSON.stringify(e)):null,sx:r.sx,sy:r.sy,width:r.dWidth,height:r.dHeight,colorMode:null,timeSpent:null,timeStamp:null,isCropped:s,toCanvas:this.toCanvas,_bUseWebGL:null},c=this._getImageData(this._video,n,o,r,t,{targetColorMode:this.frameColorMode,bUseWebGL:d});if(!c)return null;const h=Date.now();return b._onLog&&b._onLog("DCE: _getVideoFrame(region?) END: "+h),l.data=c.data,l.colorMode=c.colorMode,l._bUseWebGL=c._bUseWebGL,l.timeSpent=h-i,l.timeStamp=h,l}_getImageData(e,t,i,n,o,r){if(this.bDestroyed)throw Error("The 'CameraEnhancer' instance has been destroyed.");if(!t||!i)return null;b._onLog&&b._onLog("DCE: _getImageData() START: "+Date.now());const{sx:s,sy:a,sWidth:d,sHeight:l,dWidth:c,dHeight:h}=n;let _;if(_=r&&r.targetColorMode?r.targetColorMode.toLowerCase():"rgba",r&&r.bUseWebGL){this.videoGlCvs||(this.videoGlCvs=document.createElement("canvas"));const d=this.videoGlCvs;d.width==t&&d.height==i||(d.width=t,d.height=i,this.videoGl&&this.videoGl.viewport(0,0,t,i));const l=this.videoGl||d.getContext("webgl",{antialias:!1})||d.getContext("experimental-webgl",{antialias:!1});if(!l){this.videoGl=null,this._bWebGLSupported=!1;let s=null;return r?(s=JSON.parse(JSON.stringify(r)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,n,o,s)}if(l.enable(l.SCISSOR_TEST),l.scissor(s,a,c,h),!this.videoGl||_!==this.currentFSColorMode){this.videoGl=l;const e=e=>{const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW);const i=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{position:t,indices:i}},t=e=>{const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t},i=(e,t,i)=>{const o=n(e,e.VERTEX_SHADER,t),r=n(e,e.FRAGMENT_SHADER,i),s=e.createProgram();return e.attachShader(s,o),e.attachShader(s,r),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)?s:(alert("Unable to initialize the shader program: "+e.getProgramInfoLog(s)),null)},n=(e,t,i)=>{const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(n)),e.deleteShader(n),null)},o="\n                  attribute mediump vec2 aVertexPosition;\n                  varying mediump vec2 vDirection;\n          \n                  void main( void )\n                  {\n                      gl_Position = vec4(aVertexPosition, 1.0, 1.0) * 2.0;\n                      vDirection = aVertexPosition;\n                  }\n                ";let r;r=["rgba","rbga","grba","gbra","brga","bgra"].includes(_)?_.slice(0,3):"rgb";const s=i(l,o,`\n                    precision mediump float;\n\n                    varying mediump vec2 vDirection;\n                    uniform sampler2D uSampler;\n                    uniform lowp float uColorFactor;\n            \n                    void main(void)\n                    {\n                        vec4 sample = texture2D(uSampler, vec2(vDirection.x * 0.5 + 0.5, vDirection.y * 0.5 + 0.5));\n                        lowp float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                        gl_FragColor = vec4(sample.${r} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                    }\n                `);this.webglProgramInfo={program:s,attribLocations:{vertexPosition:l.getAttribLocation(s,"aVertexPosition")},uniformLocations:{uSampler:l.getUniformLocation(s,"uSampler"),uColorFactor:l.getUniformLocation(s,"uColorFactor")}},this.webglBuffers=e(l),this.webglTexture=t(l),this.currentFSColorMode=_}const u=(e,t,i)=>{const n=e.RGBA,o=e.RGBA,r=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n,o,r,i)},g=(e,t,i,n)=>{e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,i.indices),e.useProgram(t.program);{const n=2,o=e.FLOAT,r=!1,s=0,a=0;e.bindBuffer(e.ARRAY_BUFFER,i.position),e.vertexAttribPointer(t.attribLocations.vertexPosition,n,o,r,s,a),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,n),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform1f(t.uniformLocations.uColorFactor,"grey"===_||"grey32"===_?1:0);const o=e.UNSIGNED_SHORT;e.drawElements(e.TRIANGLES,6,o,0)};let m;if(u(l,this.webglTexture,e),g(l,this.webglProgramInfo,this.webglBuffers,this.webglTexture),o){if(o.length<c*h*4)return null;m=o}else this.ifReuseArrayBufferView||"grey"===_?(this.glImgData&&this.glImgData.length===c*h*4||(this.glImgData=new Uint8Array(c*h*4)),m=this.glImgData):m=new Uint8Array(c*h*4);if(l.readPixels(s,a,c,h,l.RGBA,l.UNSIGNED_BYTE,m),l.disable(l.SCISSOR_TEST),255!==m[3]){b._onLog&&b._onLog("DCE: WebGL draw frame incorrectly."),this.forceLoseContext(),this._bWebGLSupported=!1;let s=null;return r?(s=JSON.parse(JSON.stringify(r)),s.bUseWebGL=!1):s={bUseWebGL:!1},this._getImageData(e,t,i,n,o,s)}if("grey"===_){let e=b._onLog?Date.now():0;if(m=new Uint8Array(new Uint32Array(m.buffer)),o){if(o.length<m.length)return null;o.set(m)}b._onLog&&b._onLog("DCE: Extract grey cost: "+(Date.now()-e))}return b._onLog&&b._onLog("DCE: _getImageData END: "+Date.now()),{data:m,colorMode:_,_bUseWebGL:!0}}{this.canvas||(this.canvas=document.createElement("canvas"));const t=this.canvas;t.width===c&&t.height===h||(t.width=c,t.height=h),t.ctx2d||(t.ctx2d=t.getContext("2d"));const i=t.ctx2d;i.drawImage(e,s,a,d,l,0,0,c,h);let n=i.getImageData(0,0,t.width,t.height).data;if(["rbga","grba","gbra","brga","bgra"].includes(_)){const e=_.indexOf("r"),t=_.indexOf("g"),i=_.indexOf("b");let o=0;1===e||2===e?o=e:2===t&&(o=t);for(let r=0;r<n.length;r+=4){let s;o&&(s=n[r+o]),n[r+e]=n[r],n[r+t]=1===o?s:n[r+1],n[r+i]=2===o?s:n[r+2]}}else if("grey"===_||"grey32"===_)for(let e=0;e<n.length;e+=4){const t=.21*n[e]+.71*n[e+1]+.07*n[e+2];n[e]=t,n[e+1]=t,n[e+2]=t}if(n="grey"===_?new Uint8Array(new Uint32Array(n.buffer)):new Uint8Array(n.buffer),o){if(o.length<n.length)return null;o.set(n)}return b._onLog&&b._onLog("DCE: _getVideoFrame(region?) END: "+Date.now()),{data:n,colorMode:_,_bUseWebGL:!1}}}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.bDestroyed)return void this.stopFetchingLoop();if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();if(this._video.paused)return b._onLog&&b._onLog("DCE: Video is paused. Ask in 1s."),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),void(this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),1e3));const t=()=>{b._onLog&&b._onLog("DCE: start fetching a frame: "+Date.now());const e=this.getCurrentRegion();let t=this._getVideoFrame(e);if(!t)return void(b._onLog&&b._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(t),b._onLog&&b._onLog("DCE: finish fetching a frame: "+Date.now());const i=this.mapCameraEvents.get("frameAddedToBuffer");for(let e of i)setTimeout(e,0)},i=()=>{this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout((()=>{this.bDestroyed?this.stopFetchingLoop():this._bOpen&&this.isFetchingLoopStarted()?this._video.paused?this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId):(b._onLog&&b._onLog("DCE: second timeout executes: "+Date.now()),t(),i()):this.stopFetchingLoop()}),this.refreshInterval))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(t(),this.refreshInterval>0&&i()):this.refreshInterval>0?(t(),i()):0===this.refreshInterval?t():this.refreshInterval),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout((()=>{this._fetchingLoop(!0)}),this.loopInterval)}startFetchingLoop(){if(this.bDestroyed)throw Error("The DCE instance has been destroyed.");if(this._assertOpen(),this.singleFrameMode)throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");if(this._video.paused)throw Error("The video is paused.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,b._onLog&&b._onLog("start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(b._onLog&&b._onLog("stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.shift()):null}forceLoseContext(){if(!this.videoGl)return;const e=this.videoGl;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this.webglTexture=null,this.webglProgramInfo=null,this.webglBuffers=null,this.videoGl=null,this.videoGlCvs=null}dispose(e){this.close(!0),this.forceLoseContext(),this.setViewDecorator(null,null);for(let e of this._arrScanRegionOverlays)e&&e.remove();e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null}}b._jsVersion="2.3.2",b._jsEditVersion="20220321",b._version="JS "+b._jsVersion+"."+b._jsEditVersion,b.browserInfo=function(){if(!M){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var i=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,i){if(-1!=i.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(M)return{browser:"ssr",version:0,OS:"ssr"}}(),b._hasEngineResourceLoaded=!1,b._engineResourcePath=(()=>{if(!M&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),b._defaultUIElementURL="@engineResourcePath/dce.ui.html";class L extends w{constructor(){super(),this.bFilterRegionInJs=!0,this._onCameraSelChange=()=>{},this._onResolutionSelChange=()=>{},this._onCloseBtnClick=()=>{},this._onPlayed=null}static get version(){return this._version+`(DCE ${b.getVersion()})`}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let e=await this.getScanSettings();e.oneDTrustFrameCount=1,await this.updateScanSettings(e)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.frameColorMode=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(w._onLog&&w._onLog("createDCEInstance()"),b.defaultUIElementURL=null,this.dce=await b.createInstance(),this.dce.refreshInterval=200,this.dce.frameColorMode="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this.dce.on("cameraChange",(()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("resolutionChange",(()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0})),this.dce.on("cameraClose",(()=>{this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1})),this.dce.on("singleFrameAcquired",(async t=>{if(!t)return;if(!t.data)return;let i;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:t.width,height:t.height,colorMode:t.colorMode,data:new Uint8Array(t.data),toCanvas:t.toCanvas});const{data:n,region:o,sx:r,sy:s,width:a,height:d,colorMode:l,timeStamp:c}=t,h={timeStamp:c};if("grey"===l)i=await this._decodeBuffer_Uint8Array(n,a,d,a,e.EnumImagePixelFormat.IPF_GrayScaled,h);else if("rgba"===l)i=await this._decodeBuffer_Uint8Array(n,a,d,4*a,e.EnumImagePixelFormat.IPF_ABGR_8888,h);else{if("bgra"!==l)throw new Error(`Color mode '${l}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,a,d,4*a,e.EnumImagePixelFormat.IPF_ARGB_8888,h)}await this.clearMapDecodeRecord();for(let e of i)delete e.bUnduplicated;if(this._drawResults(i),w.fixResultLocationWhenFilterRegionInJs(o,i,r,s,a,d,a,d),this.onFrameRead&&this.isOpen()&&!this._bPauseScan&&this.onFrameRead(i),this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let e of i)this.onUniqueRead(e.barcodeText,e)})))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static async createInstance(e){let t=new L;await t.createDCEInstance(),t._instanceID=await L.createInstanceInWorker(!0),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)t[i]=e[i];return await t.setUIElement(L.defaultUIElementURL),t.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.singleFrameMode||await t.updateRuntimeSettings("single"),t}async decodeCurrentFrame(e){this._assertOpen();let t=null;e&&e.region&&(t=e.region);const i=this.dce._getVideoFrame(t);return this._decode_DCEFrame(i)}static isRegionNormalPreset(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}async updateRuntimeSettings(t){let i;if("string"==typeof t)if("speed"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(i.region=e.region)}else if("balance"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(i.region=e.region),i.deblurLevel=3,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0],i.timeout=1e5}else if("coverage"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,e.region&&(i.region=e.region),i.deblurLevel=5,i.expectedBarcodesCount=512,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.timeout=1e5}else if("single"==t){let e=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=e.barcodeFormatIds,i.barcodeFormatIds_2=e.barcodeFormatIds_2,L.isRegionNormalPreset(e.region)?i.region=null:i.region=e.region,i.expectedBarcodesCount=1,i.localizationModes=[16,2,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=0}else i=JSON.parse(t);else{if("object"!=typeof t)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(t)),i.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(i.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!w._bUseFullFeature){if(0!=(i.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let e=i.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(e)):this.userDefinedRegion=null,e instanceof Array)if(e.length){for(let t=0;t<e.length;++t){let i=e[t];i&&((i.regionLeft||i.regionTop||i.regionRight||i.regionBottom||i.regionMeasuredByPercentage)&&(i.regionLeft||i.regionTop||100!=i.regionRight||100!=i.regionBottom||!i.regionMeasuredByPercentage)||(e[t]=null))}this.region=e}else this.region=null;else e&&(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null;this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}await new Promise(((e,t)=>{let n=w._nextTaskID++;w._taskCallbackMap.set(n,(i=>{if(i.success){try{this._handleRetJsonString(i.updateReturn)}catch(e){t(e)}return e()}{let e=new Error(i.message);return e.stack=i.stack+"\n"+e.stack,t(e)}})),w._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})})),"single"==t&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0"),await this.setModeArgument("LocalizationModes",0,"ScanDirection","2"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","71"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","71"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){return this.dce.selectCamera(e)}getResolution(){return this.dce.getResolution()}async setResolution(e,t){return this.dce.setResolution(e,t)}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}stop(){this.dce.stop(),this.dce.hideScanRegionLaser(),this.dce.hideViewDecorator(),this.dce.hideScanRegionOverlays(),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this._drawResults(null),this.dce.pause()}async play(e,t,i){this.dce.ifShowScanRegionLaser=!0;return await this.dce.play(e,t,i)}pauseScan(){this._assertOpen(),this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}async setZoom(e){return this.dce.setZoom(e)}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,t){return this.dce.setFocus(e,t)}getFocus(){return this.dce.getFocus()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),void this._drawResults(null);if(!this.isOpen())return this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return w._onLog&&w._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this._intervalDetectVideoPause));w._onLog&&w._onLog("======= once read ======="),w._onLog&&(this._timeStartDecode=Date.now());const t=this._getVideoFrame();if(!t)return this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),0));(async()=>{let i;t._bUseWebGL||"grey"!==t.colorMode||(this.dce.frameColorMode="rgba"),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:t.width,height:t.height,colorMode:t.colorMode,data:new Uint8Array(t.data),toCanvas:t.toCanvas});const{data:n,region:o,sx:r,sy:s,width:a,height:d,colorMode:l,timeStamp:c}=t,h={timeStamp:c};if("grey"===l)i=await this._decodeBuffer_Uint8Array(n,a,d,a,e.EnumImagePixelFormat.IPF_GrayScaled,h);else if("rgba"===l)i=await this._decodeBuffer_Uint8Array(n,a,d,4*a,e.EnumImagePixelFormat.IPF_ABGR_8888,h);else{if("bgra"!==l)throw new Error(`Color mode '${l}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,a,d,4*a,e.EnumImagePixelFormat.IPF_ARGB_8888,h)}return this.dce&&this.dce.video&&!this.dce.video.paused&&this._drawResults(i),w.fixResultLocationWhenFilterRegionInJs(o,i,r,s,a,d,a,d),i})().then((e=>{w._onLog&&w._onLog(e);let t=this.array_decodeFrameTimeCost,i=this.array_getFrameTimeCost,n=this._indexCurrentDecodingFrame;if((()=>{if(this.region instanceof Array){for(t[n]&&t[n]instanceof Array||(t[n]=[]);t[n].length>=5;)t[n].shift();t[n].push(this._lastInnerDecodeDuration)}else{for(;t.length>=5;)t.shift();t.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=(()=>{let e=0;if(this.region instanceof Array){let o=0,r=0;o=n+1>=this.region.length?0:n+1,r=o+1>=this.region.length?0:o+1,e=t[o]&&t[o].length&&i[r]&&i[r].length?Math.min(...t[o])-Math.max(...i[r]):0}else if(i&&i.length){let n=Math.min(...t),o=Math.max(...i);n&&o&&(e=n-o)}else e=0;return e>0?e:0})()+this.intervalTime,this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bPlaySoundOnSuccessfulRead||"frame"===this.bPlaySoundOnSuccessfulRead)t=!0;else if("unique"===this.bPlaySoundOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}t&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&e.length){let t=!1;if(!0===this.bVibrateOnSuccessfulRead||"frame"===this.bVibrateOnSuccessfulRead)t=!0;else if("unique"===this.bVibrateOnSuccessfulRead)for(let i of e)if(i.bUnduplicated){t=!0;break}if(t)try{navigator.vibrate(this.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(this.onFrameRead){let t=this._cloneDecodeResults(e);for(let e of t)delete e.bUnduplicated;this.onFrameRead(t)}if(this.onUniqueRead)for(let t of e)t.bUnduplicated&&this.onUniqueRead(t.barcodeText,this._cloneDecodeResults(t))}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),this.intervalTime):this._loopReadVideo()})).catch((e=>{this.dce.stopFetchingLoop(),w._onLog&&w._onLog(e.message||e),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout((()=>{this._loopReadVideo()}),Math.max(this.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}))}_getVideoFrame(){if(!this.dce)return null;let e=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,e||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;const t=this.dce.getFrameFromBuffer();return(e=>{if(!e)return;let t=e.timeSpent,i=this.array_getFrameTimeCost;for(;i.length>=5;)i.shift();i.push(t)})(t),t}async open(){this._bindUI();let e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.dce.ifShowScanRegionLaser=!0,this._loopReadVideo()),this.keepAlive(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),this.keepAlive(),e}close(){this.dce.close(),this._bPauseScan=!0}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.dce.ifShowScanRegionLaser=!0,this._loopReadVideo()),this.keepAlive(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideo()),this.keepAlive(),e}hide(){this.dce.close(!0),this._bPauseScan=!0}destroyContext(){this.close(),this.bDestroyed||super.destroyContext()}}var O,F,B,P,N,x,V,k,U,G,W,H,J,K,Q,Y,j,X,Z,q,z,$,ee,te,ie,ne,oe;e.EnumBarcodeColourMode=void 0,(O=e.EnumBarcodeColourMode||(e.EnumBarcodeColourMode={}))[O.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",O[O.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",O[O.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",O[O.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",O[O.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",O[O.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",O[O.BICM_SKIP=0]="BICM_SKIP",O[O.BICM_REV=2147483648]="BICM_REV",e.EnumBarcodeComplementMode=void 0,(F=e.EnumBarcodeComplementMode||(e.EnumBarcodeComplementMode={}))[F.BCM_AUTO=1]="BCM_AUTO",F[F.BCM_GENERAL=2]="BCM_GENERAL",F[F.BCM_SKIP=0]="BCM_SKIP",F[F.BCM_REV=2147483648]="BCM_REV",e.EnumBarcodeFormat_2=void 0,(B=e.EnumBarcodeFormat_2||(e.EnumBarcodeFormat_2={}))[B.BF2_NULL=0]="BF2_NULL",B[B.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",B[B.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",B[B.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",B[B.BF2_POSTNET=2097152]="BF2_POSTNET",B[B.BF2_PLANET=4194304]="BF2_PLANET",B[B.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",B[B.BF2_RM4SCC=16777216]="BF2_RM4SCC",B[B.BF2_DOTCODE=2]="BF2_DOTCODE",B[B.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",B[B.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",B[B.BF2_PHARMACODE=12]="BF2_PHARMACODE",e.EnumBinarizationMode=void 0,(P=e.EnumBinarizationMode||(e.EnumBinarizationMode={}))[P.BM_AUTO=1]="BM_AUTO",P[P.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",P[P.BM_SKIP=0]="BM_SKIP",P[P.BM_THRESHOLD=4]="BM_THRESHOLD",P[P.BM_REV=2147483648]="BM_REV",e.EnumClarityCalculationMethod=void 0,(N=e.EnumClarityCalculationMethod||(e.EnumClarityCalculationMethod={}))[N.ECCM_CONTRAST=1]="ECCM_CONTRAST",e.EnumClarityFilterMode=void 0,(x=e.EnumClarityFilterMode||(e.EnumClarityFilterMode={}))[x.CFM_GENERAL=1]="CFM_GENERAL",e.EnumColourClusteringMode=void 0,(V=e.EnumColourClusteringMode||(e.EnumColourClusteringMode={}))[V.CCM_AUTO=1]="CCM_AUTO",V[V.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",V[V.CCM_SKIP=0]="CCM_SKIP",V[V.CCM_REV=2147483648]="CCM_REV",e.EnumColourConversionMode=void 0,(k=e.EnumColourConversionMode||(e.EnumColourConversionMode={}))[k.CICM_GENERAL=1]="CICM_GENERAL",k[k.CICM_SKIP=0]="CICM_SKIP",k[k.CICM_REV=2147483648]="CICM_REV",e.EnumConflictMode=void 0,(U=e.EnumConflictMode||(e.EnumConflictMode={}))[U.CM_IGNORE=1]="CM_IGNORE",U[U.CM_OVERWRITE=2]="CM_OVERWRITE",e.EnumDeblurMode=void 0,(G=e.EnumDeblurMode||(e.EnumDeblurMode={}))[G.DM_SKIP=0]="DM_SKIP",G[G.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",G[G.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",G[G.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",G[G.DM_SMOOTHING=8]="DM_SMOOTHING",G[G.DM_MORPHING=16]="DM_MORPHING",G[G.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",G[G.DM_SHARPENING=64]="DM_SHARPENING",G[G.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",G[G.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e.EnumDeformationResistingMode=void 0,(W=e.EnumDeformationResistingMode||(e.EnumDeformationResistingMode={}))[W.DRM_AUTO=1]="DRM_AUTO",W[W.DRM_GENERAL=2]="DRM_GENERAL",W[W.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",W[W.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",W[W.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",W[W.DRM_SKIP=0]="DRM_SKIP",W[W.DRM_REV=2147483648]="DRM_REV",e.EnumDPMCodeReadingMode=void 0,(H=e.EnumDPMCodeReadingMode||(e.EnumDPMCodeReadingMode={}))[H.DPMCRM_AUTO=1]="DPMCRM_AUTO",H[H.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",H[H.DPMCRM_SKIP=0]="DPMCRM_SKIP",H[H.DPMCRM_REV=2147483648]="DPMCRM_REV",e.EnumGrayscaleTransformationMode=void 0,(J=e.EnumGrayscaleTransformationMode||(e.EnumGrayscaleTransformationMode={}))[J.GTM_INVERTED=1]="GTM_INVERTED",J[J.GTM_ORIGINAL=2]="GTM_ORIGINAL",J[J.GTM_SKIP=0]="GTM_SKIP",J[J.GTM_REV=2147483648]="GTM_REV",e.EnumImagePreprocessingMode=void 0,(K=e.EnumImagePreprocessingMode||(e.EnumImagePreprocessingMode={}))[K.IPM_AUTO=1]="IPM_AUTO",K[K.IPM_GENERAL=2]="IPM_GENERAL",K[K.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",K[K.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",K[K.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",K[K.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",K[K.IPM_SKIP=0]="IPM_SKIP",K[K.IPM_REV=2147483648]="IPM_REV",e.EnumIntermediateResultSavingMode=void 0,(Q=e.EnumIntermediateResultSavingMode||(e.EnumIntermediateResultSavingMode={}))[Q.IRSM_MEMORY=1]="IRSM_MEMORY",Q[Q.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",Q[Q.IRSM_BOTH=4]="IRSM_BOTH",e.EnumIntermediateResultType=void 0,(Y=e.EnumIntermediateResultType||(e.EnumIntermediateResultType={}))[Y.IRT_NO_RESULT=0]="IRT_NO_RESULT",Y[Y.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",Y[Y.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",Y[Y.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",Y[Y.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",Y[Y.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",Y[Y.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",Y[Y.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",Y[Y.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",Y[Y.IRT_CONTOUR=256]="IRT_CONTOUR",Y[Y.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",Y[Y.IRT_FORM=1024]="IRT_FORM",Y[Y.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",Y[Y.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",Y[Y.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL",e.EnumLocalizationMode=void 0,(j=e.EnumLocalizationMode||(e.EnumLocalizationMode={}))[j.LM_SKIP=0]="LM_SKIP",j[j.LM_AUTO=1]="LM_AUTO",j[j.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",j[j.LM_LINES=8]="LM_LINES",j[j.LM_STATISTICS=4]="LM_STATISTICS",j[j.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",j[j.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",j[j.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",j[j.LM_CENTRE=128]="LM_CENTRE",j[j.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",j[j.LM_REV=2147483648]="LM_REV",e.EnumPDFReadingMode=void 0,(X=e.EnumPDFReadingMode||(e.EnumPDFReadingMode={}))[X.PDFRM_RASTER=1]="PDFRM_RASTER",X[X.PDFRM_AUTO=2]="PDFRM_AUTO",X[X.PDFRM_VECTOR=4]="PDFRM_VECTOR",X[X.PDFRM_REV=2147483648]="PDFRM_REV",e.EnumQRCodeErrorCorrectionLevel=void 0,(Z=e.EnumQRCodeErrorCorrectionLevel||(e.EnumQRCodeErrorCorrectionLevel={}))[Z.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",Z[Z.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",Z[Z.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",Z[Z.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q",e.EnumRegionPredetectionMode=void 0,(q=e.EnumRegionPredetectionMode||(e.EnumRegionPredetectionMode={}))[q.RPM_AUTO=1]="RPM_AUTO",q[q.RPM_GENERAL=2]="RPM_GENERAL",q[q.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",q[q.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",q[q.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",q[q.RPM_SKIP=0]="RPM_SKIP",q[q.RPM_REV=2147483648]="RPM_REV",e.EnumResultCoordinateType=void 0,(z=e.EnumResultCoordinateType||(e.EnumResultCoordinateType={}))[z.RCT_PIXEL=1]="RCT_PIXEL",z[z.RCT_PERCENTAGE=2]="RCT_PERCENTAGE",e.EnumResultType=void 0,($=e.EnumResultType||(e.EnumResultType={}))[$.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",$[$.RT_RAW_TEXT=1]="RT_RAW_TEXT",$[$.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",$[$.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT",e.EnumScaleUpMode=void 0,(ee=e.EnumScaleUpMode||(e.EnumScaleUpMode={}))[ee.SUM_AUTO=1]="SUM_AUTO",ee[ee.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",ee[ee.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",ee[ee.SUM_SKIP=0]="SUM_SKIP",ee[ee.SUM_REV=2147483648]="SUM_REV",e.EnumTerminatePhase=void 0,(te=e.EnumTerminatePhase||(e.EnumTerminatePhase={}))[te.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",te[te.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",te[te.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",te[te.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",te[te.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",te[te.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED",e.EnumTextFilterMode=void 0,(ie=e.EnumTextFilterMode||(e.EnumTextFilterMode={}))[ie.TFM_AUTO=1]="TFM_AUTO",ie[ie.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",ie[ie.TFM_SKIP=0]="TFM_SKIP",ie[ie.TFM_REV=2147483648]="TFM_REV",e.EnumTextResultOrderMode=void 0,(ne=e.EnumTextResultOrderMode||(e.EnumTextResultOrderMode={}))[ne.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",ne[ne.TROM_POSITION=2]="TROM_POSITION",ne[ne.TROM_FORMAT=4]="TROM_FORMAT",ne[ne.TROM_SKIP=0]="TROM_SKIP",ne[ne.TROM_REV=2147483648]="TROM_REV",e.EnumTextureDetectionMode=void 0,(oe=e.EnumTextureDetectionMode||(e.EnumTextureDetectionMode={}))[oe.TDM_AUTO=1]="TDM_AUTO",oe[oe.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",oe[oe.TDM_SKIP=0]="TDM_SKIP",oe[oe.TDM_REV=2147483648]="TDM_REV",e.BarcodeReader=w,e.BarcodeScanner=L,Object.defineProperty(e,"__esModule",{value:!0})}));
